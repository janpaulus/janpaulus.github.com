<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>youBot Driver: ethercatconfig.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='../../open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='../../closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='../../closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="../../main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="../../annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="../../files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="../../dir_8cc86e4513fd21e92bbc0f7893630384.html">soem</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_1086005baf707edfe0b93a7ee9dc1255.html">src</a>
  </div>
</div>
<div class="contents">
<h1>ethercatconfig.c</h1><a href="../../d2/d04/ethercatconfig_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * Simple Open EtherCAT Master Library </span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * File    : ethercatconfig.c</span>
<a name="l00005"></a>00005 <span class="comment"> * Version : 1.2.5</span>
<a name="l00006"></a>00006 <span class="comment"> * Date    : 09-04-2011</span>
<a name="l00007"></a>00007 <span class="comment"> * Copyright (C) 2005-2011 Speciaal Machinefabriek Ketels v.o.f.</span>
<a name="l00008"></a>00008 <span class="comment"> * Copyright (C) 2005-2011 Arthur Ketels</span>
<a name="l00009"></a>00009 <span class="comment"> * Copyright (C) 2008-2009 TU/e Technische Universiteit Eindhoven </span>
<a name="l00010"></a>00010 <span class="comment"> *</span>
<a name="l00011"></a>00011 <span class="comment"> * SOEM is free software; you can redistribute it and/or modify it under</span>
<a name="l00012"></a>00012 <span class="comment"> * the terms of the GNU General Public License version 2 as published by the Free</span>
<a name="l00013"></a>00013 <span class="comment"> * Software Foundation.</span>
<a name="l00014"></a>00014 <span class="comment"> *</span>
<a name="l00015"></a>00015 <span class="comment"> * SOEM is distributed in the hope that it will be useful, but WITHOUT ANY</span>
<a name="l00016"></a>00016 <span class="comment"> * WARRANTY; without even the implied warranty of MERCHANTABILITY or</span>
<a name="l00017"></a>00017 <span class="comment"> * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License</span>
<a name="l00018"></a>00018 <span class="comment"> * for more details.</span>
<a name="l00019"></a>00019 <span class="comment"> *</span>
<a name="l00020"></a>00020 <span class="comment"> * As a special exception, if other files instantiate templates or use macros</span>
<a name="l00021"></a>00021 <span class="comment"> * or inline functions from this file, or you compile this file and link it</span>
<a name="l00022"></a>00022 <span class="comment"> * with other works to produce a work based on this file, this file does not</span>
<a name="l00023"></a>00023 <span class="comment"> * by itself cause the resulting work to be covered by the GNU General Public</span>
<a name="l00024"></a>00024 <span class="comment"> * License. However the source code for this file must still be made available</span>
<a name="l00025"></a>00025 <span class="comment"> * in accordance with section (3) of the GNU General Public License.</span>
<a name="l00026"></a>00026 <span class="comment"> *</span>
<a name="l00027"></a>00027 <span class="comment"> * This exception does not invalidate any other reasons why a work based on</span>
<a name="l00028"></a>00028 <span class="comment"> * this file might be covered by the GNU General Public License.</span>
<a name="l00029"></a>00029 <span class="comment"> *</span>
<a name="l00030"></a>00030 <span class="comment"> * The EtherCAT Technology, the trade name and logo “EtherCAT” are the intellectual</span>
<a name="l00031"></a>00031 <span class="comment"> * property of, and protected by Beckhoff Automation GmbH. You can use SOEM for</span>
<a name="l00032"></a>00032 <span class="comment"> * the sole purpose of creating, using and/or selling or otherwise distributing</span>
<a name="l00033"></a>00033 <span class="comment"> * an EtherCAT network master provided that an EtherCAT Master License is obtained</span>
<a name="l00034"></a>00034 <span class="comment"> * from Beckhoff Automation GmbH.</span>
<a name="l00035"></a>00035 <span class="comment"> *</span>
<a name="l00036"></a>00036 <span class="comment"> * In case you did not receive a copy of the EtherCAT Master License along with</span>
<a name="l00037"></a>00037 <span class="comment"> * SOEM write to Beckhoff Automation GmbH, Eiserstraße 5, D-33415 Verl, Germany</span>
<a name="l00038"></a>00038 <span class="comment"> * (www.beckhoff.com).</span>
<a name="l00039"></a>00039 <span class="comment"> */</span>
<a name="l00040"></a>00040 <span class="comment"></span>
<a name="l00041"></a>00041 <span class="comment">/** \file</span>
<a name="l00042"></a>00042 <span class="comment"> * \brief</span>
<a name="l00043"></a>00043 <span class="comment"> * Configuration module for EtherCAT master.</span>
<a name="l00044"></a>00044 <span class="comment"> *</span>
<a name="l00045"></a>00045 <span class="comment"> * After successful initialisation with ec_init() or ec_init_redundant()</span>
<a name="l00046"></a>00046 <span class="comment"> * the slaves can be auto configured with this module.</span>
<a name="l00047"></a>00047 <span class="comment"> */</span>
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &lt;sys/time.h&gt;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/dbb/ethercattype_8h.html" title="General typedefs and defines for EtherCAT.">ethercattype.h</a>&quot;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/d46/nicdrv_8h.html" title="Headerfile for nicdrv.c.">nicdrv.h</a>&quot;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;<a class="code" href="../../df/dd2/ethercatbase_8h.html" title="Headerfile for ethercatbase.c.">ethercatbase.h</a>&quot;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d38/ethercatmain_8h.html" title="Headerfile for ethercatmain.c.">ethercatmain.h</a>&quot;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/dad/ethercatcoe_8h.html" title="Headerfile for ethercatcoe.c.">ethercatcoe.h</a>&quot;</span>
<a name="l00058"></a>00058 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d5a/ethercatsoe_8h.html" title="Headerfile for ethercatsoe.c.">ethercatsoe.h</a>&quot;</span>
<a name="l00059"></a>00059 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d03/ethercatconfig_8h.html" title="Headerfile for ethercatconfig.c.">ethercatconfig.h</a>&quot;</span>
<a name="l00060"></a>00060 
<a name="l00061"></a>00061 <span class="comment">// define if debug printf is needed</span>
<a name="l00062"></a>00062 <span class="comment">//#define EC_DEBUG</span>
<a name="l00063"></a>00063 
<a name="l00064"></a>00064 <span class="preprocessor">#ifdef EC_DEBUG</span>
<a name="l00065"></a>00065 <span class="preprocessor"></span><span class="preprocessor">#define EC_PRINT printf</span>
<a name="l00066"></a>00066 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00067"></a><a class="code" href="../../d2/d04/ethercatconfig_8c.html#a7f701d87af8db364450d02975b16cd5d">00067</a> <span class="preprocessor"></span><span class="preprocessor">#define EC_PRINT(...) do {} while (0)</span>
<a name="l00068"></a>00068 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00069"></a>00069 <span class="preprocessor"></span><span class="comment"></span>
<a name="l00070"></a>00070 <span class="comment">/** Slave configuration structure */</span>
<a name="l00071"></a><a class="code" href="../../de/dae/structec__configlist__t.html">00071</a> <span class="keyword">typedef</span> <span class="keyword">const</span> <span class="keyword">struct</span>
<a name="l00072"></a>00072 {<span class="comment"></span>
<a name="l00073"></a>00073 <span class="comment">  /** Manufacturer code of slave */</span>
<a name="l00074"></a><a class="code" href="../../de/dae/structec__configlist__t.html#af7d936da78dca628b4f7df177e1f7065">00074</a>   <a class="code" href="../../d2/dbb/ethercattype_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a>        man;<span class="comment"></span>
<a name="l00075"></a>00075 <span class="comment">  /** ID of slave */</span>
<a name="l00076"></a><a class="code" href="../../de/dae/structec__configlist__t.html#a3384d9640634d49e84776a97f3e2c241">00076</a>   <a class="code" href="../../d2/dbb/ethercattype_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a>        id;<span class="comment"></span>
<a name="l00077"></a>00077 <span class="comment">  /** Readable name */</span>
<a name="l00078"></a><a class="code" href="../../de/dae/structec__configlist__t.html#a1f365375f64fa1a131106ae127e626f4">00078</a>   <span class="keywordtype">char</span>        name[<a class="code" href="../../d8/d38/ethercatmain_8h.html#a78b2e0fda1697c4a57ece30a439bf1bf">EC_MAXNAME</a> + 1];<span class="comment"></span>
<a name="l00079"></a>00079 <span class="comment">  /** Data type */</span>
<a name="l00080"></a><a class="code" href="../../de/dae/structec__configlist__t.html#a97833c4bca1f3b5bc40ff7b3bf4b3809">00080</a>   <a class="code" href="../../d2/dbb/ethercattype_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a>       Dtype;<span class="comment"></span>
<a name="l00081"></a>00081 <span class="comment">  /** Input bits */</span>
<a name="l00082"></a><a class="code" href="../../de/dae/structec__configlist__t.html#a476276ad037266d880ff367a79ee9c66">00082</a>   <a class="code" href="../../d2/dbb/ethercattype_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a>        Ibits;<span class="comment"></span>
<a name="l00083"></a>00083 <span class="comment">  /** Output bits */</span>
<a name="l00084"></a><a class="code" href="../../de/dae/structec__configlist__t.html#aa1da8dcd1b53ecb6f8f4a9ef70c7502b">00084</a>   <a class="code" href="../../d2/dbb/ethercattype_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a>        Obits;<span class="comment"></span>
<a name="l00085"></a>00085 <span class="comment">  /** SyncManager 2 address */</span>
<a name="l00086"></a><a class="code" href="../../de/dae/structec__configlist__t.html#a2196b79f5f4468260f4da26f35d1dc10">00086</a>   <a class="code" href="../../d2/dbb/ethercattype_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a>        SM2a;<span class="comment"></span>
<a name="l00087"></a>00087 <span class="comment">  /** SyncManager 2 flags */</span>
<a name="l00088"></a><a class="code" href="../../de/dae/structec__configlist__t.html#ab575de6aec0e532d5d431c2d46a19eaa">00088</a>   <a class="code" href="../../d2/dbb/ethercattype_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a>        SM2f;<span class="comment"></span>
<a name="l00089"></a>00089 <span class="comment">  /** SyncManager 3 address */</span>
<a name="l00090"></a><a class="code" href="../../de/dae/structec__configlist__t.html#a99b6a54e41680cdf32a8b01fde50e5a9">00090</a>   <a class="code" href="../../d2/dbb/ethercattype_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a>        SM3a;<span class="comment"></span>
<a name="l00091"></a>00091 <span class="comment">  /** SyncManager 3 flags */</span>
<a name="l00092"></a><a class="code" href="../../de/dae/structec__configlist__t.html#acc0166ccb744da06deaf5df837ecb955">00092</a>   <a class="code" href="../../d2/dbb/ethercattype_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a>        SM3f;<span class="comment"></span>
<a name="l00093"></a>00093 <span class="comment">  /** FMMU 0 activation */</span>
<a name="l00094"></a><a class="code" href="../../de/dae/structec__configlist__t.html#aaeaa0bbb04a38dae9c48760c3c16b4c7">00094</a>   <a class="code" href="../../d2/dbb/ethercattype_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a>       FM0ac;<span class="comment"></span>
<a name="l00095"></a>00095 <span class="comment">  /** FMMU 1 activation */</span>
<a name="l00096"></a><a class="code" href="../../de/dae/structec__configlist__t.html#a1b6302df3a251cfc696664c4ae691dad">00096</a>   <a class="code" href="../../d2/dbb/ethercattype_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a>       FM1ac;
<a name="l00097"></a>00097 } <a class="code" href="../../de/dae/structec__configlist__t.html" title="Slave configuration structure.">ec_configlist_t</a>;
<a name="l00098"></a>00098 
<a name="l00099"></a>00099 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/d50/ethercatconfiglist_8h.html" title="Configuration list of known EtherCAT slave devices.">ethercatconfiglist.h</a>&quot;</span>
<a name="l00100"></a>00100 <span class="comment"></span>
<a name="l00101"></a>00101 <span class="comment">/** standard SM0 flags configuration for mailbox slaves */</span>
<a name="l00102"></a><a class="code" href="../../d2/d04/ethercatconfig_8c.html#a7ffdfc0c1550e70c5579eb049e15a990">00102</a> <span class="preprocessor">#define EC_DEFAULTMBXSM0  0x00010026</span>
<a name="l00103"></a>00103 <span class="preprocessor"></span><span class="comment">/** standard SM1 flags configuration for mailbox slaves */</span>
<a name="l00104"></a><a class="code" href="../../d2/d04/ethercatconfig_8c.html#a46051caffcdf0610f7aa0a5abef7920c">00104</a> <span class="preprocessor">#define EC_DEFAULTMBXSM1  0x00010022</span>
<a name="l00105"></a>00105 <span class="preprocessor"></span><span class="comment">/** standard SM0 flags configuration for digital output slaves */</span>
<a name="l00106"></a><a class="code" href="../../d2/d04/ethercatconfig_8c.html#af7063e832d749d4cbaa55317092ca5cc">00106</a> <span class="preprocessor">#define EC_DEFAULTDOSM0   0x00010044</span>
<a name="l00107"></a>00107 <span class="preprocessor"></span><span class="comment"></span>
<a name="l00108"></a>00108 <span class="comment">/** buffer for EEPROM SM data */</span>
<a name="l00109"></a>00109 <span class="keyword">static</span> <a class="code" href="../../de/d35/structec__eeprom_s_mt.html" title="SII SM structure.">ec_eepromSMt</a> ec_SM;<span class="comment"></span>
<a name="l00110"></a>00110 <span class="comment">/** buffer for EEPROM FMMU data */</span>
<a name="l00111"></a>00111 <span class="keyword">static</span> <a class="code" href="../../d6/ddd/structec__eeprom_f_m_m_ut.html" title="SII FMMU structure.">ec_eepromFMMUt</a> ec_FMMU;
<a name="l00112"></a>00112 <span class="comment"></span>
<a name="l00113"></a>00113 <span class="comment">/** Find slave in standard configuration list ec_configlist[]</span>
<a name="l00114"></a>00114 <span class="comment"> *</span>
<a name="l00115"></a>00115 <span class="comment"> * @param[in] man    = manufacturer</span>
<a name="l00116"></a>00116 <span class="comment"> * @param[in] id     = ID</span>
<a name="l00117"></a>00117 <span class="comment"> * @return index in ec_configlist[] when found, otherwise 0</span>
<a name="l00118"></a>00118 <span class="comment"> */</span>
<a name="l00119"></a><a class="code" href="../../d2/d04/ethercatconfig_8c.html#a8aa31990a858c7e049cfb4de24f28f3e">00119</a> <span class="keywordtype">int</span> <a class="code" href="../../d2/d04/ethercatconfig_8c.html#a8aa31990a858c7e049cfb4de24f28f3e" title="Find slave in standard configuration list ec_configlist[].">ec_findconfig</a>( <a class="code" href="../../d2/dbb/ethercattype_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> man, <a class="code" href="../../d2/dbb/ethercattype_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <span class="keywordtype">id</span>)
<a name="l00120"></a>00120 {
<a name="l00121"></a>00121   <span class="keywordtype">int</span> i = 0;
<a name="l00122"></a>00122 
<a name="l00123"></a>00123   <span class="keywordflow">do</span> 
<a name="l00124"></a>00124   {
<a name="l00125"></a>00125     i++;
<a name="l00126"></a>00126   } <span class="keywordflow">while</span> ( (<a class="code" href="../../d3/d50/ethercatconfiglist_8h.html#a1c525e82fb480dd24bebdf451cdf5d22">ec_configlist</a>[i].man != <a class="code" href="../../d3/d50/ethercatconfiglist_8h.html#aaef6c7c9200a688140ee21286ea5a9d2">EC_CONFIGEND</a>) &amp;&amp; 
<a name="l00127"></a>00127         ((<a class="code" href="../../d3/d50/ethercatconfiglist_8h.html#a1c525e82fb480dd24bebdf451cdf5d22">ec_configlist</a>[i].man != man) || (<a class="code" href="../../d3/d50/ethercatconfiglist_8h.html#a1c525e82fb480dd24bebdf451cdf5d22">ec_configlist</a>[i].<span class="keywordtype">id</span> != <span class="keywordtype">id</span>)) );
<a name="l00128"></a>00128   <span class="keywordflow">if</span> (<a class="code" href="../../d3/d50/ethercatconfiglist_8h.html#a1c525e82fb480dd24bebdf451cdf5d22">ec_configlist</a>[i].man == <a class="code" href="../../d3/d50/ethercatconfiglist_8h.html#aaef6c7c9200a688140ee21286ea5a9d2">EC_CONFIGEND</a>)
<a name="l00129"></a>00129     i = 0;
<a name="l00130"></a>00130   
<a name="l00131"></a>00131   <span class="keywordflow">return</span> i;
<a name="l00132"></a>00132 }
<a name="l00133"></a>00133 <span class="comment"></span>
<a name="l00134"></a>00134 <span class="comment">/** Enumerate and init all slaves.</span>
<a name="l00135"></a>00135 <span class="comment"> *</span>
<a name="l00136"></a>00136 <span class="comment"> * @param[in] usetable    = TRUE when using configtable to init slaves, FALSE otherwise</span>
<a name="l00137"></a>00137 <span class="comment"> * @return Workcounter of slave discover datagram = number of slaves found</span>
<a name="l00138"></a>00138 <span class="comment"> */</span>
<a name="l00139"></a><a class="code" href="../../d4/d03/ethercatconfig_8h.html#ae9128b2cb982fd03fae9105d746f8656">00139</a> <span class="keywordtype">int</span> <a class="code" href="../../d2/d04/ethercatconfig_8c.html#ae9128b2cb982fd03fae9105d746f8656" title="Enumerate and init all slaves.">ec_config_init</a>(<a class="code" href="../../d2/dbb/ethercattype_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> usetable)
<a name="l00140"></a>00140 {
<a name="l00141"></a>00141     <a class="code" href="../../d2/dbb/ethercattype_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> w, <a class="code" href="../../d1/da4/eepromtool_8c.html#a7f46665d1fe6d01a75a90942bb34cfaf">slave</a>, ADPh, configadr, mbx_wo, mbx_ro, mbx_l, mbx_rl, ssigen;
<a name="l00142"></a>00142     <a class="code" href="../../d2/dbb/ethercattype_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> topology, estat;
<a name="l00143"></a>00143     <a class="code" href="../../d2/dbb/ethercattype_8h.html#a259fa4834387bd68627ddf37bb3ebdb9">int16</a> topoc, slavec;
<a name="l00144"></a>00144     <a class="code" href="../../d2/dbb/ethercattype_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> b,h;
<a name="l00145"></a>00145   <a class="code" href="../../d2/dbb/ethercattype_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> zbuf[64];
<a name="l00146"></a>00146   <a class="code" href="../../d2/dbb/ethercattype_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> SMc;
<a name="l00147"></a>00147   <a class="code" href="../../d2/dbb/ethercattype_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> eedat;
<a name="l00148"></a>00148   <span class="keywordtype">int</span> <a class="code" href="../../d1/da4/eepromtool_8c.html#aa59bf150c9e0d285619f7c7e58c9942d">wkc</a>, cindex, nSM, lp;
<a name="l00149"></a>00149 
<a name="l00150"></a>00150   <a class="code" href="../../d2/d04/ethercatconfig_8c.html#a7f701d87af8db364450d02975b16cd5d">EC_PRINT</a>(<span class="stringliteral">&quot;ec_config_init %d\n&quot;</span>,usetable);
<a name="l00151"></a>00151     <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aa9c784abc9a4ede41d3d8d688b4a7dc5" title="number of slaves found on the network">ec_slavecount</a> = 0;
<a name="l00152"></a>00152   <span class="comment">/* clean ec_slave array */</span>
<a name="l00153"></a>00153   memset(&amp;<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>, 0x00, <span class="keyword">sizeof</span>(<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>));
<a name="l00154"></a>00154   memset(&amp;zbuf, 0x00, <span class="keyword">sizeof</span>(zbuf));
<a name="l00155"></a>00155   memset(&amp;<a class="code" href="../../d3/d6b/ethercatmain_8c.html#a2bdce50a46e56597354e404a55344934" title="slave group structure">ec_group</a>, 0x00, <span class="keyword">sizeof</span>(<a class="code" href="../../d3/d6b/ethercatmain_8c.html#a2bdce50a46e56597354e404a55344934" title="slave group structure">ec_group</a>));
<a name="l00156"></a>00156   <span class="keywordflow">for</span>(lp = 0; lp &lt; <a class="code" href="../../d8/d38/ethercatmain_8h.html#a1f13aca133c78710a901be88d513f692">EC_MAXGROUP</a>; lp++)
<a name="l00157"></a>00157   {
<a name="l00158"></a>00158     <a class="code" href="../../d3/d6b/ethercatmain_8c.html#a2bdce50a46e56597354e404a55344934" title="slave group structure">ec_group</a>[lp].<a class="code" href="../../dd/d43/structec__groupt.html#a7b832620a65130fdc17cf6a151410bd9" title="logical start address for this group">logstartaddr</a> = lp &lt;&lt; 16; <span class="comment">/* default start address per group entry */</span>
<a name="l00159"></a>00159   }
<a name="l00160"></a>00160     w = 0x0000;
<a name="l00161"></a>00161     wkc = <a class="code" href="../../d5/d74/ethercatbase_8c.html#a30d9ab75b270ba904509fb1af2b8dc17" title="BRD &amp;quot;broadcast read&amp;quot; primitive.">ec_BRD</a>(0x0000, <a class="code" href="../../d2/dbb/ethercattype_8h.html#adb49720dc49f7d4e4cf9adbf2948e409a1dfde6965182a2fb56b69d1c729e8f10">ECT_REG_TYPE</a>, <span class="keyword">sizeof</span>(w), &amp;w, <a class="code" href="../../d2/dbb/ethercattype_8h.html#aa4cedfded7cdf66e8ac5cc9cc08ecfb5" title="timeout value in us for return &amp;quot;safe&amp;quot; variant (f.e.">EC_TIMEOUTSAFE</a>);    <span class="comment">/* detect number of slaves */</span>
<a name="l00162"></a>00162     <span class="keywordflow">if</span> (wkc &gt; 0)
<a name="l00163"></a>00163     {
<a name="l00164"></a>00164         <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aa9c784abc9a4ede41d3d8d688b4a7dc5" title="number of slaves found on the network">ec_slavecount</a> = wkc;
<a name="l00165"></a>00165         b = 0x00;
<a name="l00166"></a>00166         <a class="code" href="../../d5/d74/ethercatbase_8c.html#a3ad29de613339c69a0b132114928b208" title="BRW &amp;quot;broadcast write&amp;quot; primitive.">ec_BWR</a>(0x0000, <a class="code" href="../../d2/dbb/ethercattype_8h.html#adb49720dc49f7d4e4cf9adbf2948e409a10dd4afb43089a4d782df858903fe0a9">ECT_REG_DLPORT</a>, <span class="keyword">sizeof</span>(b), &amp;b, <a class="code" href="../../d2/dbb/ethercattype_8h.html#a334e41422731fd6d427d2a7ec790779c" title="timeout value in us for tx frame to return to rx">EC_TIMEOUTRET</a>);   <span class="comment">/* deact loop manual */</span>
<a name="l00167"></a>00167         w = htoes(0x0004);
<a name="l00168"></a>00168         <a class="code" href="../../d5/d74/ethercatbase_8c.html#a3ad29de613339c69a0b132114928b208" title="BRW &amp;quot;broadcast write&amp;quot; primitive.">ec_BWR</a>(0x0000, <a class="code" href="../../d2/dbb/ethercattype_8h.html#adb49720dc49f7d4e4cf9adbf2948e409a803592d883d65cbf843ec814e0a8924d">ECT_REG_IRQMASK</a>, <span class="keyword">sizeof</span>(w), &amp;w, <a class="code" href="../../d2/dbb/ethercattype_8h.html#a334e41422731fd6d427d2a7ec790779c" title="timeout value in us for tx frame to return to rx">EC_TIMEOUTRET</a>);    <span class="comment">/* set IRQ mask */</span>
<a name="l00169"></a>00169         <a class="code" href="../../d5/d74/ethercatbase_8c.html#a3ad29de613339c69a0b132114928b208" title="BRW &amp;quot;broadcast write&amp;quot; primitive.">ec_BWR</a>(0x0000, <a class="code" href="../../d2/dbb/ethercattype_8h.html#adb49720dc49f7d4e4cf9adbf2948e409ac9c756f6b9248053c2163edc9430d398">ECT_REG_RXERR</a>, 8, &amp;zbuf, <a class="code" href="../../d2/dbb/ethercattype_8h.html#a334e41422731fd6d427d2a7ec790779c" title="timeout value in us for tx frame to return to rx">EC_TIMEOUTRET</a>);       <span class="comment">/* reset CRC counters */</span>
<a name="l00170"></a>00170         <a class="code" href="../../d5/d74/ethercatbase_8c.html#a3ad29de613339c69a0b132114928b208" title="BRW &amp;quot;broadcast write&amp;quot; primitive.">ec_BWR</a>(0x0000, <a class="code" href="../../d2/dbb/ethercattype_8h.html#adb49720dc49f7d4e4cf9adbf2948e409abf1da03289d47ff22ced968a1e4317b5">ECT_REG_FMMU0</a>, 16 * 3, &amp;zbuf, <a class="code" href="../../d2/dbb/ethercattype_8h.html#a334e41422731fd6d427d2a7ec790779c" title="timeout value in us for tx frame to return to rx">EC_TIMEOUTRET</a>);    <span class="comment">/* reset FMMU&#39;s */</span>
<a name="l00171"></a>00171         <a class="code" href="../../d5/d74/ethercatbase_8c.html#a3ad29de613339c69a0b132114928b208" title="BRW &amp;quot;broadcast write&amp;quot; primitive.">ec_BWR</a>(0x0000, <a class="code" href="../../d2/dbb/ethercattype_8h.html#adb49720dc49f7d4e4cf9adbf2948e409af4be5eba050aa6331760178d05b3e846">ECT_REG_SM0</a>, 8 * 4, &amp;zbuf, <a class="code" href="../../d2/dbb/ethercattype_8h.html#a334e41422731fd6d427d2a7ec790779c" title="timeout value in us for tx frame to return to rx">EC_TIMEOUTRET</a>);     <span class="comment">/* reset SyncM */</span>
<a name="l00172"></a>00172         <a class="code" href="../../d5/d74/ethercatbase_8c.html#a3ad29de613339c69a0b132114928b208" title="BRW &amp;quot;broadcast write&amp;quot; primitive.">ec_BWR</a>(0x0000, <a class="code" href="../../d2/dbb/ethercattype_8h.html#adb49720dc49f7d4e4cf9adbf2948e409a4d674a60a50587c638f1acaa6d92a1ba">ECT_REG_DCSYSTIME</a>, 4, &amp;zbuf, <a class="code" href="../../d2/dbb/ethercattype_8h.html#a334e41422731fd6d427d2a7ec790779c" title="timeout value in us for tx frame to return to rx">EC_TIMEOUTRET</a>);     <span class="comment">/* reset system time+ofs */</span>
<a name="l00173"></a>00173         w = htoes(0x1000);
<a name="l00174"></a>00174         <a class="code" href="../../d5/d74/ethercatbase_8c.html#a3ad29de613339c69a0b132114928b208" title="BRW &amp;quot;broadcast write&amp;quot; primitive.">ec_BWR</a>(0x0000, <a class="code" href="../../d2/dbb/ethercattype_8h.html#adb49720dc49f7d4e4cf9adbf2948e409a41eb7ae57a66dc367d70fe588f6867c3">ECT_REG_DCSPEEDCNT</a>, <span class="keyword">sizeof</span>(w), &amp;w, <a class="code" href="../../d2/dbb/ethercattype_8h.html#a334e41422731fd6d427d2a7ec790779c" title="timeout value in us for tx frame to return to rx">EC_TIMEOUTRET</a>);   <span class="comment">/* DC speedstart */</span>
<a name="l00175"></a>00175         w = htoes(0x0c00);
<a name="l00176"></a>00176         <a class="code" href="../../d5/d74/ethercatbase_8c.html#a3ad29de613339c69a0b132114928b208" title="BRW &amp;quot;broadcast write&amp;quot; primitive.">ec_BWR</a>(0x0000, <a class="code" href="../../d2/dbb/ethercattype_8h.html#adb49720dc49f7d4e4cf9adbf2948e409aac2934e6f32d6b45c7a868c38bdab406">ECT_REG_DCTIMEFILT</a>, <span class="keyword">sizeof</span>(w), &amp;w, <a class="code" href="../../d2/dbb/ethercattype_8h.html#a334e41422731fd6d427d2a7ec790779c" title="timeout value in us for tx frame to return to rx">EC_TIMEOUTRET</a>);   <span class="comment">/* DC filt expr */</span>
<a name="l00177"></a>00177         b = 0x00;
<a name="l00178"></a>00178         <a class="code" href="../../d5/d74/ethercatbase_8c.html#a3ad29de613339c69a0b132114928b208" title="BRW &amp;quot;broadcast write&amp;quot; primitive.">ec_BWR</a>(0x0000, <a class="code" href="../../d2/dbb/ethercattype_8h.html#adb49720dc49f7d4e4cf9adbf2948e409a2cf1b3dbbe08ff8dc8f3c09400178e55">ECT_REG_DLALIAS</a>, <span class="keyword">sizeof</span>(b), &amp;b, <a class="code" href="../../d2/dbb/ethercattype_8h.html#a334e41422731fd6d427d2a7ec790779c" title="timeout value in us for tx frame to return to rx">EC_TIMEOUTRET</a>);    <span class="comment">/* Ignore Alias register */</span>
<a name="l00179"></a>00179         b = <a class="code" href="../../d2/dbb/ethercattype_8h.html#ac93847b4c4f8ff2d123e3717d55358c1af6a3f8b7e667fe4ba0fbe6fd15f8000c" title="Init state.">EC_STATE_INIT</a> | <a class="code" href="../../d2/dbb/ethercattype_8h.html#ac93847b4c4f8ff2d123e3717d55358c1a5c592a738e13641d3c8195d172f8c077" title="Error or ACK error.">EC_STATE_ACK</a>;
<a name="l00180"></a>00180         <a class="code" href="../../d5/d74/ethercatbase_8c.html#a3ad29de613339c69a0b132114928b208" title="BRW &amp;quot;broadcast write&amp;quot; primitive.">ec_BWR</a>(0x0000, <a class="code" href="../../d2/dbb/ethercattype_8h.html#adb49720dc49f7d4e4cf9adbf2948e409a148befce8c8d150d28b6a93d37fe24c2">ECT_REG_ALCTL</a>, <span class="keyword">sizeof</span>(b), &amp;b, <a class="code" href="../../d2/dbb/ethercattype_8h.html#a334e41422731fd6d427d2a7ec790779c" title="timeout value in us for tx frame to return to rx">EC_TIMEOUTRET</a>);    <span class="comment">/* Reset all slaves to Init */</span>
<a name="l00181"></a>00181     b = 2;
<a name="l00182"></a>00182     <a class="code" href="../../d5/d74/ethercatbase_8c.html#a3ad29de613339c69a0b132114928b208" title="BRW &amp;quot;broadcast write&amp;quot; primitive.">ec_BWR</a>(0x0000, <a class="code" href="../../d2/dbb/ethercattype_8h.html#adb49720dc49f7d4e4cf9adbf2948e409a6f7eb31db1ad97ad91d1ac9e532cbc08">ECT_REG_EEPCFG</a>, <span class="keyword">sizeof</span>(b), &amp;b , <a class="code" href="../../d2/dbb/ethercattype_8h.html#a334e41422731fd6d427d2a7ec790779c" title="timeout value in us for tx frame to return to rx">EC_TIMEOUTRET</a>);    <span class="comment">/* force Eeprom from PDI */</span>
<a name="l00183"></a>00183     b = 0;
<a name="l00184"></a>00184     <a class="code" href="../../d5/d74/ethercatbase_8c.html#a3ad29de613339c69a0b132114928b208" title="BRW &amp;quot;broadcast write&amp;quot; primitive.">ec_BWR</a>(0x0000, <a class="code" href="../../d2/dbb/ethercattype_8h.html#adb49720dc49f7d4e4cf9adbf2948e409a6f7eb31db1ad97ad91d1ac9e532cbc08">ECT_REG_EEPCFG</a>, <span class="keyword">sizeof</span>(b), &amp;b , <a class="code" href="../../d2/dbb/ethercattype_8h.html#a334e41422731fd6d427d2a7ec790779c" title="timeout value in us for tx frame to return to rx">EC_TIMEOUTRET</a>);    <span class="comment">/* set Eeprom to master */</span>
<a name="l00185"></a>00185     
<a name="l00186"></a>00186         <span class="keywordflow">for</span> (slave = 1; slave &lt;= <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aa9c784abc9a4ede41d3d8d688b4a7dc5" title="number of slaves found on the network">ec_slavecount</a>; slave++)
<a name="l00187"></a>00187         {
<a name="l00188"></a>00188             ADPh = (<a class="code" href="../../d2/dbb/ethercattype_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a>)(1 - slave);
<a name="l00189"></a>00189             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a31e2bff1f6e664c0e3d4733364c8bfd7" title="Interface type.">Itype</a> = etohs(<a class="code" href="../../d5/d74/ethercatbase_8c.html#ae04f6096929eed658625620ba507b219" title="APRDw &amp;quot;auto increment address read&amp;quot; word return primitive.">ec_APRDw</a>(ADPh, <a class="code" href="../../d2/dbb/ethercattype_8h.html#adb49720dc49f7d4e4cf9adbf2948e409a016e1bd871180d792675ea89ba85a179">ECT_REG_PDICTL</a>, <a class="code" href="../../d2/dbb/ethercattype_8h.html#a334e41422731fd6d427d2a7ec790779c" title="timeout value in us for tx frame to return to rx">EC_TIMEOUTRET</a>)); <span class="comment">/* read interface type of slave */</span>
<a name="l00190"></a>00190       <span class="comment">/* a node offset is used to improve readibility of network frames */</span>
<a name="l00191"></a>00191       <span class="comment">/* this has no impact on the number of addressable slaves (auto wrap around) */</span>
<a name="l00192"></a>00192             <a class="code" href="../../d5/d74/ethercatbase_8c.html#aca3c5979b5549da9f4a6f441a74e132b" title="APWRw &amp;quot;auto increment address write&amp;quot; word primitive.">ec_APWRw</a>(ADPh, <a class="code" href="../../d2/dbb/ethercattype_8h.html#adb49720dc49f7d4e4cf9adbf2948e409a86eba8ec14620d231b533d126565c877">ECT_REG_STADR</a>, htoes(slave + <a class="code" href="../../d4/d03/ethercatconfig_8h.html#a6285e94b6d9e6aaf167ddaf1d186747d">EC_NODEOFFSET</a>) , <a class="code" href="../../d2/dbb/ethercattype_8h.html#a334e41422731fd6d427d2a7ec790779c" title="timeout value in us for tx frame to return to rx">EC_TIMEOUTRET</a>); <span class="comment">/* set node address of slave */</span>
<a name="l00193"></a>00193             <span class="keywordflow">if</span> (slave == 1) 
<a name="l00194"></a>00194         b = 1; <span class="comment">/* kill non ecat frames for first slave */</span>
<a name="l00195"></a>00195       <span class="keywordflow">else</span> 
<a name="l00196"></a>00196         b = 0; <span class="comment">/* pass all frames for following slaves */</span>
<a name="l00197"></a>00197             <a class="code" href="../../d5/d74/ethercatbase_8c.html#aca3c5979b5549da9f4a6f441a74e132b" title="APWRw &amp;quot;auto increment address write&amp;quot; word primitive.">ec_APWRw</a>(ADPh, <a class="code" href="../../d2/dbb/ethercattype_8h.html#adb49720dc49f7d4e4cf9adbf2948e409a05c70ad89934ec435482e43b18dbf8a3">ECT_REG_DLCTL</a>, htoes(b), <a class="code" href="../../d2/dbb/ethercattype_8h.html#a334e41422731fd6d427d2a7ec790779c" title="timeout value in us for tx frame to return to rx">EC_TIMEOUTRET</a>); <span class="comment">/* set non ecat frame behaviour */</span>
<a name="l00198"></a>00198             configadr = etohs(<a class="code" href="../../d5/d74/ethercatbase_8c.html#ae04f6096929eed658625620ba507b219" title="APRDw &amp;quot;auto increment address read&amp;quot; word return primitive.">ec_APRDw</a>(ADPh, <a class="code" href="../../d2/dbb/ethercattype_8h.html#adb49720dc49f7d4e4cf9adbf2948e409a86eba8ec14620d231b533d126565c877">ECT_REG_STADR</a>, <a class="code" href="../../d2/dbb/ethercattype_8h.html#a334e41422731fd6d427d2a7ec790779c" title="timeout value in us for tx frame to return to rx">EC_TIMEOUTRET</a>));
<a name="l00199"></a>00199             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#aba5576ebc3c34ee46d929c731269cae4" title="Configured address.">configadr</a> = configadr;
<a name="l00200"></a>00200       <a class="code" href="../../d5/d74/ethercatbase_8c.html#aac2dc2b5a39ace0793473ab89bb56c7d" title="FPRD &amp;quot;configured address read&amp;quot; primitive.">ec_FPRD</a>(configadr, <a class="code" href="../../d2/dbb/ethercattype_8h.html#adb49720dc49f7d4e4cf9adbf2948e409ae0b547547cbbcc1a9302846a91f292be">ECT_REG_ALIAS</a>, <span class="keyword">sizeof</span>(<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].aliasadr), &amp;<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].aliasadr, <a class="code" href="../../d2/dbb/ethercattype_8h.html#a334e41422731fd6d427d2a7ec790779c" title="timeout value in us for tx frame to return to rx">EC_TIMEOUTRET</a>);
<a name="l00201"></a>00201       <a class="code" href="../../d5/d74/ethercatbase_8c.html#aac2dc2b5a39ace0793473ab89bb56c7d" title="FPRD &amp;quot;configured address read&amp;quot; primitive.">ec_FPRD</a>(configadr, <a class="code" href="../../d2/dbb/ethercattype_8h.html#adb49720dc49f7d4e4cf9adbf2948e409abea30cd11205943adc68f20f3ba878a0">ECT_REG_EEPSTAT</a>, <span class="keyword">sizeof</span>(estat), &amp;estat, <a class="code" href="../../d2/dbb/ethercattype_8h.html#a334e41422731fd6d427d2a7ec790779c" title="timeout value in us for tx frame to return to rx">EC_TIMEOUTRET</a>);
<a name="l00202"></a>00202       estat = etohs(estat);
<a name="l00203"></a>00203       <span class="keywordflow">if</span> (estat &amp; <a class="code" href="../../d2/dbb/ethercattype_8h.html#a6a0a67b499eddc5c96fbc7f3fb09b4bd" title="EEprom state machine read size.">EC_ESTAT_R64</a>) <span class="comment">/* check if slave can read 8 byte chunks */</span>
<a name="l00204"></a>00204         <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a732bfab9cd64bb8cb85e9269ba5e1719" title="1 = 8 bytes per read, 0 = 4 bytes per read">eep_8byte</a> = 1;
<a name="l00205"></a>00205             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#ad920436309547d99e23cb8fd7b56b1bc" title="Read EEPROM from slave bypassing cache.">ec_readeeprom1</a>(slave, <a class="code" href="../../d2/dbb/ethercattype_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea8c9e4a41e1f55b587360b3d511093805">ECT_SII_MANUF</a>); <span class="comment">/* Manuf */</span>
<a name="l00206"></a>00206         }
<a name="l00207"></a>00207     <span class="keywordflow">for</span> (slave = 1; slave &lt;= <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aa9c784abc9a4ede41d3d8d688b4a7dc5" title="number of slaves found on the network">ec_slavecount</a>; slave++)
<a name="l00208"></a>00208         {
<a name="l00209"></a>00209             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#ab784095ec5ec4020524f35697b26220c" title="Manufacturer from EEprom.">eep_man</a> = etohl(<a class="code" href="../../d3/d6b/ethercatmain_8c.html#a31e35cc2f33ecf639db43c79850462ab" title="Read EEPROM from slave bypassing cache.">ec_readeeprom2</a>(slave, <a class="code" href="../../d2/dbb/ethercattype_8h.html#a8684bafce6bd5ae0676fd6440a832276" title="timeout value in us for EEPROM access">EC_TIMEOUTEEP</a>)); <span class="comment">/* Manuf */</span>
<a name="l00210"></a>00210             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#ad920436309547d99e23cb8fd7b56b1bc" title="Read EEPROM from slave bypassing cache.">ec_readeeprom1</a>(slave, <a class="code" href="../../d2/dbb/ethercattype_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea70a9f67186aa332c1105d50ca10c217f">ECT_SII_ID</a>); <span class="comment">/* ID */</span>
<a name="l00211"></a>00211         }
<a name="l00212"></a>00212         <span class="keywordflow">for</span> (slave = 1; slave &lt;= <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aa9c784abc9a4ede41d3d8d688b4a7dc5" title="number of slaves found on the network">ec_slavecount</a>; slave++)
<a name="l00213"></a>00213         {
<a name="l00214"></a>00214             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#ac88dbbd09c197c2f853e2f385386c614" title="ID from EEprom.">eep_id</a> = etohl(<a class="code" href="../../d3/d6b/ethercatmain_8c.html#a31e35cc2f33ecf639db43c79850462ab" title="Read EEPROM from slave bypassing cache.">ec_readeeprom2</a>(slave, <a class="code" href="../../d2/dbb/ethercattype_8h.html#a8684bafce6bd5ae0676fd6440a832276" title="timeout value in us for EEPROM access">EC_TIMEOUTEEP</a>)); <span class="comment">/* ID */</span>
<a name="l00215"></a>00215             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#ad920436309547d99e23cb8fd7b56b1bc" title="Read EEPROM from slave bypassing cache.">ec_readeeprom1</a>(slave, <a class="code" href="../../d2/dbb/ethercattype_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea167abdf5136fd905a5aa5665b914d5e0">ECT_SII_REV</a>); <span class="comment">/* revision */</span>
<a name="l00216"></a>00216         }
<a name="l00217"></a>00217         <span class="keywordflow">for</span> (slave = 1; slave &lt;= <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aa9c784abc9a4ede41d3d8d688b4a7dc5" title="number of slaves found on the network">ec_slavecount</a>; slave++)
<a name="l00218"></a>00218         {
<a name="l00219"></a>00219             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a0021f4779d9aa34d23aa93c2918480fb" title="revision from EEprom">eep_rev</a> = etohl(<a class="code" href="../../d3/d6b/ethercatmain_8c.html#a31e35cc2f33ecf639db43c79850462ab" title="Read EEPROM from slave bypassing cache.">ec_readeeprom2</a>(slave, <a class="code" href="../../d2/dbb/ethercattype_8h.html#a8684bafce6bd5ae0676fd6440a832276" title="timeout value in us for EEPROM access">EC_TIMEOUTEEP</a>)); <span class="comment">/* revision */</span>
<a name="l00220"></a>00220             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#ad920436309547d99e23cb8fd7b56b1bc" title="Read EEPROM from slave bypassing cache.">ec_readeeprom1</a>(slave, <a class="code" href="../../d2/dbb/ethercattype_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea59b36d0abd8d4cc148280c3fad106b38">ECT_SII_RXMBXADR</a>); <span class="comment">/* write mailbox address + mailboxsize */</span>
<a name="l00221"></a>00221         }
<a name="l00222"></a>00222         <span class="keywordflow">for</span> (slave = 1; slave &lt;= <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aa9c784abc9a4ede41d3d8d688b4a7dc5" title="number of slaves found on the network">ec_slavecount</a>; slave++)
<a name="l00223"></a>00223         {
<a name="l00224"></a>00224             eedat = etohl(<a class="code" href="../../d3/d6b/ethercatmain_8c.html#a31e35cc2f33ecf639db43c79850462ab" title="Read EEPROM from slave bypassing cache.">ec_readeeprom2</a>(slave, <a class="code" href="../../d2/dbb/ethercattype_8h.html#a8684bafce6bd5ae0676fd6440a832276" title="timeout value in us for EEPROM access">EC_TIMEOUTEEP</a>)); <span class="comment">/* write mailbox address and mailboxsize */</span>
<a name="l00225"></a>00225             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a767bfc34a96f5a5e8f0d4a79cea5973c" title="mailbox write offset">mbx_wo</a> = (<a class="code" href="../../d2/dbb/ethercattype_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a>)<a class="code" href="../../d2/dbb/ethercattype_8h.html#a639896c5e20b5ef7bff9b35bf1637dd0" title="Macro to get hi word of a dword.">LO_WORD</a>(eedat);
<a name="l00226"></a>00226             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a7fb4df087f429b1adc44fd370efbc69e" title="length of write mailbox in bytes, if no mailbox then 0">mbx_l</a> = (<a class="code" href="../../d2/dbb/ethercattype_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a>)<a class="code" href="../../d2/dbb/ethercattype_8h.html#a1b97e31e27113ee96f5d004497c81e7d" title="Macro to get hi word of a dword.">HI_WORD</a>(eedat);
<a name="l00227"></a>00227       <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].mbx_l &gt; 0) 
<a name="l00228"></a>00228               <a class="code" href="../../d3/d6b/ethercatmain_8c.html#ad920436309547d99e23cb8fd7b56b1bc" title="Read EEPROM from slave bypassing cache.">ec_readeeprom1</a>(slave, <a class="code" href="../../d2/dbb/ethercattype_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea75d0c7c8d1c466481f38d8c47eae499d">ECT_SII_TXMBXADR</a>); <span class="comment">/* read mailbox offset */</span>
<a name="l00229"></a>00229         }
<a name="l00230"></a>00230         <span class="keywordflow">for</span> (slave = 1; slave &lt;= <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aa9c784abc9a4ede41d3d8d688b4a7dc5" title="number of slaves found on the network">ec_slavecount</a>; slave++)
<a name="l00231"></a>00231         {
<a name="l00232"></a>00232       <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].mbx_l &gt; 0) 
<a name="l00233"></a>00233       {
<a name="l00234"></a>00234               eedat = etohl(<a class="code" href="../../d3/d6b/ethercatmain_8c.html#a31e35cc2f33ecf639db43c79850462ab" title="Read EEPROM from slave bypassing cache.">ec_readeeprom2</a>(slave, <a class="code" href="../../d2/dbb/ethercattype_8h.html#a8684bafce6bd5ae0676fd6440a832276" title="timeout value in us for EEPROM access">EC_TIMEOUTEEP</a>)); <span class="comment">/* read mailbox offset */</span>
<a name="l00235"></a>00235         <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a32b793aaa2c9fa6366767557715f7b73" title="mailbox read offset">mbx_ro</a> = (<a class="code" href="../../d2/dbb/ethercattype_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a>)<a class="code" href="../../d2/dbb/ethercattype_8h.html#a639896c5e20b5ef7bff9b35bf1637dd0" title="Macro to get hi word of a dword.">LO_WORD</a>(eedat); <span class="comment">/* read mailbox offset */</span>
<a name="l00236"></a>00236               <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a2d8db0ad1a181c515e9fcd0c55754d16" title="length of read mailbox in bytes">mbx_rl</a> = (<a class="code" href="../../d2/dbb/ethercattype_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a>)<a class="code" href="../../d2/dbb/ethercattype_8h.html#a1b97e31e27113ee96f5d004497c81e7d" title="Macro to get hi word of a dword.">HI_WORD</a>(eedat); <span class="comment">/*read mailbox length */</span>
<a name="l00237"></a>00237         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].mbx_rl == 0)
<a name="l00238"></a>00238                 <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a2d8db0ad1a181c515e9fcd0c55754d16" title="length of read mailbox in bytes">mbx_rl</a> = <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a7fb4df087f429b1adc44fd370efbc69e" title="length of write mailbox in bytes, if no mailbox then 0">mbx_l</a>;
<a name="l00239"></a>00239       }
<a name="l00240"></a>00240             configadr = <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#aba5576ebc3c34ee46d929c731269cae4" title="Configured address.">configadr</a>;
<a name="l00241"></a>00241             mbx_ro = <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a32b793aaa2c9fa6366767557715f7b73" title="mailbox read offset">mbx_ro</a>;
<a name="l00242"></a>00242             mbx_wo = <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a767bfc34a96f5a5e8f0d4a79cea5973c" title="mailbox write offset">mbx_wo</a>;
<a name="l00243"></a>00243             mbx_l = <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a7fb4df087f429b1adc44fd370efbc69e" title="length of write mailbox in bytes, if no mailbox then 0">mbx_l</a>;
<a name="l00244"></a>00244             mbx_rl = <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a2d8db0ad1a181c515e9fcd0c55754d16" title="length of read mailbox in bytes">mbx_rl</a>;
<a name="l00245"></a>00245             <span class="keywordflow">if</span> ((etohs(<a class="code" href="../../d5/d74/ethercatbase_8c.html#a1cebb240642f321d1f641e8a1ffe2fa4" title="FPRDw &amp;quot;configured address read&amp;quot; word return primitive.">ec_FPRDw</a>(configadr, <a class="code" href="../../d2/dbb/ethercattype_8h.html#adb49720dc49f7d4e4cf9adbf2948e409a10b728e2e7b4a4cb9a38fd595e526eef">ECT_REG_ESCSUP</a>, <a class="code" href="../../d2/dbb/ethercattype_8h.html#a334e41422731fd6d427d2a7ec790779c" title="timeout value in us for tx frame to return to rx">EC_TIMEOUTRET</a>)) &amp; 0x04) &gt; 0)  <span class="comment">/* Support DC? */</span>
<a name="l00246"></a>00246                 <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a704556ab093faee81b6ebf3436b57cbf" title="has DC capabillity">hasdc</a> = <a class="code" href="../../d2/dbb/ethercattype_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00247"></a>00247             <span class="keywordflow">else</span>
<a name="l00248"></a>00248                 <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a704556ab093faee81b6ebf3436b57cbf" title="has DC capabillity">hasdc</a> = <a class="code" href="../../d2/dbb/ethercattype_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00249"></a>00249             topology = etohs(<a class="code" href="../../d5/d74/ethercatbase_8c.html#a1cebb240642f321d1f641e8a1ffe2fa4" title="FPRDw &amp;quot;configured address read&amp;quot; word return primitive.">ec_FPRDw</a>(configadr, <a class="code" href="../../d2/dbb/ethercattype_8h.html#adb49720dc49f7d4e4cf9adbf2948e409a714cbe8d3763d69deea5e68f961ffda8">ECT_REG_DLSTAT</a>, <a class="code" href="../../d2/dbb/ethercattype_8h.html#a334e41422731fd6d427d2a7ec790779c" title="timeout value in us for tx frame to return to rx">EC_TIMEOUTRET</a>)); <span class="comment">/* extract topology from DL status */</span>
<a name="l00250"></a>00250       h = 0; 
<a name="l00251"></a>00251       b = 0;
<a name="l00252"></a>00252             <span class="keywordflow">if</span> ((topology &amp; 0x0300) == 0x0200) <span class="comment">/* port0 open and communication established */</span>
<a name="l00253"></a>00253             {
<a name="l00254"></a>00254                 h++;
<a name="l00255"></a>00255         b |= 0x01;
<a name="l00256"></a>00256             }
<a name="l00257"></a>00257             <span class="keywordflow">if</span> ((topology &amp; 0x0c00) == 0x0800) <span class="comment">/* port1 open and communication established */</span>
<a name="l00258"></a>00258             {
<a name="l00259"></a>00259                 h++;
<a name="l00260"></a>00260         b |= 0x02;
<a name="l00261"></a>00261             }
<a name="l00262"></a>00262             <span class="keywordflow">if</span> ((topology &amp; 0x3000) == 0x2000) <span class="comment">/* port2 open and communication established */</span>
<a name="l00263"></a>00263             {
<a name="l00264"></a>00264                 h++;
<a name="l00265"></a>00265         b |= 0x04;
<a name="l00266"></a>00266             }
<a name="l00267"></a>00267             <span class="keywordflow">if</span> ((topology &amp; 0xc000) == 0x8000) <span class="comment">/* port3 open and communication established */</span>
<a name="l00268"></a>00268             {
<a name="l00269"></a>00269                 h++;
<a name="l00270"></a>00270         b |= 0x08;
<a name="l00271"></a>00271             }
<a name="l00272"></a>00272             <span class="comment">/* ptype = Physical type*/</span>
<a name="l00273"></a>00273             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a320eb33123e1fbee3155f03395c3240e" title="Physical type; Ebus, EtherNet combinations.">ptype</a> = <a class="code" href="../../d2/dbb/ethercattype_8h.html#a7f0b90dcc53ad2c6975ed9601999c678" title="Macro to get low byte of a word.">LO_BYTE</a>(etohs(<a class="code" href="../../d5/d74/ethercatbase_8c.html#a1cebb240642f321d1f641e8a1ffe2fa4" title="FPRDw &amp;quot;configured address read&amp;quot; word return primitive.">ec_FPRDw</a>(configadr, <a class="code" href="../../d2/dbb/ethercattype_8h.html#adb49720dc49f7d4e4cf9adbf2948e409a66ebcbeda7f4b1797ffd23d581ca928f">ECT_REG_PORTDES</a>, <a class="code" href="../../d2/dbb/ethercattype_8h.html#a334e41422731fd6d427d2a7ec790779c" title="timeout value in us for tx frame to return to rx">EC_TIMEOUTRET</a>)));
<a name="l00274"></a>00274             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#ad83d0904fddf435c7a7657570fb89a14" title="topology: 1 to 3 links">topology</a> = h;
<a name="l00275"></a>00275       <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a37bec2140889c8a336f3cb40919fd4ef" title="active ports bitmap : ....3210 , set if respective port is active">activeports</a> = b;
<a name="l00276"></a>00276       <span class="comment">/* 0=no links, not possible             */</span>
<a name="l00277"></a>00277             <span class="comment">/* 1=1 link  , end of line              */</span>
<a name="l00278"></a>00278             <span class="comment">/* 2=2 links , one before and one after */</span>
<a name="l00279"></a>00279             <span class="comment">/* 3=3 links , split point              */</span>
<a name="l00280"></a>00280             <span class="comment">/* 4=4 links , cross point              */</span>
<a name="l00281"></a>00281             <span class="comment">/* search for parent */</span>
<a name="l00282"></a>00282             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a49941752cd3436f329955e946e0ea677" title="slave number for parent, 0=master">parent</a> = 0; <span class="comment">/* parent is master */</span>
<a name="l00283"></a>00283             <span class="keywordflow">if</span> (slave &gt; 1)
<a name="l00284"></a>00284             {
<a name="l00285"></a>00285                 topoc = 0; 
<a name="l00286"></a>00286                 slavec = slave - 1;
<a name="l00287"></a>00287                 <span class="keywordflow">do</span>
<a name="l00288"></a>00288                 {
<a name="l00289"></a>00289                 topology = <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slavec].<a class="code" href="../../da/dff/structec__slavet.html#ad83d0904fddf435c7a7657570fb89a14" title="topology: 1 to 3 links">topology</a>;
<a name="l00290"></a>00290                     <span class="keywordflow">if</span> (topology == 1)
<a name="l00291"></a>00291                         topoc--; <span class="comment">/* endpoint found */</span>
<a name="l00292"></a>00292                     <span class="keywordflow">if</span> (topology == 3)
<a name="l00293"></a>00293                         topoc++; <span class="comment">/* split found */</span>
<a name="l00294"></a>00294                     <span class="keywordflow">if</span> (topology == 4)
<a name="l00295"></a>00295                         topoc+=2; <span class="comment">/* cross found */</span>
<a name="l00296"></a>00296                     <span class="keywordflow">if</span> (((topoc &gt;= 0) &amp;&amp; (topology &gt; 1)) ||
<a name="l00297"></a>00297               (slavec == 1)) <span class="comment">/* parent found */</span>
<a name="l00298"></a>00298                     {
<a name="l00299"></a>00299                         <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a49941752cd3436f329955e946e0ea677" title="slave number for parent, 0=master">parent</a> = slavec;
<a name="l00300"></a>00300                         slavec = 1;
<a name="l00301"></a>00301                     }
<a name="l00302"></a>00302           slavec--;
<a name="l00303"></a>00303                 }
<a name="l00304"></a>00304                 <span class="keywordflow">while</span> (slavec &gt; 0);
<a name="l00305"></a>00305             }
<a name="l00306"></a>00306 
<a name="l00307"></a>00307             w = <a class="code" href="../../d3/d6b/ethercatmain_8c.html#a8f77918c0a6a32be1079a11119171901" title="Check actual slave state.">ec_statecheck</a>(slave, <a class="code" href="../../d2/dbb/ethercattype_8h.html#ac93847b4c4f8ff2d123e3717d55358c1af6a3f8b7e667fe4ba0fbe6fd15f8000c" title="Init state.">EC_STATE_INIT</a>,  <a class="code" href="../../d2/dbb/ethercattype_8h.html#ad62eda81b3771cefb501543b184d64ad" title="timeout value in us for check statechange">EC_TIMEOUTSTATE</a>); <span class="comment">//* check state change Init */</span>
<a name="l00308"></a>00308   
<a name="l00309"></a>00309       <span class="comment">/* set default mailbox configuration if slave has mailbox */</span>
<a name="l00310"></a>00310       <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].mbx_l&gt;0)
<a name="l00311"></a>00311       { 
<a name="l00312"></a>00312         <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a9c885335573b4cefcc34a6412b59e31d" title="SM type 0=unused 1=MbxWr 2=MbxRd 3=Outputs 4=Inputs.">SMtype</a>[0] = 1;
<a name="l00313"></a>00313         <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a9c885335573b4cefcc34a6412b59e31d" title="SM type 0=unused 1=MbxWr 2=MbxRd 3=Outputs 4=Inputs.">SMtype</a>[1] = 2;
<a name="l00314"></a>00314         <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a9c885335573b4cefcc34a6412b59e31d" title="SM type 0=unused 1=MbxWr 2=MbxRd 3=Outputs 4=Inputs.">SMtype</a>[2] = 3;
<a name="l00315"></a>00315         <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a9c885335573b4cefcc34a6412b59e31d" title="SM type 0=unused 1=MbxWr 2=MbxRd 3=Outputs 4=Inputs.">SMtype</a>[3] = 4;
<a name="l00316"></a>00316         <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a44e9a0bc7021d7d4753e0beffd97ebf0" title="SM structure.">SM</a>[0].<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html#af8ece4638fc47a8aa61f0956e5c76379">StartAddr</a> = htoes(<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].mbx_wo);
<a name="l00317"></a>00317         <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a44e9a0bc7021d7d4753e0beffd97ebf0" title="SM structure.">SM</a>[0].<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html#a349b76f3faff161cf96ba1989dc2f245">SMlength</a> = htoes(<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].mbx_l);
<a name="l00318"></a>00318         <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a44e9a0bc7021d7d4753e0beffd97ebf0" title="SM structure.">SM</a>[0].<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html#a969346d8513f58a611a5f0f47935d5e8">SMflags</a> = htoel(<a class="code" href="../../d2/d04/ethercatconfig_8c.html#a7ffdfc0c1550e70c5579eb049e15a990" title="standard SM0 flags configuration for mailbox slaves">EC_DEFAULTMBXSM0</a>);
<a name="l00319"></a>00319         <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a44e9a0bc7021d7d4753e0beffd97ebf0" title="SM structure.">SM</a>[1].<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html#af8ece4638fc47a8aa61f0956e5c76379">StartAddr</a> = htoes(<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].mbx_ro);
<a name="l00320"></a>00320         <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a44e9a0bc7021d7d4753e0beffd97ebf0" title="SM structure.">SM</a>[1].<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html#a349b76f3faff161cf96ba1989dc2f245">SMlength</a> = htoes(<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].mbx_rl);
<a name="l00321"></a>00321         <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a44e9a0bc7021d7d4753e0beffd97ebf0" title="SM structure.">SM</a>[1].<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html#a969346d8513f58a611a5f0f47935d5e8">SMflags</a> = htoel(<a class="code" href="../../d2/d04/ethercatconfig_8c.html#a46051caffcdf0610f7aa0a5abef7920c" title="standard SM1 flags configuration for mailbox slaves">EC_DEFAULTMBXSM1</a>);
<a name="l00322"></a>00322         <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a85c0ad9ecaf69986953fc0fa20da790f" title="mailbox supported protocols">mbx_proto</a> = <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aacc964b3a092b666f8011717be911d35" title="Read EEPROM from slave bypassing cache.">ec_readeeprom</a> (slave, <a class="code" href="../../d2/dbb/ethercattype_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea1db84239e968edcf9d43e8d9e7a86efc">ECT_SII_MBXPROTO</a>, <a class="code" href="../../d2/dbb/ethercattype_8h.html#a8684bafce6bd5ae0676fd6440a832276" title="timeout value in us for EEPROM access">EC_TIMEOUTEEP</a>);
<a name="l00323"></a>00323       } 
<a name="l00324"></a>00324       cindex = 0;
<a name="l00325"></a>00325       <span class="comment">/* use configuration table ? */</span>
<a name="l00326"></a>00326       <span class="keywordflow">if</span> (usetable)
<a name="l00327"></a>00327       {
<a name="l00328"></a>00328         cindex = <a class="code" href="../../d2/d04/ethercatconfig_8c.html#a8aa31990a858c7e049cfb4de24f28f3e" title="Find slave in standard configuration list ec_configlist[].">ec_findconfig</a>( <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].eep_man, <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].eep_id );
<a name="l00329"></a>00329         <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#ac2dd8b5ba155b461acb4ee0df1f717d8" title="link to config table">configindex</a>= cindex;
<a name="l00330"></a>00330       }
<a name="l00331"></a>00331       <span class="comment">/* slave found in configuration table ? */</span>
<a name="l00332"></a>00332       <span class="keywordflow">if</span> (cindex)
<a name="l00333"></a>00333       {
<a name="l00334"></a>00334         <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a7a5d277253adfe3bab8fafe799a88df5" title="Device type.">Dtype</a> = <a class="code" href="../../d3/d50/ethercatconfiglist_8h.html#a1c525e82fb480dd24bebdf451cdf5d22">ec_configlist</a>[cindex].<a class="code" href="../../de/dae/structec__configlist__t.html#a97833c4bca1f3b5bc40ff7b3bf4b3809" title="Data type.">Dtype</a>;        
<a name="l00335"></a>00335         strcpy( <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].name ,<a class="code" href="../../d3/d50/ethercatconfiglist_8h.html#a1c525e82fb480dd24bebdf451cdf5d22">ec_configlist</a>[cindex].name);
<a name="l00336"></a>00336         <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a476276ad037266d880ff367a79ee9c66" title="input bits">Ibits</a> = <a class="code" href="../../d3/d50/ethercatconfiglist_8h.html#a1c525e82fb480dd24bebdf451cdf5d22">ec_configlist</a>[cindex].<a class="code" href="../../de/dae/structec__configlist__t.html#a476276ad037266d880ff367a79ee9c66" title="Input bits.">Ibits</a>;
<a name="l00337"></a>00337         <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#aa1da8dcd1b53ecb6f8f4a9ef70c7502b" title="output bits">Obits</a> = <a class="code" href="../../d3/d50/ethercatconfiglist_8h.html#a1c525e82fb480dd24bebdf451cdf5d22">ec_configlist</a>[cindex].<a class="code" href="../../de/dae/structec__configlist__t.html#aa1da8dcd1b53ecb6f8f4a9ef70c7502b" title="Output bits.">Obits</a>;
<a name="l00338"></a>00338         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].Obits)
<a name="l00339"></a>00339           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a544df355db01c529dc5e4309b0ed0217" title="FMMU0 function.">FMMU0func</a> = 1;
<a name="l00340"></a>00340         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].Ibits)
<a name="l00341"></a>00341           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#ac85241fd0fae0b71d9aa76323d2181af" title="FMMU1 function.">FMMU1func</a> = 2;
<a name="l00342"></a>00342         <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a7950e5af0de131f09ba968b5dfb429dd" title="FMMU structure.">FMMU</a>[0].FMMUactive = <a class="code" href="../../d3/d50/ethercatconfiglist_8h.html#a1c525e82fb480dd24bebdf451cdf5d22">ec_configlist</a>[cindex].<a class="code" href="../../de/dae/structec__configlist__t.html#aaeaa0bbb04a38dae9c48760c3c16b4c7" title="FMMU 0 activation.">FM0ac</a>;
<a name="l00343"></a>00343         <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a7950e5af0de131f09ba968b5dfb429dd" title="FMMU structure.">FMMU</a>[1].FMMUactive = <a class="code" href="../../d3/d50/ethercatconfiglist_8h.html#a1c525e82fb480dd24bebdf451cdf5d22">ec_configlist</a>[cindex].<a class="code" href="../../de/dae/structec__configlist__t.html#a1b6302df3a251cfc696664c4ae691dad" title="FMMU 1 activation.">FM1ac</a>;
<a name="l00344"></a>00344         <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a44e9a0bc7021d7d4753e0beffd97ebf0" title="SM structure.">SM</a>[2].<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html#af8ece4638fc47a8aa61f0956e5c76379">StartAddr</a> = htoes(<a class="code" href="../../d3/d50/ethercatconfiglist_8h.html#a1c525e82fb480dd24bebdf451cdf5d22">ec_configlist</a>[cindex].SM2a);
<a name="l00345"></a>00345         <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a44e9a0bc7021d7d4753e0beffd97ebf0" title="SM structure.">SM</a>[2].<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html#a969346d8513f58a611a5f0f47935d5e8">SMflags</a> = htoel(<a class="code" href="../../d3/d50/ethercatconfiglist_8h.html#a1c525e82fb480dd24bebdf451cdf5d22">ec_configlist</a>[cindex].SM2f);
<a name="l00346"></a>00346         <span class="comment">/* simple (no mailbox) output slave found ? */</span>
<a name="l00347"></a>00347         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].Obits &amp;&amp; !<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].SM[2].StartAddr)
<a name="l00348"></a>00348         {
<a name="l00349"></a>00349           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a44e9a0bc7021d7d4753e0beffd97ebf0" title="SM structure.">SM</a>[0].<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html#af8ece4638fc47a8aa61f0956e5c76379">StartAddr</a> = htoes(0x0f00);
<a name="l00350"></a>00350           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a44e9a0bc7021d7d4753e0beffd97ebf0" title="SM structure.">SM</a>[0].<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html#a349b76f3faff161cf96ba1989dc2f245">SMlength</a> = htoes((<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].Obits + 7) / 8);
<a name="l00351"></a>00351           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a44e9a0bc7021d7d4753e0beffd97ebf0" title="SM structure.">SM</a>[0].<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html#a969346d8513f58a611a5f0f47935d5e8">SMflags</a> = htoel(<a class="code" href="../../d2/d04/ethercatconfig_8c.html#af7063e832d749d4cbaa55317092ca5cc" title="standard SM0 flags configuration for digital output slaves">EC_DEFAULTDOSM0</a>);     
<a name="l00352"></a>00352           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a7950e5af0de131f09ba968b5dfb429dd" title="FMMU structure.">FMMU</a>[0].FMMUactive = 1;
<a name="l00353"></a>00353           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a7950e5af0de131f09ba968b5dfb429dd" title="FMMU structure.">FMMU</a>[0].FMMUtype = 2;
<a name="l00354"></a>00354           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a9c885335573b4cefcc34a6412b59e31d" title="SM type 0=unused 1=MbxWr 2=MbxRd 3=Outputs 4=Inputs.">SMtype</a>[0] = 3;
<a name="l00355"></a>00355         }
<a name="l00356"></a>00356         <span class="comment">/* complex output slave */</span>
<a name="l00357"></a>00357         <span class="keywordflow">else</span>
<a name="l00358"></a>00358         {
<a name="l00359"></a>00359           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a44e9a0bc7021d7d4753e0beffd97ebf0" title="SM structure.">SM</a>[2].<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html#a349b76f3faff161cf96ba1989dc2f245">SMlength</a> = htoes((<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].Obits + 7) / 8);
<a name="l00360"></a>00360           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a9c885335573b4cefcc34a6412b59e31d" title="SM type 0=unused 1=MbxWr 2=MbxRd 3=Outputs 4=Inputs.">SMtype</a>[2] = 3;
<a name="l00361"></a>00361         } 
<a name="l00362"></a>00362         <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a44e9a0bc7021d7d4753e0beffd97ebf0" title="SM structure.">SM</a>[3].<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html#af8ece4638fc47a8aa61f0956e5c76379">StartAddr</a> = htoes(<a class="code" href="../../d3/d50/ethercatconfiglist_8h.html#a1c525e82fb480dd24bebdf451cdf5d22">ec_configlist</a>[cindex].SM3a);
<a name="l00363"></a>00363         <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a44e9a0bc7021d7d4753e0beffd97ebf0" title="SM structure.">SM</a>[3].<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html#a969346d8513f58a611a5f0f47935d5e8">SMflags</a> = htoel(<a class="code" href="../../d3/d50/ethercatconfiglist_8h.html#a1c525e82fb480dd24bebdf451cdf5d22">ec_configlist</a>[cindex].SM3f);
<a name="l00364"></a>00364         <span class="comment">/* simple (no mailbox) input slave found ? */</span>
<a name="l00365"></a>00365         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].Ibits &amp;&amp; !<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].SM[3].StartAddr)
<a name="l00366"></a>00366         {
<a name="l00367"></a>00367           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a44e9a0bc7021d7d4753e0beffd97ebf0" title="SM structure.">SM</a>[1].<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html#af8ece4638fc47a8aa61f0956e5c76379">StartAddr</a> = htoes(0x1000);
<a name="l00368"></a>00368           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a44e9a0bc7021d7d4753e0beffd97ebf0" title="SM structure.">SM</a>[1].<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html#a349b76f3faff161cf96ba1989dc2f245">SMlength</a> = htoes((<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].Ibits + 7) / 8);
<a name="l00369"></a>00369           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a44e9a0bc7021d7d4753e0beffd97ebf0" title="SM structure.">SM</a>[1].<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html#a969346d8513f58a611a5f0f47935d5e8">SMflags</a> = htoel(0x00000000);      
<a name="l00370"></a>00370           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a7950e5af0de131f09ba968b5dfb429dd" title="FMMU structure.">FMMU</a>[1].FMMUactive = 1;
<a name="l00371"></a>00371           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a7950e5af0de131f09ba968b5dfb429dd" title="FMMU structure.">FMMU</a>[1].FMMUtype = 1;
<a name="l00372"></a>00372           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a9c885335573b4cefcc34a6412b59e31d" title="SM type 0=unused 1=MbxWr 2=MbxRd 3=Outputs 4=Inputs.">SMtype</a>[1] = 4;
<a name="l00373"></a>00373         }
<a name="l00374"></a>00374         <span class="comment">/* complex input slave */</span>
<a name="l00375"></a>00375         <span class="keywordflow">else</span>
<a name="l00376"></a>00376         {
<a name="l00377"></a>00377           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a44e9a0bc7021d7d4753e0beffd97ebf0" title="SM structure.">SM</a>[3].<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html#a349b76f3faff161cf96ba1989dc2f245">SMlength</a> = htoes((<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].Ibits + 7) / 8);
<a name="l00378"></a>00378           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a9c885335573b4cefcc34a6412b59e31d" title="SM type 0=unused 1=MbxWr 2=MbxRd 3=Outputs 4=Inputs.">SMtype</a>[3] = 4;
<a name="l00379"></a>00379         } 
<a name="l00380"></a>00380       }
<a name="l00381"></a>00381       <span class="comment">/* slave not in configuration table, find out via SII */</span>
<a name="l00382"></a>00382       <span class="keywordflow">else</span>
<a name="l00383"></a>00383       {
<a name="l00384"></a>00384         ssigen = <a class="code" href="../../d3/d6b/ethercatmain_8c.html#af44cb7b11dccd4ea221079ae0a8138e8" title="Find SII section header in slave EEPROM.">ec_siifind</a>(slave, <a class="code" href="../../d2/dbb/ethercattype_8h.html#ac36f475ca5b446f4fde4c9b90bec77c8acede3e04c8eb080f31c8a79586f02b6f" title="SII category general.">ECT_SII_GENERAL</a>);
<a name="l00385"></a>00385         <span class="comment">/* SII general section */</span>
<a name="l00386"></a>00386         <span class="keywordflow">if</span> (ssigen)
<a name="l00387"></a>00387                 {
<a name="l00388"></a>00388           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a480dbac5b71a0a4bc329aa8788995f4b" title="CoE details.">CoEdetails</a> = <a class="code" href="../../d3/d6b/ethercatmain_8c.html#a6c314f9524aa84af885f1e6426b71148" title="Read one byte from slave EEPROM via cache.">ec_siigetbyte</a>(slave, ssigen + 0x07);
<a name="l00389"></a>00389           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#aecd9af46148a5913a9dba337a9ced34f" title="FoE details.">FoEdetails</a> = <a class="code" href="../../d3/d6b/ethercatmain_8c.html#a6c314f9524aa84af885f1e6426b71148" title="Read one byte from slave EEPROM via cache.">ec_siigetbyte</a>(slave, ssigen + 0x08);
<a name="l00390"></a>00390           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#afcf0e59d86c05382957fb934b5ec2150" title="EoE details.">EoEdetails</a> = <a class="code" href="../../d3/d6b/ethercatmain_8c.html#a6c314f9524aa84af885f1e6426b71148" title="Read one byte from slave EEPROM via cache.">ec_siigetbyte</a>(slave, ssigen + 0x09);
<a name="l00391"></a>00391           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#af783a0500e329371f6f6e4fb482a13e4" title="SoE details.">SoEdetails</a> = <a class="code" href="../../d3/d6b/ethercatmain_8c.html#a6c314f9524aa84af885f1e6426b71148" title="Read one byte from slave EEPROM via cache.">ec_siigetbyte</a>(slave, ssigen + 0x0a);
<a name="l00392"></a>00392           <span class="keywordflow">if</span>((<a class="code" href="../../d3/d6b/ethercatmain_8c.html#a6c314f9524aa84af885f1e6426b71148" title="Read one byte from slave EEPROM via cache.">ec_siigetbyte</a>(slave, ssigen + 0x0d) &amp; 0x02) &gt; 0)
<a name="l00393"></a>00393           {
<a name="l00394"></a>00394             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a4ce389f3e3a4918cc55c08ff070ed600" title="if &amp;gt;0 block use of LRW in processdata">blockLRW</a> = 1;
<a name="l00395"></a>00395             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[0].<a class="code" href="../../da/dff/structec__slavet.html#a4ce389f3e3a4918cc55c08ff070ed600" title="if &amp;gt;0 block use of LRW in processdata">blockLRW</a>++;           
<a name="l00396"></a>00396           } 
<a name="l00397"></a>00397           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a0a212af1a40cb6ad6c188a451997e3dc" title="E-bus current.">Ebuscurrent</a> = <a class="code" href="../../d3/d6b/ethercatmain_8c.html#a6c314f9524aa84af885f1e6426b71148" title="Read one byte from slave EEPROM via cache.">ec_siigetbyte</a>(slave, ssigen + 0x0e);
<a name="l00398"></a>00398           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a0a212af1a40cb6ad6c188a451997e3dc" title="E-bus current.">Ebuscurrent</a> += <a class="code" href="../../d3/d6b/ethercatmain_8c.html#a6c314f9524aa84af885f1e6426b71148" title="Read one byte from slave EEPROM via cache.">ec_siigetbyte</a>(slave, ssigen + 0x0f) &lt;&lt; 8;
<a name="l00399"></a>00399           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[0].<a class="code" href="../../da/dff/structec__slavet.html#a0a212af1a40cb6ad6c188a451997e3dc" title="E-bus current.">Ebuscurrent</a> += <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a0a212af1a40cb6ad6c188a451997e3dc" title="E-bus current.">Ebuscurrent</a>;
<a name="l00400"></a>00400                 }
<a name="l00401"></a>00401         <span class="comment">/* SII strings section */</span>
<a name="l00402"></a>00402         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6b/ethercatmain_8c.html#af44cb7b11dccd4ea221079ae0a8138e8" title="Find SII section header in slave EEPROM.">ec_siifind</a>(slave, <a class="code" href="../../d2/dbb/ethercattype_8h.html#ac36f475ca5b446f4fde4c9b90bec77c8af250e5ba38d5f1420ee05e2da1f866c0" title="SII category strings.">ECT_SII_STRING</a>) &gt; 0)
<a name="l00403"></a>00403                     <a class="code" href="../../d3/d6b/ethercatmain_8c.html#a4fe43f91402e635e7087b9f1e09d7703" title="Get string from SII string section in slave EEPROM.">ec_siistring</a>(<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].name, slave, 1);
<a name="l00404"></a>00404         <span class="comment">/* no name for slave found, use constructed name */</span>
<a name="l00405"></a>00405                 <span class="keywordflow">else</span>
<a name="l00406"></a>00406                 {
<a name="l00407"></a>00407                     sprintf(<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].name, <span class="stringliteral">&quot;? M:%8.8x I:%8.8x&quot;</span>,
<a name="l00408"></a>00408                     (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].eep_man, (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].eep_id);
<a name="l00409"></a>00409                 }
<a name="l00410"></a>00410         <span class="comment">/* SII SM section */</span>
<a name="l00411"></a>00411         nSM = <a class="code" href="../../d3/d6b/ethercatmain_8c.html#a54c0c0d13f6c7b38e98ab91f4db29514" title="Get SM data from SII SM section in slave EEPROM.">ec_siiSM</a> (slave,&amp;ec_SM);
<a name="l00412"></a>00412         <span class="keywordflow">if</span> (nSM&gt;0)
<a name="l00413"></a>00413         { 
<a name="l00414"></a>00414           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a44e9a0bc7021d7d4753e0beffd97ebf0" title="SM structure.">SM</a>[0].<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html#af8ece4638fc47a8aa61f0956e5c76379">StartAddr</a> = htoes(ec_SM.<a class="code" href="../../de/d35/structec__eeprom_s_mt.html#a5cea89c3ea23b79bb601189e717251f7">PhStart</a>);
<a name="l00415"></a>00415           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a44e9a0bc7021d7d4753e0beffd97ebf0" title="SM structure.">SM</a>[0].<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html#a349b76f3faff161cf96ba1989dc2f245">SMlength</a> = htoes(ec_SM.<a class="code" href="../../de/d35/structec__eeprom_s_mt.html#a7e5e36fd01beb50acd0a7482d54fcf7c">Plength</a>);
<a name="l00416"></a>00416           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a44e9a0bc7021d7d4753e0beffd97ebf0" title="SM structure.">SM</a>[0].<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html#a969346d8513f58a611a5f0f47935d5e8">SMflags</a> = htoel((ec_SM.<a class="code" href="../../de/d35/structec__eeprom_s_mt.html#a70f0f9c7b06477ee9217a0097ac283bb">Creg</a>) + (ec_SM.<a class="code" href="../../de/d35/structec__eeprom_s_mt.html#a3dfd55eacb8202b3a99d5a2a8913b430">Activate</a> &lt;&lt; 16));
<a name="l00417"></a>00417           SMc = 1;
<a name="l00418"></a>00418           <span class="keywordflow">while</span> ((SMc &lt; <a class="code" href="../../d8/d38/ethercatmain_8h.html#a76097f1d16afaffe412d6f3d864ac749">EC_MAXSM</a>) &amp;&amp;  <a class="code" href="../../d3/d6b/ethercatmain_8c.html#acfb749a5fbaaa6d560204757be2170f5" title="Get next SM data from SII SM section in slave EEPROM.">ec_siiSMnext</a>(slave, &amp;ec_SM, SMc))
<a name="l00419"></a>00419           {
<a name="l00420"></a>00420             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a44e9a0bc7021d7d4753e0beffd97ebf0" title="SM structure.">SM</a>[SMc].<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html#af8ece4638fc47a8aa61f0956e5c76379">StartAddr</a> = htoes(ec_SM.<a class="code" href="../../de/d35/structec__eeprom_s_mt.html#a5cea89c3ea23b79bb601189e717251f7">PhStart</a>);
<a name="l00421"></a>00421             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a44e9a0bc7021d7d4753e0beffd97ebf0" title="SM structure.">SM</a>[SMc].<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html#a349b76f3faff161cf96ba1989dc2f245">SMlength</a> = htoes(ec_SM.<a class="code" href="../../de/d35/structec__eeprom_s_mt.html#a7e5e36fd01beb50acd0a7482d54fcf7c">Plength</a>);
<a name="l00422"></a>00422             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a44e9a0bc7021d7d4753e0beffd97ebf0" title="SM structure.">SM</a>[SMc].<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html#a969346d8513f58a611a5f0f47935d5e8">SMflags</a> = htoel((ec_SM.<a class="code" href="../../de/d35/structec__eeprom_s_mt.html#a70f0f9c7b06477ee9217a0097ac283bb">Creg</a>) + (ec_SM.<a class="code" href="../../de/d35/structec__eeprom_s_mt.html#a3dfd55eacb8202b3a99d5a2a8913b430">Activate</a> &lt;&lt; 16));
<a name="l00423"></a>00423             SMc++;
<a name="l00424"></a>00424           } 
<a name="l00425"></a>00425         } 
<a name="l00426"></a>00426         <span class="comment">/* SII FMMU section */</span>
<a name="l00427"></a>00427                 <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6b/ethercatmain_8c.html#ab382409c9f74891f82e87dcc7fad875e" title="Get FMMU data from SII FMMU section in slave EEPROM.">ec_siiFMMU</a>(slave, &amp;ec_FMMU))
<a name="l00428"></a>00428         {
<a name="l00429"></a>00429           <span class="keywordflow">if</span> (ec_FMMU.<a class="code" href="../../d6/ddd/structec__eeprom_f_m_m_ut.html#aa85efbc1b29023a1cb56ca7e6ec9b417">FMMU0</a> !=0xff) 
<a name="l00430"></a>00430             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a544df355db01c529dc5e4309b0ed0217" title="FMMU0 function.">FMMU0func</a> = ec_FMMU.<a class="code" href="../../d6/ddd/structec__eeprom_f_m_m_ut.html#aa85efbc1b29023a1cb56ca7e6ec9b417">FMMU0</a>;
<a name="l00431"></a>00431           <span class="keywordflow">if</span> (ec_FMMU.<a class="code" href="../../d6/ddd/structec__eeprom_f_m_m_ut.html#aae020e9d0388764326166abc6f2ae10f">FMMU1</a> !=0xff) 
<a name="l00432"></a>00432             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#ac85241fd0fae0b71d9aa76323d2181af" title="FMMU1 function.">FMMU1func</a> = ec_FMMU.<a class="code" href="../../d6/ddd/structec__eeprom_f_m_m_ut.html#aae020e9d0388764326166abc6f2ae10f">FMMU1</a>;
<a name="l00433"></a>00433           <span class="keywordflow">if</span> (ec_FMMU.<a class="code" href="../../d6/ddd/structec__eeprom_f_m_m_ut.html#a080d7ef14a82ff734668ec82dbcda6c0">FMMU2</a> !=0xff) 
<a name="l00434"></a>00434             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a4a5afcfb900381692eae870b23be660c" title="FMMU2 function.">FMMU2func</a> = ec_FMMU.<a class="code" href="../../d6/ddd/structec__eeprom_f_m_m_ut.html#a080d7ef14a82ff734668ec82dbcda6c0">FMMU2</a>;
<a name="l00435"></a>00435           <span class="keywordflow">if</span> (ec_FMMU.<a class="code" href="../../d6/ddd/structec__eeprom_f_m_m_ut.html#a0d687668e0cf743b007411e476a1559f">FMMU3</a> !=0xff) 
<a name="l00436"></a>00436             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#ac2ae359bf71d33f70956f35169f4b7dc" title="FMMU3 function.">FMMU3func</a> = ec_FMMU.<a class="code" href="../../d6/ddd/structec__eeprom_f_m_m_ut.html#a0d687668e0cf743b007411e476a1559f">FMMU3</a>;
<a name="l00437"></a>00437         } 
<a name="l00438"></a>00438       } 
<a name="l00439"></a>00439 
<a name="l00440"></a>00440       <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].mbx_l &gt; 0)
<a name="l00441"></a>00441       {
<a name="l00442"></a>00442         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].SM[0].StartAddr == 0x0000) <span class="comment">/* should never happen */</span>
<a name="l00443"></a>00443         {
<a name="l00444"></a>00444           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a44e9a0bc7021d7d4753e0beffd97ebf0" title="SM structure.">SM</a>[0].<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html#af8ece4638fc47a8aa61f0956e5c76379">StartAddr</a> = htoes(0x1000);
<a name="l00445"></a>00445           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a44e9a0bc7021d7d4753e0beffd97ebf0" title="SM structure.">SM</a>[0].<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html#a349b76f3faff161cf96ba1989dc2f245">SMlength</a> = htoes(0x0080);
<a name="l00446"></a>00446           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a44e9a0bc7021d7d4753e0beffd97ebf0" title="SM structure.">SM</a>[0].<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html#a969346d8513f58a611a5f0f47935d5e8">SMflags</a> = htoel(<a class="code" href="../../d2/d04/ethercatconfig_8c.html#a7ffdfc0c1550e70c5579eb049e15a990" title="standard SM0 flags configuration for mailbox slaves">EC_DEFAULTMBXSM0</a>);
<a name="l00447"></a>00447           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a9c885335573b4cefcc34a6412b59e31d" title="SM type 0=unused 1=MbxWr 2=MbxRd 3=Outputs 4=Inputs.">SMtype</a>[0] = 1;          
<a name="l00448"></a>00448         }     
<a name="l00449"></a>00449         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].SM[1].StartAddr == 0x0000) <span class="comment">/* should never happen */</span>
<a name="l00450"></a>00450         {
<a name="l00451"></a>00451           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a44e9a0bc7021d7d4753e0beffd97ebf0" title="SM structure.">SM</a>[1].<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html#af8ece4638fc47a8aa61f0956e5c76379">StartAddr</a> = htoes(0x1080);
<a name="l00452"></a>00452           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a44e9a0bc7021d7d4753e0beffd97ebf0" title="SM structure.">SM</a>[1].<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html#a349b76f3faff161cf96ba1989dc2f245">SMlength</a> = htoes(0x0080);
<a name="l00453"></a>00453           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a44e9a0bc7021d7d4753e0beffd97ebf0" title="SM structure.">SM</a>[1].<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html#a969346d8513f58a611a5f0f47935d5e8">SMflags</a> = htoel(<a class="code" href="../../d2/d04/ethercatconfig_8c.html#a46051caffcdf0610f7aa0a5abef7920c" title="standard SM1 flags configuration for mailbox slaves">EC_DEFAULTMBXSM1</a>);
<a name="l00454"></a>00454           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a9c885335573b4cefcc34a6412b59e31d" title="SM type 0=unused 1=MbxWr 2=MbxRd 3=Outputs 4=Inputs.">SMtype</a>[1] = 2;
<a name="l00455"></a>00455         }     
<a name="l00456"></a>00456         <span class="comment">/* program SM0 mailbox in for slave */</span>
<a name="l00457"></a>00457         <a class="code" href="../../d5/d74/ethercatbase_8c.html#aa2fe58363a824f15838718ee31f11ffc" title="FPWR &amp;quot;configured address write&amp;quot; primitive.">ec_FPWR</a> (configadr, <a class="code" href="../../d2/dbb/ethercattype_8h.html#adb49720dc49f7d4e4cf9adbf2948e409af4be5eba050aa6331760178d05b3e846">ECT_REG_SM0</a>, <span class="keyword">sizeof</span>(<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html" title="SDO structure, not to be confused with EcSDOserviceT.">ec_smt</a>), &amp;<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].SM[0], <a class="code" href="../../d2/dbb/ethercattype_8h.html#a334e41422731fd6d427d2a7ec790779c" title="timeout value in us for tx frame to return to rx">EC_TIMEOUTRET</a>);
<a name="l00458"></a>00458         <span class="comment">/* program SM1 mailbox out for slave */</span>
<a name="l00459"></a>00459         <span class="comment">// usleep(1000); // was needed for NETX (needs internal time after SM update)</span>
<a name="l00460"></a>00460         <a class="code" href="../../d5/d74/ethercatbase_8c.html#aa2fe58363a824f15838718ee31f11ffc" title="FPWR &amp;quot;configured address write&amp;quot; primitive.">ec_FPWR</a> (configadr, <a class="code" href="../../d2/dbb/ethercattype_8h.html#adb49720dc49f7d4e4cf9adbf2948e409aa403b9ec89cccb09f2867511d55e26f8">ECT_REG_SM1</a>, <span class="keyword">sizeof</span>(<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html" title="SDO structure, not to be confused with EcSDOserviceT.">ec_smt</a>), &amp;<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].SM[1], <a class="code" href="../../d2/dbb/ethercattype_8h.html#a334e41422731fd6d427d2a7ec790779c" title="timeout value in us for tx frame to return to rx">EC_TIMEOUTRET</a>);
<a name="l00461"></a>00461       } 
<a name="l00462"></a>00462       <a class="code" href="../../d5/d74/ethercatbase_8c.html#a2fc76bd01a00a0f6da9fb3927eabc24d" title="FPWR &amp;quot;configured address write&amp;quot; primitive.">ec_FPWRw</a>(configadr, <a class="code" href="../../d2/dbb/ethercattype_8h.html#adb49720dc49f7d4e4cf9adbf2948e409a148befce8c8d150d28b6a93d37fe24c2">ECT_REG_ALCTL</a>, htoes(<a class="code" href="../../d2/dbb/ethercattype_8h.html#ac93847b4c4f8ff2d123e3717d55358c1a70c159f70b2c6c4799874eb72b73a6e6" title="Pre-operational.">EC_STATE_PRE_OP</a> | <a class="code" href="../../d2/dbb/ethercattype_8h.html#ac93847b4c4f8ff2d123e3717d55358c1a5c592a738e13641d3c8195d172f8c077" title="Error or ACK error.">EC_STATE_ACK</a>) , <a class="code" href="../../d2/dbb/ethercattype_8h.html#a334e41422731fd6d427d2a7ec790779c" title="timeout value in us for tx frame to return to rx">EC_TIMEOUTRET</a>); <span class="comment">/* set preop status */</span>
<a name="l00463"></a>00463     }
<a name="l00464"></a>00464   } 
<a name="l00465"></a>00465     <span class="keywordflow">return</span> wkc;
<a name="l00466"></a>00466 }
<a name="l00467"></a>00467 <span class="comment"></span>
<a name="l00468"></a>00468 <span class="comment">/** Map all PDOs in one group of slaves to IOmap.</span>
<a name="l00469"></a>00469 <span class="comment"> *</span>
<a name="l00470"></a>00470 <span class="comment"> * @param[out] pIOmap   = pointer to IOmap  </span>
<a name="l00471"></a>00471 <span class="comment"> * @param[in]  group    = group to map, 0 = all groups  </span>
<a name="l00472"></a>00472 <span class="comment"> * @return IOmap size</span>
<a name="l00473"></a>00473 <span class="comment"> */</span>
<a name="l00474"></a><a class="code" href="../../d4/d03/ethercatconfig_8h.html#ae1120a5cace4aa56cf753977ccd37b8d">00474</a> <span class="keywordtype">int</span> <a class="code" href="../../d2/d04/ethercatconfig_8c.html#ae1120a5cace4aa56cf753977ccd37b8d" title="Map all PDOs in one group of slaves to IOmap.">ec_config_map_group</a>(<span class="keywordtype">void</span> *pIOmap, <a class="code" href="../../d2/dbb/ethercattype_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> group)
<a name="l00475"></a>00475 {
<a name="l00476"></a>00476     <a class="code" href="../../d2/dbb/ethercattype_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> <a class="code" href="../../d1/da4/eepromtool_8c.html#a7f46665d1fe6d01a75a90942bb34cfaf">slave</a>, configadr;
<a name="l00477"></a>00477   <span class="keywordtype">int</span> Isize, Osize, BitCount, ByteCount, FMMUsize, FMMUdone;
<a name="l00478"></a>00478   <a class="code" href="../../d2/dbb/ethercattype_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> SMlength;
<a name="l00479"></a>00479     <a class="code" href="../../d2/dbb/ethercattype_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> BitPos, EndAddr;
<a name="l00480"></a>00480   <a class="code" href="../../d2/dbb/ethercattype_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> SMc, FMMUc;
<a name="l00481"></a>00481   <a class="code" href="../../d2/dbb/ethercattype_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> LogAddr = 0;
<a name="l00482"></a>00482   <a class="code" href="../../d2/dbb/ethercattype_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> oLogAddr = 0;
<a name="l00483"></a>00483   <a class="code" href="../../d2/dbb/ethercattype_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> diff;
<a name="l00484"></a>00484   <span class="keywordtype">int</span> nSM, rval;
<a name="l00485"></a>00485   <a class="code" href="../../d9/de1/structec__eeprom_p_d_ot.html" title="record to store rxPDO and txPDO table from eeprom">ec_eepromPDOt</a> eepPDO;
<a name="l00486"></a>00486   <a class="code" href="../../d2/dbb/ethercattype_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> currentsegment = 0;
<a name="l00487"></a>00487   <a class="code" href="../../d2/dbb/ethercattype_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> segmentsize = 0;
<a name="l00488"></a>00488 
<a name="l00489"></a>00489   <span class="keywordflow">if</span> ((<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aa9c784abc9a4ede41d3d8d688b4a7dc5" title="number of slaves found on the network">ec_slavecount</a> &gt; 0) &amp;&amp; (group &lt; <a class="code" href="../../d8/d38/ethercatmain_8h.html#a1f13aca133c78710a901be88d513f692">EC_MAXGROUP</a>))
<a name="l00490"></a>00490   { 
<a name="l00491"></a>00491     <a class="code" href="../../d2/d04/ethercatconfig_8c.html#a7f701d87af8db364450d02975b16cd5d">EC_PRINT</a>(<span class="stringliteral">&quot;ec_config_map_group IOmap:%p group:%d\n&quot;</span>, pIOmap, group);
<a name="l00492"></a>00492     LogAddr = <a class="code" href="../../d3/d6b/ethercatmain_8c.html#a2bdce50a46e56597354e404a55344934" title="slave group structure">ec_group</a>[group].<a class="code" href="../../dd/d43/structec__groupt.html#a7b832620a65130fdc17cf6a151410bd9" title="logical start address for this group">logstartaddr</a>;
<a name="l00493"></a>00493     oLogAddr = LogAddr;
<a name="l00494"></a>00494     BitPos = 0;
<a name="l00495"></a>00495     <a class="code" href="../../d3/d6b/ethercatmain_8c.html#a2bdce50a46e56597354e404a55344934" title="slave group structure">ec_group</a>[group].<a class="code" href="../../dd/d43/structec__groupt.html#aaffe2511250ab048b15ffd2849b18eef" title="IO segegments used.">nsegments</a> = 0;
<a name="l00496"></a>00496     <a class="code" href="../../d3/d6b/ethercatmain_8c.html#a2bdce50a46e56597354e404a55344934" title="slave group structure">ec_group</a>[group].<a class="code" href="../../dd/d43/structec__groupt.html#a37e76382a31a05df2cdf604285074532" title="Expected workcounter.">expectedWKC</a> = 0;
<a name="l00497"></a>00497 
<a name="l00498"></a>00498     <span class="comment">/* find output mapping of slave and program FMMU */</span>
<a name="l00499"></a>00499     <span class="keywordflow">for</span> (slave = 1; slave &lt;= <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aa9c784abc9a4ede41d3d8d688b4a7dc5" title="number of slaves found on the network">ec_slavecount</a>; slave++)
<a name="l00500"></a>00500         {
<a name="l00501"></a>00501             configadr = <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#aba5576ebc3c34ee46d929c731269cae4" title="Configured address.">configadr</a>;
<a name="l00502"></a>00502 
<a name="l00503"></a>00503       <a class="code" href="../../d3/d6b/ethercatmain_8c.html#a8f77918c0a6a32be1079a11119171901" title="Check actual slave state.">ec_statecheck</a>(slave, <a class="code" href="../../d2/dbb/ethercattype_8h.html#ac93847b4c4f8ff2d123e3717d55358c1a70c159f70b2c6c4799874eb72b73a6e6" title="Pre-operational.">EC_STATE_PRE_OP</a>, <a class="code" href="../../d2/dbb/ethercattype_8h.html#ad62eda81b3771cefb501543b184d64ad" title="timeout value in us for check statechange">EC_TIMEOUTSTATE</a>); <span class="comment">/* check state change pre-op */</span>
<a name="l00504"></a>00504 
<a name="l00505"></a>00505       <a class="code" href="../../d2/d04/ethercatconfig_8c.html#a7f701d87af8db364450d02975b16cd5d">EC_PRINT</a>(<span class="stringliteral">&quot; &gt;Slave %d, configadr %x, state %2.2x\n&quot;</span>,
<a name="l00506"></a>00506           slave, <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].configadr, <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].state);
<a name="l00507"></a>00507 
<a name="l00508"></a>00508       <span class="keywordflow">if</span> (!group || (group == <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].group))
<a name="l00509"></a>00509       { 
<a name="l00510"></a>00510       
<a name="l00511"></a>00511       <span class="comment">/* if slave not found in configlist find IO mapping in slave self */</span>
<a name="l00512"></a>00512       <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].configindex)
<a name="l00513"></a>00513       {
<a name="l00514"></a>00514         Isize = 0;
<a name="l00515"></a>00515         Osize = 0;
<a name="l00516"></a>00516         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].mbx_proto &amp; <a class="code" href="../../d8/d38/ethercatmain_8h.html#a671b2165339642633c0c65259b05d292">ECT_MBXPROT_COE</a>) <span class="comment">/* has CoE */</span>
<a name="l00517"></a>00517         {
<a name="l00518"></a>00518           <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].CoEdetails &amp; <a class="code" href="../../d8/d38/ethercatmain_8h.html#af2944dd1912329eae23960d4880a976a">ECT_COEDET_SDOCA</a>) <span class="comment">/* has Complete Access */</span>
<a name="l00519"></a>00519             <span class="comment">/* read PDO mapping via CoE and use Complete Access */</span>
<a name="l00520"></a>00520             rval = <a class="code" href="../../d2/dff/ethercatcoe_8c.html#a8770ccad0cea1ea8f7dbbd5bfc58b83d" title="CoE read PDO mapping in Complete Access mode (CA).">ec_readPDOmapCA</a>(slave, &amp;Osize, &amp;Isize);
<a name="l00521"></a>00521           <span class="keywordflow">else</span>
<a name="l00522"></a>00522             <span class="comment">/* read PDO mapping via CoE */</span>
<a name="l00523"></a>00523             rval = <a class="code" href="../../d2/dff/ethercatcoe_8c.html#a15ab60b8e11aa61d67480faa19d0ab28" title="CoE read PDO mapping.">ec_readPDOmap</a>(slave, &amp;Osize, &amp;Isize);
<a name="l00524"></a>00524           <a class="code" href="../../d2/d04/ethercatconfig_8c.html#a7f701d87af8db364450d02975b16cd5d">EC_PRINT</a>(<span class="stringliteral">&quot;  CoE Osize:%d Isize:%d\n&quot;</span>, Osize, Isize);
<a name="l00525"></a>00525         }
<a name="l00526"></a>00526         <span class="keywordflow">if</span> ((!Isize &amp;&amp; !Osize) &amp;&amp; (<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].mbx_proto &amp; <a class="code" href="../../d8/d38/ethercatmain_8h.html#aa368d54261ee8db8d4bd11e2750bb30c">ECT_MBXPROT_SOE</a>)) <span class="comment">/* has SoE */</span>
<a name="l00527"></a>00527         {
<a name="l00528"></a>00528           <span class="comment">/* read AT / MDT mapping via SoE */</span>
<a name="l00529"></a>00529           rval = <a class="code" href="../../d8/dfd/ethercatsoe_8c.html#acb454e12b2034f0121a534de57b0e869" title="SoE read AT and MTD mapping.">ec_readIDNmap</a>(slave, &amp;Osize, &amp;Isize);
<a name="l00530"></a>00530           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a44e9a0bc7021d7d4753e0beffd97ebf0" title="SM structure.">SM</a>[2].<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html#a349b76f3faff161cf96ba1989dc2f245">SMlength</a> = htoes((Osize + 7) / 8);
<a name="l00531"></a>00531           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a44e9a0bc7021d7d4753e0beffd97ebf0" title="SM structure.">SM</a>[3].<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html#a349b76f3faff161cf96ba1989dc2f245">SMlength</a> = htoes((Isize + 7) / 8);
<a name="l00532"></a>00532           <a class="code" href="../../d2/d04/ethercatconfig_8c.html#a7f701d87af8db364450d02975b16cd5d">EC_PRINT</a>(<span class="stringliteral">&quot;  SoE Osize:%d Isize:%d\n&quot;</span>, Osize, Isize);
<a name="l00533"></a>00533         }
<a name="l00534"></a>00534         <span class="keywordflow">if</span> (!Isize &amp;&amp; !Osize) <span class="comment">/* find PDO mapping by SII */</span>
<a name="l00535"></a>00535         {
<a name="l00536"></a>00536           memset(&amp;eepPDO, 0, <span class="keyword">sizeof</span>(eepPDO));
<a name="l00537"></a>00537           Isize = (int)<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aef972d9668958da9db3c350e159caddb" title="Get PDO data from SII PDO section in slave EEPROM.">ec_siiPDO</a> (slave, &amp;eepPDO, 0);
<a name="l00538"></a>00538           <a class="code" href="../../d2/d04/ethercatconfig_8c.html#a7f701d87af8db364450d02975b16cd5d">EC_PRINT</a>(<span class="stringliteral">&quot;  SII Isize:%d\n&quot;</span>, Isize);          
<a name="l00539"></a>00539           <span class="keywordflow">for</span>( nSM=0 ; nSM &lt; <a class="code" href="../../d8/d38/ethercatmain_8h.html#a76097f1d16afaffe412d6f3d864ac749">EC_MAXSM</a> ; nSM++ )
<a name="l00540"></a>00540           { 
<a name="l00541"></a>00541             <span class="keywordflow">if</span> (eepPDO.<a class="code" href="../../d9/de1/structec__eeprom_p_d_ot.html#a91a434c6802e7286c6283d6ee6c74a83">SMbitsize</a>[nSM] &gt; 0)
<a name="l00542"></a>00542             { 
<a name="l00543"></a>00543               <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a44e9a0bc7021d7d4753e0beffd97ebf0" title="SM structure.">SM</a>[nSM].<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html#a349b76f3faff161cf96ba1989dc2f245">SMlength</a> =  htoes((eepPDO.<a class="code" href="../../d9/de1/structec__eeprom_p_d_ot.html#a91a434c6802e7286c6283d6ee6c74a83">SMbitsize</a>[nSM] + 7) / 8);
<a name="l00544"></a>00544               <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a9c885335573b4cefcc34a6412b59e31d" title="SM type 0=unused 1=MbxWr 2=MbxRd 3=Outputs 4=Inputs.">SMtype</a>[nSM] = 4;
<a name="l00545"></a>00545               <a class="code" href="../../d2/d04/ethercatconfig_8c.html#a7f701d87af8db364450d02975b16cd5d">EC_PRINT</a>(<span class="stringliteral">&quot;    SM%d length %d\n&quot;</span>, nSM, eepPDO.<a class="code" href="../../d9/de1/structec__eeprom_p_d_ot.html#a91a434c6802e7286c6283d6ee6c74a83">SMbitsize</a>[nSM]);
<a name="l00546"></a>00546             } 
<a name="l00547"></a>00547           } 
<a name="l00548"></a>00548           Osize = (int)<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aef972d9668958da9db3c350e159caddb" title="Get PDO data from SII PDO section in slave EEPROM.">ec_siiPDO</a> (slave, &amp;eepPDO, 1);
<a name="l00549"></a>00549           <a class="code" href="../../d2/d04/ethercatconfig_8c.html#a7f701d87af8db364450d02975b16cd5d">EC_PRINT</a>(<span class="stringliteral">&quot;  SII Osize:%d\n&quot;</span>, Osize);          
<a name="l00550"></a>00550           <span class="keywordflow">for</span>( nSM=0 ; nSM &lt; EC_MAXSM ; nSM++ )
<a name="l00551"></a>00551           { 
<a name="l00552"></a>00552             <span class="keywordflow">if</span> (eepPDO.<a class="code" href="../../d9/de1/structec__eeprom_p_d_ot.html#a91a434c6802e7286c6283d6ee6c74a83">SMbitsize</a>[nSM] &gt; 0)
<a name="l00553"></a>00553             { 
<a name="l00554"></a>00554               <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a44e9a0bc7021d7d4753e0beffd97ebf0" title="SM structure.">SM</a>[nSM].<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html#a349b76f3faff161cf96ba1989dc2f245">SMlength</a> =  htoes((eepPDO.<a class="code" href="../../d9/de1/structec__eeprom_p_d_ot.html#a91a434c6802e7286c6283d6ee6c74a83">SMbitsize</a>[nSM] + 7) / 8);
<a name="l00555"></a>00555               <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a9c885335573b4cefcc34a6412b59e31d" title="SM type 0=unused 1=MbxWr 2=MbxRd 3=Outputs 4=Inputs.">SMtype</a>[nSM] = 3;
<a name="l00556"></a>00556               <a class="code" href="../../d2/d04/ethercatconfig_8c.html#a7f701d87af8db364450d02975b16cd5d">EC_PRINT</a>(<span class="stringliteral">&quot;    SM%d length %d\n&quot;</span>, nSM, eepPDO.<a class="code" href="../../d9/de1/structec__eeprom_p_d_ot.html#a91a434c6802e7286c6283d6ee6c74a83">SMbitsize</a>[nSM]);
<a name="l00557"></a>00557             } 
<a name="l00558"></a>00558           } 
<a name="l00559"></a>00559         }
<a name="l00560"></a>00560         <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#aa1da8dcd1b53ecb6f8f4a9ef70c7502b" title="output bits">Obits</a> = Osize;
<a name="l00561"></a>00561         <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a476276ad037266d880ff367a79ee9c66" title="input bits">Ibits</a> = Isize;
<a name="l00562"></a>00562         <a class="code" href="../../d2/d04/ethercatconfig_8c.html#a7f701d87af8db364450d02975b16cd5d">EC_PRINT</a>(<span class="stringliteral">&quot;     ISIZE:%d %d OSIZE:%d\n&quot;</span>, <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].Ibits, Isize,<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].Obits);
<a name="l00563"></a>00563         
<a name="l00564"></a>00564       }
<a name="l00565"></a>00565 
<a name="l00566"></a>00566       <a class="code" href="../../d2/d04/ethercatconfig_8c.html#a7f701d87af8db364450d02975b16cd5d">EC_PRINT</a>(<span class="stringliteral">&quot;  SM programming\n&quot;</span>);  
<a name="l00567"></a>00567       <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].mbx_l &amp;&amp; <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].SM[0].StartAddr)
<a name="l00568"></a>00568         {
<a name="l00569"></a>00569         <a class="code" href="../../d5/d74/ethercatbase_8c.html#aa2fe58363a824f15838718ee31f11ffc" title="FPWR &amp;quot;configured address write&amp;quot; primitive.">ec_FPWR</a> (configadr, <a class="code" href="../../d2/dbb/ethercattype_8h.html#adb49720dc49f7d4e4cf9adbf2948e409af4be5eba050aa6331760178d05b3e846">ECT_REG_SM0</a>, <span class="keyword">sizeof</span>(<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html" title="SDO structure, not to be confused with EcSDOserviceT.">ec_smt</a>), &amp;<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].SM[0], <a class="code" href="../../d2/dbb/ethercattype_8h.html#a334e41422731fd6d427d2a7ec790779c" title="timeout value in us for tx frame to return to rx">EC_TIMEOUTRET</a>);
<a name="l00570"></a>00570         <a class="code" href="../../d2/d04/ethercatconfig_8c.html#a7f701d87af8db364450d02975b16cd5d">EC_PRINT</a>(<span class="stringliteral">&quot;    SM0 Type:%d StartAddr:%4.4x Flags:%8.8x\n&quot;</span>, 
<a name="l00571"></a>00571             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].SMtype[0], <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].SM[0].StartAddr, <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].SM[0].SMflags);   
<a name="l00572"></a>00572         }
<a name="l00573"></a>00573       <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].mbx_l &amp;&amp; <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].SM[1].StartAddr)
<a name="l00574"></a>00574         {
<a name="l00575"></a>00575         <a class="code" href="../../d5/d74/ethercatbase_8c.html#aa2fe58363a824f15838718ee31f11ffc" title="FPWR &amp;quot;configured address write&amp;quot; primitive.">ec_FPWR</a> (configadr, <a class="code" href="../../d2/dbb/ethercattype_8h.html#adb49720dc49f7d4e4cf9adbf2948e409aa403b9ec89cccb09f2867511d55e26f8">ECT_REG_SM1</a>, <span class="keyword">sizeof</span>(<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html" title="SDO structure, not to be confused with EcSDOserviceT.">ec_smt</a>), &amp;<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].SM[1], <a class="code" href="../../d2/dbb/ethercattype_8h.html#a334e41422731fd6d427d2a7ec790779c" title="timeout value in us for tx frame to return to rx">EC_TIMEOUTRET</a>);
<a name="l00576"></a>00576         <a class="code" href="../../d2/d04/ethercatconfig_8c.html#a7f701d87af8db364450d02975b16cd5d">EC_PRINT</a>(<span class="stringliteral">&quot;    SM1 Type:%d StartAddr:%4.4x Flags:%8.8x\n&quot;</span>, 
<a name="l00577"></a>00577             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].SMtype[1], <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].SM[1].StartAddr, <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].SM[1].SMflags);   
<a name="l00578"></a>00578         }
<a name="l00579"></a>00579       <span class="comment">/* program SM2 to SMx */</span>
<a name="l00580"></a>00580       <span class="keywordflow">for</span>( nSM = 2 ; nSM &lt; <a class="code" href="../../d8/d38/ethercatmain_8h.html#a76097f1d16afaffe412d6f3d864ac749">EC_MAXSM</a> ; nSM++ )
<a name="l00581"></a>00581       { 
<a name="l00582"></a>00582         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].SM[nSM].StartAddr)
<a name="l00583"></a>00583         {
<a name="l00584"></a>00584           <span class="comment">/* check if SM length is zero -&gt; clear enable flag */</span>
<a name="l00585"></a>00585           <span class="keywordflow">if</span>( <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].SM[nSM].SMlength == 0) 
<a name="l00586"></a>00586             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a44e9a0bc7021d7d4753e0beffd97ebf0" title="SM structure.">SM</a>[nSM].<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html#a969346d8513f58a611a5f0f47935d5e8">SMflags</a> = htoel( etohl(<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].SM[nSM].SMflags) &amp; <a class="code" href="../../d8/d38/ethercatmain_8h.html#a8cd7e4b598e806452fa8a816d13526e0">EC_SMENABLEMASK</a>);
<a name="l00587"></a>00587           <a class="code" href="../../d5/d74/ethercatbase_8c.html#aa2fe58363a824f15838718ee31f11ffc" title="FPWR &amp;quot;configured address write&amp;quot; primitive.">ec_FPWR</a> (configadr, <a class="code" href="../../d2/dbb/ethercattype_8h.html#adb49720dc49f7d4e4cf9adbf2948e409af4be5eba050aa6331760178d05b3e846">ECT_REG_SM0</a> + (nSM * <span class="keyword">sizeof</span>(<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html" title="SDO structure, not to be confused with EcSDOserviceT.">ec_smt</a>)), <span class="keyword">sizeof</span>(<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html" title="SDO structure, not to be confused with EcSDOserviceT.">ec_smt</a>), &amp;<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].SM[nSM], <a class="code" href="../../d2/dbb/ethercattype_8h.html#a334e41422731fd6d427d2a7ec790779c" title="timeout value in us for tx frame to return to rx">EC_TIMEOUTRET</a>);
<a name="l00588"></a>00588           <a class="code" href="../../d2/d04/ethercatconfig_8c.html#a7f701d87af8db364450d02975b16cd5d">EC_PRINT</a>(<span class="stringliteral">&quot;    SM%d Type:%d StartAddr:%4.4x Flags:%8.8x\n&quot;</span>, nSM,
<a name="l00589"></a>00589               <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].SMtype[nSM], <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].SM[nSM].StartAddr, <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].SM[nSM].SMflags);   
<a name="l00590"></a>00590         }
<a name="l00591"></a>00591       }
<a name="l00592"></a>00592       <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].Ibits &gt; 7)
<a name="l00593"></a>00593         <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a4057eeb48537a3d8c6472e58ef2af257" title="input bytes, if Ibits &amp;lt; 8 then Ibytes = 0">Ibytes</a> = (<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a476276ad037266d880ff367a79ee9c66" title="input bits">Ibits</a> + 7) / 8;
<a name="l00594"></a>00594       <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].Obits &gt; 7)
<a name="l00595"></a>00595         <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#aa4793d235fa626746b8260e94e48287b" title="output bytes, if Obits &amp;lt; 8 then Obytes = 0">Obytes</a> = (<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#aa1da8dcd1b53ecb6f8f4a9ef70c7502b" title="output bits">Obits</a> + 7) / 8;
<a name="l00596"></a>00596 
<a name="l00597"></a>00597       FMMUc = <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a02cf783622672a2069212597471223bc" title="first unused FMMU">FMMUunused</a>;
<a name="l00598"></a>00598       SMc = 0;
<a name="l00599"></a>00599       BitCount = 0;
<a name="l00600"></a>00600       ByteCount = 0;
<a name="l00601"></a>00601       EndAddr = 0;
<a name="l00602"></a>00602       FMMUsize = 0;
<a name="l00603"></a>00603       FMMUdone = 0;
<a name="l00604"></a>00604       <span class="comment">/* create output mapping */</span>
<a name="l00605"></a>00605       <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].Obits)
<a name="l00606"></a>00606       {
<a name="l00607"></a>00607         <a class="code" href="../../d2/d04/ethercatconfig_8c.html#a7f701d87af8db364450d02975b16cd5d">EC_PRINT</a>(<span class="stringliteral">&quot;  OUTPUT MAPPING\n&quot;</span>);
<a name="l00608"></a>00608         <span class="comment">/* search for SM that contribute to the output mapping */</span>
<a name="l00609"></a>00609         <span class="keywordflow">while</span> ( (SMc &lt; (EC_MAXSM - 1)) &amp;&amp; (FMMUdone &lt; ((<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].Obits + 7) / 8)))
<a name="l00610"></a>00610         { 
<a name="l00611"></a>00611           <a class="code" href="../../d2/d04/ethercatconfig_8c.html#a7f701d87af8db364450d02975b16cd5d">EC_PRINT</a>(<span class="stringliteral">&quot;    FMMU %d\n&quot;</span>, FMMUc);
<a name="l00612"></a>00612           <span class="keywordflow">while</span> ( (SMc &lt; (EC_MAXSM - 1)) &amp;&amp; (<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].SMtype[SMc] != 3)) SMc++;
<a name="l00613"></a>00613           <a class="code" href="../../d2/d04/ethercatconfig_8c.html#a7f701d87af8db364450d02975b16cd5d">EC_PRINT</a>(<span class="stringliteral">&quot;      SM%d\n&quot;</span>, SMc);
<a name="l00614"></a>00614           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a7950e5af0de131f09ba968b5dfb429dd" title="FMMU structure.">FMMU</a>[FMMUc].PhysStart = <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a44e9a0bc7021d7d4753e0beffd97ebf0" title="SM structure.">SM</a>[SMc].<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html#af8ece4638fc47a8aa61f0956e5c76379">StartAddr</a>;
<a name="l00615"></a>00615           SMlength = etohs(<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].SM[SMc].SMlength);
<a name="l00616"></a>00616           ByteCount += SMlength;
<a name="l00617"></a>00617           BitCount += SMlength * 8;
<a name="l00618"></a>00618           EndAddr = etohs(<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].SM[SMc].StartAddr) + SMlength;
<a name="l00619"></a>00619           <span class="keywordflow">while</span> ( (BitCount &lt; <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].Obits) &amp;&amp; (SMc &lt; (EC_MAXSM - 1)) ) <span class="comment">/* more SM for output */</span>
<a name="l00620"></a>00620           {
<a name="l00621"></a>00621             SMc++;
<a name="l00622"></a>00622             <span class="keywordflow">while</span> ( (SMc &lt; (EC_MAXSM - 1)) &amp;&amp; (<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].SMtype[SMc] != 3)) SMc++;
<a name="l00623"></a>00623             <span class="comment">/* if addresses from more SM connect use one FMMU otherwise break up in mutiple FMMU */</span>
<a name="l00624"></a>00624             <span class="keywordflow">if</span> ( etohs(<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].SM[SMc].StartAddr) &gt; EndAddr ) <span class="keywordflow">break</span>;
<a name="l00625"></a>00625             <a class="code" href="../../d2/d04/ethercatconfig_8c.html#a7f701d87af8db364450d02975b16cd5d">EC_PRINT</a>(<span class="stringliteral">&quot;      SM%d\n&quot;</span>, SMc);
<a name="l00626"></a>00626             SMlength = etohs(<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].SM[SMc].SMlength);
<a name="l00627"></a>00627             ByteCount += SMlength;
<a name="l00628"></a>00628             BitCount += SMlength * 8;
<a name="l00629"></a>00629             EndAddr = etohs(<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].SM[SMc].StartAddr) + SMlength;          
<a name="l00630"></a>00630           } 
<a name="l00631"></a>00631 
<a name="l00632"></a>00632           <span class="comment">/* bit oriented slave */</span>
<a name="l00633"></a>00633           <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].Obytes)
<a name="l00634"></a>00634           { 
<a name="l00635"></a>00635             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a7950e5af0de131f09ba968b5dfb429dd" title="FMMU structure.">FMMU</a>[FMMUc].LogStart = htoel(LogAddr);
<a name="l00636"></a>00636             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a7950e5af0de131f09ba968b5dfb429dd" title="FMMU structure.">FMMU</a>[FMMUc].LogStartbit = BitPos;
<a name="l00637"></a>00637             BitPos += <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#aa1da8dcd1b53ecb6f8f4a9ef70c7502b" title="output bits">Obits</a> - 1;
<a name="l00638"></a>00638             <span class="keywordflow">if</span> (BitPos &gt; 7)
<a name="l00639"></a>00639             {
<a name="l00640"></a>00640               LogAddr++;
<a name="l00641"></a>00641               BitPos -= 8;
<a name="l00642"></a>00642             } 
<a name="l00643"></a>00643             FMMUsize = LogAddr - etohl(<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].FMMU[FMMUc].LogStart) + 1;
<a name="l00644"></a>00644             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a7950e5af0de131f09ba968b5dfb429dd" title="FMMU structure.">FMMU</a>[FMMUc].LogLength = htoes(FMMUsize);
<a name="l00645"></a>00645             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a7950e5af0de131f09ba968b5dfb429dd" title="FMMU structure.">FMMU</a>[FMMUc].LogEndbit = BitPos;
<a name="l00646"></a>00646             BitPos ++;
<a name="l00647"></a>00647             <span class="keywordflow">if</span> (BitPos &gt; 7)
<a name="l00648"></a>00648             {
<a name="l00649"></a>00649               LogAddr++;
<a name="l00650"></a>00650               BitPos -= 8;
<a name="l00651"></a>00651             } 
<a name="l00652"></a>00652           }
<a name="l00653"></a>00653           <span class="comment">/* byte oriented slave */</span>
<a name="l00654"></a>00654           <span class="keywordflow">else</span>
<a name="l00655"></a>00655           {
<a name="l00656"></a>00656             <span class="keywordflow">if</span> (BitPos)
<a name="l00657"></a>00657             {
<a name="l00658"></a>00658               LogAddr++;
<a name="l00659"></a>00659               BitPos = 0;
<a name="l00660"></a>00660             } 
<a name="l00661"></a>00661             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a7950e5af0de131f09ba968b5dfb429dd" title="FMMU structure.">FMMU</a>[FMMUc].LogStart = htoel(LogAddr);
<a name="l00662"></a>00662             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a7950e5af0de131f09ba968b5dfb429dd" title="FMMU structure.">FMMU</a>[FMMUc].LogStartbit = BitPos;
<a name="l00663"></a>00663             BitPos = 7;
<a name="l00664"></a>00664             FMMUsize = ByteCount;
<a name="l00665"></a>00665             <span class="keywordflow">if</span> ((FMMUsize + FMMUdone)&gt; <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].Obytes)
<a name="l00666"></a>00666               FMMUsize = <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#aa4793d235fa626746b8260e94e48287b" title="output bytes, if Obits &amp;lt; 8 then Obytes = 0">Obytes</a> - FMMUdone;
<a name="l00667"></a>00667             LogAddr += FMMUsize;
<a name="l00668"></a>00668             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a7950e5af0de131f09ba968b5dfb429dd" title="FMMU structure.">FMMU</a>[FMMUc].LogLength = htoes(FMMUsize);
<a name="l00669"></a>00669             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a7950e5af0de131f09ba968b5dfb429dd" title="FMMU structure.">FMMU</a>[FMMUc].LogEndbit = BitPos;
<a name="l00670"></a>00670             BitPos = 0;
<a name="l00671"></a>00671           }
<a name="l00672"></a>00672           FMMUdone += FMMUsize;
<a name="l00673"></a>00673           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a7950e5af0de131f09ba968b5dfb429dd" title="FMMU structure.">FMMU</a>[FMMUc].PhysStartBit = 0;
<a name="l00674"></a>00674           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a7950e5af0de131f09ba968b5dfb429dd" title="FMMU structure.">FMMU</a>[FMMUc].FMMUtype = 2;
<a name="l00675"></a>00675           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a7950e5af0de131f09ba968b5dfb429dd" title="FMMU structure.">FMMU</a>[FMMUc].FMMUactive = 1;
<a name="l00676"></a>00676           <span class="comment">/* program FMMU for output */</span>
<a name="l00677"></a>00677           <a class="code" href="../../d5/d74/ethercatbase_8c.html#aa2fe58363a824f15838718ee31f11ffc" title="FPWR &amp;quot;configured address write&amp;quot; primitive.">ec_FPWR</a> (configadr, <a class="code" href="../../d2/dbb/ethercattype_8h.html#adb49720dc49f7d4e4cf9adbf2948e409abf1da03289d47ff22ced968a1e4317b5">ECT_REG_FMMU0</a> + (<span class="keyword">sizeof</span>(<a class="code" href="../../d8/d38/ethercatmain_8h.html#a0e56c2bdef7489ded7633da7e453d20f">ec_fmmut</a>) * FMMUc), <span class="keyword">sizeof</span>(<a class="code" href="../../d8/d38/ethercatmain_8h.html#a0e56c2bdef7489ded7633da7e453d20f">ec_fmmut</a>), 
<a name="l00678"></a>00678                    &amp;<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].FMMU[FMMUc], <a class="code" href="../../d2/dbb/ethercattype_8h.html#a334e41422731fd6d427d2a7ec790779c" title="timeout value in us for tx frame to return to rx">EC_TIMEOUTRET</a>);
<a name="l00679"></a>00679           <span class="comment">/* add two for an output FMMU */</span>
<a name="l00680"></a>00680           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#a2bdce50a46e56597354e404a55344934" title="slave group structure">ec_group</a>[group].<a class="code" href="../../dd/d43/structec__groupt.html#a37e76382a31a05df2cdf604285074532" title="Expected workcounter.">expectedWKC</a> += 2;
<a name="l00681"></a>00681           <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].outputs)
<a name="l00682"></a>00682           { 
<a name="l00683"></a>00683             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a601a0f0ed2760c8c633dbaf4eef460ed" title="output pointer in IOmap buffer">outputs</a> = pIOmap + etohl(<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].FMMU[FMMUc].LogStart);
<a name="l00684"></a>00684             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#ae585a9870abef96132e39cb8d6739ce6" title="startbit in first output byte">Ostartbit</a> = <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a7950e5af0de131f09ba968b5dfb429dd" title="FMMU structure.">FMMU</a>[FMMUc].LogStartbit;
<a name="l00685"></a>00685             <a class="code" href="../../d2/d04/ethercatconfig_8c.html#a7f701d87af8db364450d02975b16cd5d">EC_PRINT</a>(<span class="stringliteral">&quot;    slave %d Outputs %p startbit %d\n&quot;</span>, slave, <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].outputs, <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].Ostartbit);
<a name="l00686"></a>00686           }
<a name="l00687"></a>00687           FMMUc++;
<a name="l00688"></a>00688         } 
<a name="l00689"></a>00689         <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a02cf783622672a2069212597471223bc" title="first unused FMMU">FMMUunused</a> = FMMUc;
<a name="l00690"></a>00690         diff = LogAddr - oLogAddr;
<a name="l00691"></a>00691         oLogAddr = LogAddr;
<a name="l00692"></a>00692         <span class="keywordflow">if</span> ((segmentsize + diff) &gt; (<a class="code" href="../../d2/dbb/ethercattype_8h.html#a3795862bc06e9001d58494e143e34e09" title="maximum EtherCAT LRW frame length in bytes">EC_MAXLRWDATA</a> - <a class="code" href="../../d2/dbb/ethercattype_8h.html#a7a4e124b9760b9a0024c4905fc2aa363" title="size of DC datagram used in first LRW frame">EC_FIRSTDCDATAGRAM</a>))
<a name="l00693"></a>00693         {
<a name="l00694"></a>00694           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#a2bdce50a46e56597354e404a55344934" title="slave group structure">ec_group</a>[group].<a class="code" href="../../dd/d43/structec__groupt.html#acc860f5b26d9b558fcf44b8e8199f913" title="IO segmentation list.">IOsegment</a>[currentsegment] = segmentsize;
<a name="l00695"></a>00695           <span class="keywordflow">if</span> (currentsegment &lt; (<a class="code" href="../../d8/d38/ethercatmain_8h.html#aeff511f0f66d560c4ae80e3ccae7c6bd">EC_MAXIOSEGMENTS</a> - 1))
<a name="l00696"></a>00696           {
<a name="l00697"></a>00697             currentsegment++;
<a name="l00698"></a>00698             segmentsize = diff; 
<a name="l00699"></a>00699           }
<a name="l00700"></a>00700         }
<a name="l00701"></a>00701         <span class="keywordflow">else</span>
<a name="l00702"></a>00702           segmentsize += diff;
<a name="l00703"></a>00703       }
<a name="l00704"></a>00704       } 
<a name="l00705"></a>00705         }
<a name="l00706"></a>00706     <span class="keywordflow">if</span> (BitPos)
<a name="l00707"></a>00707     {
<a name="l00708"></a>00708       LogAddr++;
<a name="l00709"></a>00709       oLogAddr = LogAddr;
<a name="l00710"></a>00710       BitPos = 0;
<a name="l00711"></a>00711       <span class="keywordflow">if</span> ((segmentsize + 1) &gt; (<a class="code" href="../../d2/dbb/ethercattype_8h.html#a3795862bc06e9001d58494e143e34e09" title="maximum EtherCAT LRW frame length in bytes">EC_MAXLRWDATA</a> - <a class="code" href="../../d2/dbb/ethercattype_8h.html#a7a4e124b9760b9a0024c4905fc2aa363" title="size of DC datagram used in first LRW frame">EC_FIRSTDCDATAGRAM</a>))
<a name="l00712"></a>00712       {
<a name="l00713"></a>00713         <a class="code" href="../../d3/d6b/ethercatmain_8c.html#a2bdce50a46e56597354e404a55344934" title="slave group structure">ec_group</a>[group].<a class="code" href="../../dd/d43/structec__groupt.html#acc860f5b26d9b558fcf44b8e8199f913" title="IO segmentation list.">IOsegment</a>[currentsegment] = segmentsize;
<a name="l00714"></a>00714         <span class="keywordflow">if</span> (currentsegment &lt; (<a class="code" href="../../d8/d38/ethercatmain_8h.html#aeff511f0f66d560c4ae80e3ccae7c6bd">EC_MAXIOSEGMENTS</a> - 1))
<a name="l00715"></a>00715         {
<a name="l00716"></a>00716           currentsegment++;
<a name="l00717"></a>00717           segmentsize = 1;  
<a name="l00718"></a>00718         }
<a name="l00719"></a>00719       }
<a name="l00720"></a>00720       <span class="keywordflow">else</span>
<a name="l00721"></a>00721         segmentsize += 1;
<a name="l00722"></a>00722     } 
<a name="l00723"></a>00723     <a class="code" href="../../d3/d6b/ethercatmain_8c.html#a2bdce50a46e56597354e404a55344934" title="slave group structure">ec_group</a>[group].<a class="code" href="../../dd/d43/structec__groupt.html#a601a0f0ed2760c8c633dbaf4eef460ed" title="output pointer in IOmap buffer">outputs</a> = pIOmap;
<a name="l00724"></a>00724     <a class="code" href="../../d3/d6b/ethercatmain_8c.html#a2bdce50a46e56597354e404a55344934" title="slave group structure">ec_group</a>[group].<a class="code" href="../../dd/d43/structec__groupt.html#aa4793d235fa626746b8260e94e48287b" title="output bytes, if Obits &amp;lt; 8 then Obytes = 0">Obytes</a> = LogAddr;
<a name="l00725"></a>00725     <a class="code" href="../../d3/d6b/ethercatmain_8c.html#a2bdce50a46e56597354e404a55344934" title="slave group structure">ec_group</a>[group].<a class="code" href="../../dd/d43/structec__groupt.html#aaffe2511250ab048b15ffd2849b18eef" title="IO segegments used.">nsegments</a> = currentsegment + 1;
<a name="l00726"></a>00726     <a class="code" href="../../d3/d6b/ethercatmain_8c.html#a2bdce50a46e56597354e404a55344934" title="slave group structure">ec_group</a>[group].<a class="code" href="../../dd/d43/structec__groupt.html#ac208b1c6b1da42117364b4a06f3686b0" title="1st input segment">Isegment</a> = currentsegment;
<a name="l00727"></a>00727     <a class="code" href="../../d3/d6b/ethercatmain_8c.html#a2bdce50a46e56597354e404a55344934" title="slave group structure">ec_group</a>[group].<a class="code" href="../../dd/d43/structec__groupt.html#a16ff855d59206457e8340ec8a7ed4ed0" title="Offset in input segment.">Ioffset</a> = segmentsize;
<a name="l00728"></a>00728     <span class="keywordflow">if</span> (!group)
<a name="l00729"></a>00729     { 
<a name="l00730"></a>00730       <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[0].<a class="code" href="../../da/dff/structec__slavet.html#a601a0f0ed2760c8c633dbaf4eef460ed" title="output pointer in IOmap buffer">outputs</a> = pIOmap;
<a name="l00731"></a>00731       <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[0].<a class="code" href="../../da/dff/structec__slavet.html#aa4793d235fa626746b8260e94e48287b" title="output bytes, if Obits &amp;lt; 8 then Obytes = 0">Obytes</a> = LogAddr; <span class="comment">/* store output bytes in master record */</span>
<a name="l00732"></a>00732     } 
<a name="l00733"></a>00733     
<a name="l00734"></a>00734     <span class="comment">/* do input mapping of slave and program FMMUs */</span>
<a name="l00735"></a>00735     <span class="keywordflow">for</span> (slave = 1; slave &lt;= <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aa9c784abc9a4ede41d3d8d688b4a7dc5" title="number of slaves found on the network">ec_slavecount</a>; slave++)
<a name="l00736"></a>00736         {
<a name="l00737"></a>00737             configadr = <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#aba5576ebc3c34ee46d929c731269cae4" title="Configured address.">configadr</a>;
<a name="l00738"></a>00738       FMMUc = <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a02cf783622672a2069212597471223bc" title="first unused FMMU">FMMUunused</a>;
<a name="l00739"></a>00739       <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].Obits) <span class="comment">/* find free FMMU */</span>
<a name="l00740"></a>00740         <span class="keywordflow">while</span> ( <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].FMMU[FMMUc].LogStart ) FMMUc++;
<a name="l00741"></a>00741       SMc = 0;
<a name="l00742"></a>00742       BitCount = 0;
<a name="l00743"></a>00743       ByteCount = 0;
<a name="l00744"></a>00744       EndAddr = 0;
<a name="l00745"></a>00745       FMMUsize = 0;
<a name="l00746"></a>00746       FMMUdone = 0;
<a name="l00747"></a>00747       <span class="comment">/* create input mapping */</span>
<a name="l00748"></a>00748       <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].Ibits)
<a name="l00749"></a>00749       {
<a name="l00750"></a>00750         <a class="code" href="../../d2/d04/ethercatconfig_8c.html#a7f701d87af8db364450d02975b16cd5d">EC_PRINT</a>(<span class="stringliteral">&quot; =Slave %d, INPUT MAPPING\n&quot;</span>, slave);
<a name="l00751"></a>00751         <span class="comment">/* search for SM that contribute to the input mapping */</span>
<a name="l00752"></a>00752         <span class="keywordflow">while</span> ( (SMc &lt; (<a class="code" href="../../d8/d38/ethercatmain_8h.html#a76097f1d16afaffe412d6f3d864ac749">EC_MAXSM</a> - 1)) &amp;&amp; (FMMUdone &lt; ((<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].Ibits + 7) / 8)))
<a name="l00753"></a>00753         { 
<a name="l00754"></a>00754           <a class="code" href="../../d2/d04/ethercatconfig_8c.html#a7f701d87af8db364450d02975b16cd5d">EC_PRINT</a>(<span class="stringliteral">&quot;    FMMU %d\n&quot;</span>, FMMUc);
<a name="l00755"></a>00755           <span class="keywordflow">while</span> ( (SMc &lt; (<a class="code" href="../../d8/d38/ethercatmain_8h.html#a76097f1d16afaffe412d6f3d864ac749">EC_MAXSM</a> - 1)) &amp;&amp; (<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].SMtype[SMc] != 4)) SMc++;
<a name="l00756"></a>00756           <a class="code" href="../../d2/d04/ethercatconfig_8c.html#a7f701d87af8db364450d02975b16cd5d">EC_PRINT</a>(<span class="stringliteral">&quot;      SM%d\n&quot;</span>, SMc);
<a name="l00757"></a>00757           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a7950e5af0de131f09ba968b5dfb429dd" title="FMMU structure.">FMMU</a>[FMMUc].PhysStart = <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a44e9a0bc7021d7d4753e0beffd97ebf0" title="SM structure.">SM</a>[SMc].<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html#af8ece4638fc47a8aa61f0956e5c76379">StartAddr</a>;
<a name="l00758"></a>00758           SMlength = etohs(<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].SM[SMc].SMlength);
<a name="l00759"></a>00759           ByteCount += SMlength;
<a name="l00760"></a>00760           BitCount += SMlength * 8;
<a name="l00761"></a>00761           EndAddr = etohs(<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].SM[SMc].StartAddr) + SMlength;
<a name="l00762"></a>00762           <span class="keywordflow">while</span> ( (BitCount &lt; <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].Ibits) &amp;&amp; (SMc &lt; (<a class="code" href="../../d8/d38/ethercatmain_8h.html#a76097f1d16afaffe412d6f3d864ac749">EC_MAXSM</a> - 1)) ) <span class="comment">/* more SM for input */</span>
<a name="l00763"></a>00763           {
<a name="l00764"></a>00764             SMc++;
<a name="l00765"></a>00765             <span class="keywordflow">while</span> ( (SMc &lt; (<a class="code" href="../../d8/d38/ethercatmain_8h.html#a76097f1d16afaffe412d6f3d864ac749">EC_MAXSM</a> - 1)) &amp;&amp; (<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].SMtype[SMc] != 4)) SMc++;
<a name="l00766"></a>00766             <span class="comment">/* if addresses from more SM connect use one FMMU otherwise break up in mutiple FMMU */</span>
<a name="l00767"></a>00767             <span class="keywordflow">if</span> ( etohs(<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].SM[SMc].StartAddr) &gt; EndAddr ) <span class="keywordflow">break</span>;
<a name="l00768"></a>00768             <a class="code" href="../../d2/d04/ethercatconfig_8c.html#a7f701d87af8db364450d02975b16cd5d">EC_PRINT</a>(<span class="stringliteral">&quot;      SM%d\n&quot;</span>, SMc);
<a name="l00769"></a>00769             SMlength = etohs(<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].SM[SMc].SMlength);
<a name="l00770"></a>00770             ByteCount += SMlength;
<a name="l00771"></a>00771             BitCount += SMlength * 8;
<a name="l00772"></a>00772             EndAddr = etohs(<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].SM[SMc].StartAddr) + SMlength;          
<a name="l00773"></a>00773           } 
<a name="l00774"></a>00774 
<a name="l00775"></a>00775           <span class="comment">/* bit oriented slave */</span>
<a name="l00776"></a>00776           <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].Ibytes)
<a name="l00777"></a>00777           { 
<a name="l00778"></a>00778             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a7950e5af0de131f09ba968b5dfb429dd" title="FMMU structure.">FMMU</a>[FMMUc].LogStart = htoel(LogAddr);
<a name="l00779"></a>00779             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a7950e5af0de131f09ba968b5dfb429dd" title="FMMU structure.">FMMU</a>[FMMUc].LogStartbit = BitPos;
<a name="l00780"></a>00780             BitPos += <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a476276ad037266d880ff367a79ee9c66" title="input bits">Ibits</a> - 1;
<a name="l00781"></a>00781             <span class="keywordflow">if</span> (BitPos &gt; 7)
<a name="l00782"></a>00782             {
<a name="l00783"></a>00783               LogAddr++;
<a name="l00784"></a>00784               BitPos -= 8;
<a name="l00785"></a>00785             } 
<a name="l00786"></a>00786             FMMUsize = LogAddr - etohl(<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].FMMU[FMMUc].LogStart) + 1;
<a name="l00787"></a>00787             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a7950e5af0de131f09ba968b5dfb429dd" title="FMMU structure.">FMMU</a>[FMMUc].LogLength = htoes(FMMUsize);
<a name="l00788"></a>00788             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a7950e5af0de131f09ba968b5dfb429dd" title="FMMU structure.">FMMU</a>[FMMUc].LogEndbit = BitPos;
<a name="l00789"></a>00789             BitPos ++;
<a name="l00790"></a>00790             <span class="keywordflow">if</span> (BitPos &gt; 7)
<a name="l00791"></a>00791             {
<a name="l00792"></a>00792               LogAddr++;
<a name="l00793"></a>00793               BitPos -= 8;
<a name="l00794"></a>00794             } 
<a name="l00795"></a>00795           }
<a name="l00796"></a>00796           <span class="comment">/* byte oriented slave */</span>
<a name="l00797"></a>00797           <span class="keywordflow">else</span>
<a name="l00798"></a>00798           {
<a name="l00799"></a>00799             <span class="keywordflow">if</span> (BitPos)
<a name="l00800"></a>00800             {
<a name="l00801"></a>00801               LogAddr++;
<a name="l00802"></a>00802               BitPos = 0;
<a name="l00803"></a>00803             } 
<a name="l00804"></a>00804             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a7950e5af0de131f09ba968b5dfb429dd" title="FMMU structure.">FMMU</a>[FMMUc].LogStart = htoel(LogAddr);
<a name="l00805"></a>00805             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a7950e5af0de131f09ba968b5dfb429dd" title="FMMU structure.">FMMU</a>[FMMUc].LogStartbit = BitPos;
<a name="l00806"></a>00806             BitPos = 7;
<a name="l00807"></a>00807             FMMUsize = ByteCount;
<a name="l00808"></a>00808             <span class="keywordflow">if</span> ((FMMUsize + FMMUdone)&gt; <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].Ibytes)
<a name="l00809"></a>00809               FMMUsize = <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a4057eeb48537a3d8c6472e58ef2af257" title="input bytes, if Ibits &amp;lt; 8 then Ibytes = 0">Ibytes</a> - FMMUdone;
<a name="l00810"></a>00810             LogAddr += FMMUsize;
<a name="l00811"></a>00811             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a7950e5af0de131f09ba968b5dfb429dd" title="FMMU structure.">FMMU</a>[FMMUc].LogLength = htoes(FMMUsize);
<a name="l00812"></a>00812             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a7950e5af0de131f09ba968b5dfb429dd" title="FMMU structure.">FMMU</a>[FMMUc].LogEndbit = BitPos;
<a name="l00813"></a>00813             BitPos = 0;
<a name="l00814"></a>00814           }
<a name="l00815"></a>00815           FMMUdone += FMMUsize;
<a name="l00816"></a>00816           <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].FMMU[FMMUc].LogLength)
<a name="l00817"></a>00817           { 
<a name="l00818"></a>00818             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a7950e5af0de131f09ba968b5dfb429dd" title="FMMU structure.">FMMU</a>[FMMUc].PhysStartBit = 0;
<a name="l00819"></a>00819             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a7950e5af0de131f09ba968b5dfb429dd" title="FMMU structure.">FMMU</a>[FMMUc].FMMUtype = 1;
<a name="l00820"></a>00820             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a7950e5af0de131f09ba968b5dfb429dd" title="FMMU structure.">FMMU</a>[FMMUc].FMMUactive = 1;
<a name="l00821"></a>00821             <span class="comment">/* program FMMU for input */</span>
<a name="l00822"></a>00822             <a class="code" href="../../d5/d74/ethercatbase_8c.html#aa2fe58363a824f15838718ee31f11ffc" title="FPWR &amp;quot;configured address write&amp;quot; primitive.">ec_FPWR</a> (configadr, <a class="code" href="../../d2/dbb/ethercattype_8h.html#adb49720dc49f7d4e4cf9adbf2948e409abf1da03289d47ff22ced968a1e4317b5">ECT_REG_FMMU0</a> + (<span class="keyword">sizeof</span>(<a class="code" href="../../d8/d38/ethercatmain_8h.html#a0e56c2bdef7489ded7633da7e453d20f">ec_fmmut</a>) * FMMUc), <span class="keyword">sizeof</span>(<a class="code" href="../../d8/d38/ethercatmain_8h.html#a0e56c2bdef7489ded7633da7e453d20f">ec_fmmut</a>), 
<a name="l00823"></a>00823                      &amp;<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].FMMU[FMMUc], <a class="code" href="../../d2/dbb/ethercattype_8h.html#a334e41422731fd6d427d2a7ec790779c" title="timeout value in us for tx frame to return to rx">EC_TIMEOUTRET</a>);
<a name="l00824"></a>00824             <span class="comment">/* add one for an input FMMU */</span>
<a name="l00825"></a>00825             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#a2bdce50a46e56597354e404a55344934" title="slave group structure">ec_group</a>[group].<a class="code" href="../../dd/d43/structec__groupt.html#a37e76382a31a05df2cdf604285074532" title="Expected workcounter.">expectedWKC</a> += 1;
<a name="l00826"></a>00826           } 
<a name="l00827"></a>00827           <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].inputs)
<a name="l00828"></a>00828           { 
<a name="l00829"></a>00829             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a7a99661951b97a06c5050083e25dc105" title="input pointer in IOmap buffer">inputs</a> = pIOmap + etohl(<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].FMMU[FMMUc].LogStart);
<a name="l00830"></a>00830             <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#ae85a33eac233602a9157894456333844" title="startbit in first input byte">Istartbit</a> = <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a7950e5af0de131f09ba968b5dfb429dd" title="FMMU structure.">FMMU</a>[FMMUc].LogStartbit;
<a name="l00831"></a>00831             <a class="code" href="../../d2/d04/ethercatconfig_8c.html#a7f701d87af8db364450d02975b16cd5d">EC_PRINT</a>(<span class="stringliteral">&quot;    Inputs %p startbit %d\n&quot;</span>, <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].inputs, <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].Istartbit);
<a name="l00832"></a>00832           }
<a name="l00833"></a>00833           FMMUc++;
<a name="l00834"></a>00834         } 
<a name="l00835"></a>00835         <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a02cf783622672a2069212597471223bc" title="first unused FMMU">FMMUunused</a> = FMMUc;
<a name="l00836"></a>00836         diff = LogAddr - oLogAddr;
<a name="l00837"></a>00837         oLogAddr = LogAddr;
<a name="l00838"></a>00838         <span class="keywordflow">if</span> ((segmentsize + diff) &gt; (<a class="code" href="../../d2/dbb/ethercattype_8h.html#a3795862bc06e9001d58494e143e34e09" title="maximum EtherCAT LRW frame length in bytes">EC_MAXLRWDATA</a> - <a class="code" href="../../d2/dbb/ethercattype_8h.html#a7a4e124b9760b9a0024c4905fc2aa363" title="size of DC datagram used in first LRW frame">EC_FIRSTDCDATAGRAM</a>))
<a name="l00839"></a>00839         {
<a name="l00840"></a>00840           <a class="code" href="../../d3/d6b/ethercatmain_8c.html#a2bdce50a46e56597354e404a55344934" title="slave group structure">ec_group</a>[group].<a class="code" href="../../dd/d43/structec__groupt.html#acc860f5b26d9b558fcf44b8e8199f913" title="IO segmentation list.">IOsegment</a>[currentsegment] = segmentsize;
<a name="l00841"></a>00841           <span class="keywordflow">if</span> (currentsegment &lt; (<a class="code" href="../../d8/d38/ethercatmain_8h.html#aeff511f0f66d560c4ae80e3ccae7c6bd">EC_MAXIOSEGMENTS</a> - 1))
<a name="l00842"></a>00842           {
<a name="l00843"></a>00843             currentsegment++;
<a name="l00844"></a>00844             segmentsize = diff; 
<a name="l00845"></a>00845           }
<a name="l00846"></a>00846         }
<a name="l00847"></a>00847         <span class="keywordflow">else</span>
<a name="l00848"></a>00848           segmentsize += diff;
<a name="l00849"></a>00849       }
<a name="l00850"></a>00850 
<a name="l00851"></a>00851       <a class="code" href="../../d3/d6b/ethercatmain_8c.html#ae149a6cd4a61c22efa4cf4185ffd83be" title="Set eeprom control to PDI.">ec_eeprom2pdi</a>(slave); <span class="comment">/* set Eeprom control to PDI */</span>     
<a name="l00852"></a>00852       <a class="code" href="../../d5/d74/ethercatbase_8c.html#a2fc76bd01a00a0f6da9fb3927eabc24d" title="FPWR &amp;quot;configured address write&amp;quot; primitive.">ec_FPWRw</a>(configadr, <a class="code" href="../../d2/dbb/ethercattype_8h.html#adb49720dc49f7d4e4cf9adbf2948e409a148befce8c8d150d28b6a93d37fe24c2">ECT_REG_ALCTL</a>, htoes(<a class="code" href="../../d2/dbb/ethercattype_8h.html#ac93847b4c4f8ff2d123e3717d55358c1acc09f39d0638c3b71e56b3614170810d" title="Safe-operational.">EC_STATE_SAFE_OP</a>) , <a class="code" href="../../d2/dbb/ethercattype_8h.html#a334e41422731fd6d427d2a7ec790779c" title="timeout value in us for tx frame to return to rx">EC_TIMEOUTRET</a>); <span class="comment">/* set safeop status */</span>
<a name="l00853"></a>00853             
<a name="l00854"></a>00854     }
<a name="l00855"></a>00855     <span class="keywordflow">if</span> (BitPos)
<a name="l00856"></a>00856     {
<a name="l00857"></a>00857       LogAddr++;
<a name="l00858"></a>00858       oLogAddr = LogAddr;
<a name="l00859"></a>00859       BitPos = 0;
<a name="l00860"></a>00860       <span class="keywordflow">if</span> ((segmentsize + 1) &gt; (<a class="code" href="../../d2/dbb/ethercattype_8h.html#a3795862bc06e9001d58494e143e34e09" title="maximum EtherCAT LRW frame length in bytes">EC_MAXLRWDATA</a> - <a class="code" href="../../d2/dbb/ethercattype_8h.html#a7a4e124b9760b9a0024c4905fc2aa363" title="size of DC datagram used in first LRW frame">EC_FIRSTDCDATAGRAM</a>))
<a name="l00861"></a>00861       {
<a name="l00862"></a>00862         <a class="code" href="../../d3/d6b/ethercatmain_8c.html#a2bdce50a46e56597354e404a55344934" title="slave group structure">ec_group</a>[group].<a class="code" href="../../dd/d43/structec__groupt.html#acc860f5b26d9b558fcf44b8e8199f913" title="IO segmentation list.">IOsegment</a>[currentsegment] = segmentsize;
<a name="l00863"></a>00863         <span class="keywordflow">if</span> (currentsegment &lt; (<a class="code" href="../../d8/d38/ethercatmain_8h.html#aeff511f0f66d560c4ae80e3ccae7c6bd">EC_MAXIOSEGMENTS</a> - 1))
<a name="l00864"></a>00864         {
<a name="l00865"></a>00865           currentsegment++;
<a name="l00866"></a>00866           segmentsize = 1;  
<a name="l00867"></a>00867         }
<a name="l00868"></a>00868       }
<a name="l00869"></a>00869       <span class="keywordflow">else</span>
<a name="l00870"></a>00870         segmentsize += 1;
<a name="l00871"></a>00871     } 
<a name="l00872"></a>00872     <a class="code" href="../../d3/d6b/ethercatmain_8c.html#a2bdce50a46e56597354e404a55344934" title="slave group structure">ec_group</a>[group].<a class="code" href="../../dd/d43/structec__groupt.html#acc860f5b26d9b558fcf44b8e8199f913" title="IO segmentation list.">IOsegment</a>[currentsegment] = segmentsize;
<a name="l00873"></a>00873     <a class="code" href="../../d3/d6b/ethercatmain_8c.html#a2bdce50a46e56597354e404a55344934" title="slave group structure">ec_group</a>[group].<a class="code" href="../../dd/d43/structec__groupt.html#aaffe2511250ab048b15ffd2849b18eef" title="IO segegments used.">nsegments</a> = currentsegment + 1;
<a name="l00874"></a>00874     <a class="code" href="../../d3/d6b/ethercatmain_8c.html#a2bdce50a46e56597354e404a55344934" title="slave group structure">ec_group</a>[group].<a class="code" href="../../dd/d43/structec__groupt.html#a7a99661951b97a06c5050083e25dc105" title="input pointer in IOmap buffer">inputs</a> = pIOmap + <a class="code" href="../../d3/d6b/ethercatmain_8c.html#a2bdce50a46e56597354e404a55344934" title="slave group structure">ec_group</a>[group].<a class="code" href="../../dd/d43/structec__groupt.html#aa4793d235fa626746b8260e94e48287b" title="output bytes, if Obits &amp;lt; 8 then Obytes = 0">Obytes</a>;
<a name="l00875"></a>00875     <a class="code" href="../../d3/d6b/ethercatmain_8c.html#a2bdce50a46e56597354e404a55344934" title="slave group structure">ec_group</a>[group].<a class="code" href="../../dd/d43/structec__groupt.html#a4057eeb48537a3d8c6472e58ef2af257" title="input bytes, if Ibits &amp;lt; 8 then Ibytes = 0">Ibytes</a> = LogAddr - <a class="code" href="../../d3/d6b/ethercatmain_8c.html#a2bdce50a46e56597354e404a55344934" title="slave group structure">ec_group</a>[group].<a class="code" href="../../dd/d43/structec__groupt.html#aa4793d235fa626746b8260e94e48287b" title="output bytes, if Obits &amp;lt; 8 then Obytes = 0">Obytes</a>;
<a name="l00876"></a>00876     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].blockLRW)
<a name="l00877"></a>00877       <a class="code" href="../../d3/d6b/ethercatmain_8c.html#a2bdce50a46e56597354e404a55344934" title="slave group structure">ec_group</a>[group].<a class="code" href="../../dd/d43/structec__groupt.html#a4ce389f3e3a4918cc55c08ff070ed600" title="if &amp;gt;0 block use of LRW in processdata">blockLRW</a>++;           
<a name="l00878"></a>00878     <a class="code" href="../../d3/d6b/ethercatmain_8c.html#a2bdce50a46e56597354e404a55344934" title="slave group structure">ec_group</a>[group].<a class="code" href="../../dd/d43/structec__groupt.html#a0a212af1a40cb6ad6c188a451997e3dc" title="E-bus current.">Ebuscurrent</a> += <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a0a212af1a40cb6ad6c188a451997e3dc" title="E-bus current.">Ebuscurrent</a>;
<a name="l00879"></a>00879     <span class="keywordflow">if</span> (!group)
<a name="l00880"></a>00880     { 
<a name="l00881"></a>00881       <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[0].<a class="code" href="../../da/dff/structec__slavet.html#a7a99661951b97a06c5050083e25dc105" title="input pointer in IOmap buffer">inputs</a> = pIOmap + <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[0].<a class="code" href="../../da/dff/structec__slavet.html#aa4793d235fa626746b8260e94e48287b" title="output bytes, if Obits &amp;lt; 8 then Obytes = 0">Obytes</a>;
<a name="l00882"></a>00882       <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[0].<a class="code" href="../../da/dff/structec__slavet.html#a4057eeb48537a3d8c6472e58ef2af257" title="input bytes, if Ibits &amp;lt; 8 then Ibytes = 0">Ibytes</a> = LogAddr - <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[0].<a class="code" href="../../da/dff/structec__slavet.html#aa4793d235fa626746b8260e94e48287b" title="output bytes, if Obits &amp;lt; 8 then Obytes = 0">Obytes</a>; <span class="comment">/* store input bytes in master record */</span>
<a name="l00883"></a>00883     } 
<a name="l00884"></a>00884 
<a name="l00885"></a>00885     <a class="code" href="../../d2/d04/ethercatconfig_8c.html#a7f701d87af8db364450d02975b16cd5d">EC_PRINT</a>(<span class="stringliteral">&quot;IOmapSize %d\n&quot;</span>, LogAddr - <a class="code" href="../../d3/d6b/ethercatmain_8c.html#a2bdce50a46e56597354e404a55344934" title="slave group structure">ec_group</a>[group].logstartaddr);   
<a name="l00886"></a>00886     <span class="keywordflow">return</span> (LogAddr - <a class="code" href="../../d3/d6b/ethercatmain_8c.html#a2bdce50a46e56597354e404a55344934" title="slave group structure">ec_group</a>[group].logstartaddr);
<a name="l00887"></a>00887   }
<a name="l00888"></a>00888   <span class="keywordflow">return</span> 0;
<a name="l00889"></a>00889 } 
<a name="l00890"></a>00890 <span class="comment"></span>
<a name="l00891"></a>00891 <span class="comment">/** Map all PDOs from slaves to IOmap.</span>
<a name="l00892"></a>00892 <span class="comment"> *</span>
<a name="l00893"></a>00893 <span class="comment"> * @param[out] pIOmap   = pointer to IOmap  </span>
<a name="l00894"></a>00894 <span class="comment"> * @return IOmap size</span>
<a name="l00895"></a>00895 <span class="comment"> */</span>
<a name="l00896"></a><a class="code" href="../../d4/d03/ethercatconfig_8h.html#aa740a2ba948117670c4f9741bc31cc38">00896</a> <span class="keywordtype">int</span> <a class="code" href="../../d2/d04/ethercatconfig_8c.html#aa740a2ba948117670c4f9741bc31cc38" title="Map all PDOs from slaves to IOmap.">ec_config_map</a>(<span class="keywordtype">void</span> *pIOmap)
<a name="l00897"></a>00897 {
<a name="l00898"></a>00898   <span class="keywordflow">return</span> <a class="code" href="../../d2/d04/ethercatconfig_8c.html#ae1120a5cace4aa56cf753977ccd37b8d" title="Map all PDOs in one group of slaves to IOmap.">ec_config_map_group</a>(pIOmap, 0);
<a name="l00899"></a>00899 }
<a name="l00900"></a>00900 <span class="comment"></span>
<a name="l00901"></a>00901 <span class="comment">/** Enumerate / map and init all slaves.</span>
<a name="l00902"></a>00902 <span class="comment"> *</span>
<a name="l00903"></a>00903 <span class="comment"> * @param[in] usetable    = TRUE when using configtable to init slaves, FALSE otherwise</span>
<a name="l00904"></a>00904 <span class="comment"> * @param[out] pIOmap   = pointer to IOmap  </span>
<a name="l00905"></a>00905 <span class="comment"> * @return Workcounter of slave discover datagram = number of slaves found</span>
<a name="l00906"></a>00906 <span class="comment"> */</span>
<a name="l00907"></a><a class="code" href="../../d4/d03/ethercatconfig_8h.html#a502e65cce3b0b5f8dbcabf6f25dab351">00907</a> <span class="keywordtype">int</span> <a class="code" href="../../d2/d04/ethercatconfig_8c.html#a502e65cce3b0b5f8dbcabf6f25dab351" title="Enumerate / map and init all slaves.">ec_config</a>(<a class="code" href="../../d2/dbb/ethercattype_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> usetable, <span class="keywordtype">void</span> *pIOmap)
<a name="l00908"></a>00908 {
<a name="l00909"></a>00909   <span class="keywordtype">int</span> <a class="code" href="../../d1/da4/eepromtool_8c.html#aa59bf150c9e0d285619f7c7e58c9942d">wkc</a>;
<a name="l00910"></a>00910   wkc = <a class="code" href="../../d2/d04/ethercatconfig_8c.html#ae9128b2cb982fd03fae9105d746f8656" title="Enumerate and init all slaves.">ec_config_init</a>(usetable);
<a name="l00911"></a>00911   <span class="keywordflow">if</span> (wkc) 
<a name="l00912"></a>00912     <a class="code" href="../../d2/d04/ethercatconfig_8c.html#aa740a2ba948117670c4f9741bc31cc38" title="Map all PDOs from slaves to IOmap.">ec_config_map</a>(pIOmap);
<a name="l00913"></a>00913     <span class="keywordflow">return</span> wkc;
<a name="l00914"></a>00914 }
<a name="l00915"></a>00915 <span class="comment"></span>
<a name="l00916"></a>00916 <span class="comment">/** Recover slave.</span>
<a name="l00917"></a>00917 <span class="comment"> *</span>
<a name="l00918"></a>00918 <span class="comment"> * @param[in] slave   = slave to recover</span>
<a name="l00919"></a>00919 <span class="comment"> * @return &gt;0 if successful</span>
<a name="l00920"></a>00920 <span class="comment"> */</span>
<a name="l00921"></a><a class="code" href="../../d4/d03/ethercatconfig_8h.html#a9b5b7f6f83d4ee41b72306891f0679f1">00921</a> <span class="keywordtype">int</span> <a class="code" href="../../d2/d04/ethercatconfig_8c.html#a9b5b7f6f83d4ee41b72306891f0679f1" title="Recover slave.">ec_recover_slave</a>(<a class="code" href="../../d2/dbb/ethercattype_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> <a class="code" href="../../d1/da4/eepromtool_8c.html#a7f46665d1fe6d01a75a90942bb34cfaf">slave</a>)
<a name="l00922"></a>00922 {
<a name="l00923"></a>00923   <span class="keywordtype">int</span> rval;
<a name="l00924"></a>00924   <a class="code" href="../../d2/dbb/ethercattype_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> ADPh, configadr;
<a name="l00925"></a>00925 
<a name="l00926"></a>00926   rval = 0;
<a name="l00927"></a>00927     configadr = <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#aba5576ebc3c34ee46d929c731269cae4" title="Configured address.">configadr</a>;
<a name="l00928"></a>00928   <span class="comment">/* clear possible slaves at EC_TEMPNODE */</span>
<a name="l00929"></a>00929   <a class="code" href="../../d5/d74/ethercatbase_8c.html#a2fc76bd01a00a0f6da9fb3927eabc24d" title="FPWR &amp;quot;configured address write&amp;quot; primitive.">ec_FPWRw</a>(<a class="code" href="../../d4/d03/ethercatconfig_8h.html#aca900912dd096ea8c6b3c6b963bb62f9">EC_TEMPNODE</a>, <a class="code" href="../../d2/dbb/ethercattype_8h.html#adb49720dc49f7d4e4cf9adbf2948e409a86eba8ec14620d231b533d126565c877">ECT_REG_STADR</a>, htoes(0) , 0);
<a name="l00930"></a>00930     ADPh = (<a class="code" href="../../d2/dbb/ethercattype_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a>)(1 - slave);
<a name="l00931"></a>00931   <span class="comment">/* set temporary node address of slave */</span>
<a name="l00932"></a>00932   <span class="keywordflow">if</span>(<a class="code" href="../../d5/d74/ethercatbase_8c.html#aca3c5979b5549da9f4a6f441a74e132b" title="APWRw &amp;quot;auto increment address write&amp;quot; word primitive.">ec_APWRw</a>(ADPh, <a class="code" href="../../d2/dbb/ethercattype_8h.html#adb49720dc49f7d4e4cf9adbf2948e409a86eba8ec14620d231b533d126565c877">ECT_REG_STADR</a>, htoes(<a class="code" href="../../d4/d03/ethercatconfig_8h.html#aca900912dd096ea8c6b3c6b963bb62f9">EC_TEMPNODE</a>) , <a class="code" href="../../d2/dbb/ethercattype_8h.html#a334e41422731fd6d427d2a7ec790779c" title="timeout value in us for tx frame to return to rx">EC_TIMEOUTRET</a>) &lt;= 0)
<a name="l00933"></a>00933     <span class="keywordflow">return</span> 0; <span class="comment">/* slave fails to respond */</span>
<a name="l00934"></a>00934   
<a name="l00935"></a>00935     <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#aba5576ebc3c34ee46d929c731269cae4" title="Configured address.">configadr</a> = <a class="code" href="../../d4/d03/ethercatconfig_8h.html#aca900912dd096ea8c6b3c6b963bb62f9">EC_TEMPNODE</a>; <span class="comment">/* temporary config address */</span> 
<a name="l00936"></a>00936   <a class="code" href="../../d3/d6b/ethercatmain_8c.html#a027bd337ebfa1d39de8a7a1f5c5287de" title="Set eeprom control to master.">ec_eeprom2master</a>(slave); <span class="comment">/* set Eeprom control to master */</span>     
<a name="l00937"></a>00937 
<a name="l00938"></a>00938   <span class="comment">/* check if slave is the same as configured before */</span>
<a name="l00939"></a>00939   <span class="keywordflow">if</span> ((<a class="code" href="../../d5/d74/ethercatbase_8c.html#a1cebb240642f321d1f641e8a1ffe2fa4" title="FPRDw &amp;quot;configured address read&amp;quot; word return primitive.">ec_FPRDw</a>(<a class="code" href="../../d4/d03/ethercatconfig_8h.html#aca900912dd096ea8c6b3c6b963bb62f9">EC_TEMPNODE</a>, <a class="code" href="../../d2/dbb/ethercattype_8h.html#adb49720dc49f7d4e4cf9adbf2948e409ae0b547547cbbcc1a9302846a91f292be">ECT_REG_ALIAS</a>, <a class="code" href="../../d2/dbb/ethercattype_8h.html#a334e41422731fd6d427d2a7ec790779c" title="timeout value in us for tx frame to return to rx">EC_TIMEOUTRET</a>) == <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].aliasadr) &amp;&amp;
<a name="l00940"></a>00940       (<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aacc964b3a092b666f8011717be911d35" title="Read EEPROM from slave bypassing cache.">ec_readeeprom</a>(slave, <a class="code" href="../../d2/dbb/ethercattype_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea70a9f67186aa332c1105d50ca10c217f">ECT_SII_ID</a>, <a class="code" href="../../d2/dbb/ethercattype_8h.html#a8684bafce6bd5ae0676fd6440a832276" title="timeout value in us for EEPROM access">EC_TIMEOUTEEP</a>) == <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].eep_id) &amp;&amp;
<a name="l00941"></a>00941       (<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aacc964b3a092b666f8011717be911d35" title="Read EEPROM from slave bypassing cache.">ec_readeeprom</a>(slave, <a class="code" href="../../d2/dbb/ethercattype_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea8c9e4a41e1f55b587360b3d511093805">ECT_SII_MANUF</a>, <a class="code" href="../../d2/dbb/ethercattype_8h.html#a8684bafce6bd5ae0676fd6440a832276" title="timeout value in us for EEPROM access">EC_TIMEOUTEEP</a>) == <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].eep_man) &amp;&amp;
<a name="l00942"></a>00942       (<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aacc964b3a092b666f8011717be911d35" title="Read EEPROM from slave bypassing cache.">ec_readeeprom</a>(slave, <a class="code" href="../../d2/dbb/ethercattype_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea167abdf5136fd905a5aa5665b914d5e0">ECT_SII_REV</a>, <a class="code" href="../../d2/dbb/ethercattype_8h.html#a8684bafce6bd5ae0676fd6440a832276" title="timeout value in us for EEPROM access">EC_TIMEOUTEEP</a>) == <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].eep_rev))
<a name="l00943"></a>00943   {
<a name="l00944"></a>00944     rval = <a class="code" href="../../d5/d74/ethercatbase_8c.html#a2fc76bd01a00a0f6da9fb3927eabc24d" title="FPWR &amp;quot;configured address write&amp;quot; primitive.">ec_FPWRw</a>(<a class="code" href="../../d4/d03/ethercatconfig_8h.html#aca900912dd096ea8c6b3c6b963bb62f9">EC_TEMPNODE</a>, <a class="code" href="../../d2/dbb/ethercattype_8h.html#adb49720dc49f7d4e4cf9adbf2948e409a86eba8ec14620d231b533d126565c877">ECT_REG_STADR</a>, htoes(configadr) , <a class="code" href="../../d2/dbb/ethercattype_8h.html#a334e41422731fd6d427d2a7ec790779c" title="timeout value in us for tx frame to return to rx">EC_TIMEOUTRET</a>);
<a name="l00945"></a>00945       <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#aba5576ebc3c34ee46d929c731269cae4" title="Configured address.">configadr</a> = configadr;
<a name="l00946"></a>00946   }
<a name="l00947"></a>00947   <span class="keywordflow">else</span>
<a name="l00948"></a>00948   {
<a name="l00949"></a>00949     <span class="comment">/* slave is not the expected one, remove config address*/</span>
<a name="l00950"></a>00950     <a class="code" href="../../d5/d74/ethercatbase_8c.html#a2fc76bd01a00a0f6da9fb3927eabc24d" title="FPWR &amp;quot;configured address write&amp;quot; primitive.">ec_FPWRw</a>(<a class="code" href="../../d4/d03/ethercatconfig_8h.html#aca900912dd096ea8c6b3c6b963bb62f9">EC_TEMPNODE</a>, <a class="code" href="../../d2/dbb/ethercattype_8h.html#adb49720dc49f7d4e4cf9adbf2948e409a86eba8ec14620d231b533d126565c877">ECT_REG_STADR</a>, htoes(0) , <a class="code" href="../../d2/dbb/ethercattype_8h.html#a334e41422731fd6d427d2a7ec790779c" title="timeout value in us for tx frame to return to rx">EC_TIMEOUTRET</a>);
<a name="l00951"></a>00951       <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#aba5576ebc3c34ee46d929c731269cae4" title="Configured address.">configadr</a> = configadr;
<a name="l00952"></a>00952   }
<a name="l00953"></a>00953 
<a name="l00954"></a>00954   <span class="keywordflow">return</span> rval;
<a name="l00955"></a>00955 }
<a name="l00956"></a>00956 <span class="comment"></span>
<a name="l00957"></a>00957 <span class="comment">/** Reconfigure slave.</span>
<a name="l00958"></a>00958 <span class="comment"> *</span>
<a name="l00959"></a>00959 <span class="comment"> * @param[in] slave   = slave to reconfigure</span>
<a name="l00960"></a>00960 <span class="comment"> * @return Slave state</span>
<a name="l00961"></a>00961 <span class="comment"> */</span>
<a name="l00962"></a><a class="code" href="../../d4/d03/ethercatconfig_8h.html#abcb0583af47e109f6fc0fb9b90f9f7cf">00962</a> <span class="keywordtype">int</span> <a class="code" href="../../d2/d04/ethercatconfig_8c.html#abcb0583af47e109f6fc0fb9b90f9f7cf" title="Reconfigure slave.">ec_reconfig_slave</a>(<a class="code" href="../../d2/dbb/ethercattype_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> <a class="code" href="../../d1/da4/eepromtool_8c.html#a7f46665d1fe6d01a75a90942bb34cfaf">slave</a>)
<a name="l00963"></a>00963 {
<a name="l00964"></a>00964   <span class="keywordtype">int</span> state, nSM, FMMUc;
<a name="l00965"></a>00965   <a class="code" href="../../d2/dbb/ethercattype_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> configadr;
<a name="l00966"></a>00966   
<a name="l00967"></a>00967     configadr = <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#aba5576ebc3c34ee46d929c731269cae4" title="Configured address.">configadr</a>;
<a name="l00968"></a>00968   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d74/ethercatbase_8c.html#a2fc76bd01a00a0f6da9fb3927eabc24d" title="FPWR &amp;quot;configured address write&amp;quot; primitive.">ec_FPWRw</a>(configadr, <a class="code" href="../../d2/dbb/ethercattype_8h.html#adb49720dc49f7d4e4cf9adbf2948e409a148befce8c8d150d28b6a93d37fe24c2">ECT_REG_ALCTL</a>, htoes(<a class="code" href="../../d2/dbb/ethercattype_8h.html#ac93847b4c4f8ff2d123e3717d55358c1af6a3f8b7e667fe4ba0fbe6fd15f8000c" title="Init state.">EC_STATE_INIT</a>) , <a class="code" href="../../d2/dbb/ethercattype_8h.html#a334e41422731fd6d427d2a7ec790779c" title="timeout value in us for tx frame to return to rx">EC_TIMEOUTRET</a>) &lt;= 0)
<a name="l00969"></a>00969     <span class="keywordflow">return</span> 0;
<a name="l00970"></a>00970   state = 0;
<a name="l00971"></a>00971   <a class="code" href="../../d3/d6b/ethercatmain_8c.html#ae149a6cd4a61c22efa4cf4185ffd83be" title="Set eeprom control to PDI.">ec_eeprom2pdi</a>(slave); <span class="comment">/* set Eeprom control to PDI */</span>     
<a name="l00972"></a>00972   <span class="comment">/* check state change init */</span>
<a name="l00973"></a>00973   state = <a class="code" href="../../d3/d6b/ethercatmain_8c.html#a8f77918c0a6a32be1079a11119171901" title="Check actual slave state.">ec_statecheck</a>(slave, <a class="code" href="../../d2/dbb/ethercattype_8h.html#ac93847b4c4f8ff2d123e3717d55358c1af6a3f8b7e667fe4ba0fbe6fd15f8000c" title="Init state.">EC_STATE_INIT</a>, <a class="code" href="../../d2/dbb/ethercattype_8h.html#ad62eda81b3771cefb501543b184d64ad" title="timeout value in us for check statechange">EC_TIMEOUTSTATE</a>);
<a name="l00974"></a>00974   <span class="keywordflow">if</span>(state == <a class="code" href="../../d2/dbb/ethercattype_8h.html#ac93847b4c4f8ff2d123e3717d55358c1af6a3f8b7e667fe4ba0fbe6fd15f8000c" title="Init state.">EC_STATE_INIT</a>)
<a name="l00975"></a>00975   {
<a name="l00976"></a>00976     <span class="comment">/* program all enabled SM */</span>
<a name="l00977"></a>00977     <span class="keywordflow">for</span>( nSM = 0 ; nSM &lt; <a class="code" href="../../d8/d38/ethercatmain_8h.html#a76097f1d16afaffe412d6f3d864ac749">EC_MAXSM</a> ; nSM++ )
<a name="l00978"></a>00978     { 
<a name="l00979"></a>00979       <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].SM[nSM].StartAddr)
<a name="l00980"></a>00980         <a class="code" href="../../d5/d74/ethercatbase_8c.html#aa2fe58363a824f15838718ee31f11ffc" title="FPWR &amp;quot;configured address write&amp;quot; primitive.">ec_FPWR</a> (configadr, <a class="code" href="../../d2/dbb/ethercattype_8h.html#adb49720dc49f7d4e4cf9adbf2948e409af4be5eba050aa6331760178d05b3e846">ECT_REG_SM0</a> + (nSM * <span class="keyword">sizeof</span>(<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html" title="SDO structure, not to be confused with EcSDOserviceT.">ec_smt</a>)), <span class="keyword">sizeof</span>(<a class="code" href="../../df/d6b/struct_p_a_c_k_e_d.html" title="SDO structure, not to be confused with EcSDOserviceT.">ec_smt</a>),
<a name="l00981"></a>00981             &amp;<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].SM[nSM], <a class="code" href="../../d2/dbb/ethercattype_8h.html#a334e41422731fd6d427d2a7ec790779c" title="timeout value in us for tx frame to return to rx">EC_TIMEOUTRET</a>);
<a name="l00982"></a>00982     }
<a name="l00983"></a>00983     <span class="comment">/* program configured FMMU */</span>
<a name="l00984"></a>00984     <span class="keywordflow">for</span>( FMMUc = 0 ; FMMUc &lt; <a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].<a class="code" href="../../da/dff/structec__slavet.html#a02cf783622672a2069212597471223bc" title="first unused FMMU">FMMUunused</a> ; FMMUc++ )
<a name="l00985"></a>00985     { 
<a name="l00986"></a>00986       <a class="code" href="../../d5/d74/ethercatbase_8c.html#aa2fe58363a824f15838718ee31f11ffc" title="FPWR &amp;quot;configured address write&amp;quot; primitive.">ec_FPWR</a> (configadr, <a class="code" href="../../d2/dbb/ethercattype_8h.html#adb49720dc49f7d4e4cf9adbf2948e409abf1da03289d47ff22ced968a1e4317b5">ECT_REG_FMMU0</a> + (<span class="keyword">sizeof</span>(<a class="code" href="../../d8/d38/ethercatmain_8h.html#a0e56c2bdef7489ded7633da7e453d20f">ec_fmmut</a>) * FMMUc), <span class="keyword">sizeof</span>(<a class="code" href="../../d8/d38/ethercatmain_8h.html#a0e56c2bdef7489ded7633da7e453d20f">ec_fmmut</a>), 
<a name="l00987"></a>00987           &amp;<a class="code" href="../../d3/d6b/ethercatmain_8c.html#aecfdb60a1628926de0f3cfed483e37fb" title="Main slave data array.">ec_slave</a>[slave].FMMU[FMMUc], <a class="code" href="../../d2/dbb/ethercattype_8h.html#a334e41422731fd6d427d2a7ec790779c" title="timeout value in us for tx frame to return to rx">EC_TIMEOUTRET</a>);
<a name="l00988"></a>00988     }
<a name="l00989"></a>00989     <a class="code" href="../../d5/d74/ethercatbase_8c.html#a2fc76bd01a00a0f6da9fb3927eabc24d" title="FPWR &amp;quot;configured address write&amp;quot; primitive.">ec_FPWRw</a>(configadr, <a class="code" href="../../d2/dbb/ethercattype_8h.html#adb49720dc49f7d4e4cf9adbf2948e409a148befce8c8d150d28b6a93d37fe24c2">ECT_REG_ALCTL</a>, htoes(<a class="code" href="../../d2/dbb/ethercattype_8h.html#ac93847b4c4f8ff2d123e3717d55358c1a70c159f70b2c6c4799874eb72b73a6e6" title="Pre-operational.">EC_STATE_PRE_OP</a>) , <a class="code" href="../../d2/dbb/ethercattype_8h.html#a334e41422731fd6d427d2a7ec790779c" title="timeout value in us for tx frame to return to rx">EC_TIMEOUTRET</a>);
<a name="l00990"></a>00990     state = <a class="code" href="../../d3/d6b/ethercatmain_8c.html#a8f77918c0a6a32be1079a11119171901" title="Check actual slave state.">ec_statecheck</a>(slave, <a class="code" href="../../d2/dbb/ethercattype_8h.html#ac93847b4c4f8ff2d123e3717d55358c1a70c159f70b2c6c4799874eb72b73a6e6" title="Pre-operational.">EC_STATE_PRE_OP</a>, <a class="code" href="../../d2/dbb/ethercattype_8h.html#ad62eda81b3771cefb501543b184d64ad" title="timeout value in us for check statechange">EC_TIMEOUTSTATE</a>); <span class="comment">/* check state change pre-op */</span>
<a name="l00991"></a>00991     <span class="keywordflow">if</span>( state == <a class="code" href="../../d2/dbb/ethercattype_8h.html#ac93847b4c4f8ff2d123e3717d55358c1a70c159f70b2c6c4799874eb72b73a6e6" title="Pre-operational.">EC_STATE_PRE_OP</a>)
<a name="l00992"></a>00992     {
<a name="l00993"></a>00993       <a class="code" href="../../d5/d74/ethercatbase_8c.html#a2fc76bd01a00a0f6da9fb3927eabc24d" title="FPWR &amp;quot;configured address write&amp;quot; primitive.">ec_FPWRw</a>(configadr, <a class="code" href="../../d2/dbb/ethercattype_8h.html#adb49720dc49f7d4e4cf9adbf2948e409a148befce8c8d150d28b6a93d37fe24c2">ECT_REG_ALCTL</a>, htoes(<a class="code" href="../../d2/dbb/ethercattype_8h.html#ac93847b4c4f8ff2d123e3717d55358c1acc09f39d0638c3b71e56b3614170810d" title="Safe-operational.">EC_STATE_SAFE_OP</a>) , <a class="code" href="../../d2/dbb/ethercattype_8h.html#a334e41422731fd6d427d2a7ec790779c" title="timeout value in us for tx frame to return to rx">EC_TIMEOUTRET</a>); <span class="comment">/* set safeop status */</span>
<a name="l00994"></a>00994       state = <a class="code" href="../../d3/d6b/ethercatmain_8c.html#a8f77918c0a6a32be1079a11119171901" title="Check actual slave state.">ec_statecheck</a>(slave, <a class="code" href="../../d2/dbb/ethercattype_8h.html#ac93847b4c4f8ff2d123e3717d55358c1acc09f39d0638c3b71e56b3614170810d" title="Safe-operational.">EC_STATE_SAFE_OP</a>, <a class="code" href="../../d2/dbb/ethercattype_8h.html#ad62eda81b3771cefb501543b184d64ad" title="timeout value in us for check statechange">EC_TIMEOUTSTATE</a>); <span class="comment">/* check state change safe-op */</span>
<a name="l00995"></a>00995     }
<a name="l00996"></a>00996   }
<a name="l00997"></a>00997   <span class="keywordflow">return</span> state;   
<a name="l00998"></a>00998 }
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
