<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>youBot Driver: YouBotJoint.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='../../open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='../../closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='../../closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="../../main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="../../annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="../../files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="../../dir_c188f3569ca341e23a607146381c217c.html">youbot</a>
  </div>
</div>
<div class="contents">
<h1>YouBotJoint.cpp</h1><a href="../../d7/d5f/_you_bot_joint_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/****************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"> *</span>
<a name="l00003"></a>00003 <span class="comment"> * Copyright (c) 2011</span>
<a name="l00004"></a>00004 <span class="comment"> * All rights reserved.</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * Hochschule Bonn-Rhein-Sieg</span>
<a name="l00007"></a>00007 <span class="comment"> * University of Applied Sciences</span>
<a name="l00008"></a>00008 <span class="comment"> * Computer Science Department</span>
<a name="l00009"></a>00009 <span class="comment"> *</span>
<a name="l00010"></a>00010 <span class="comment"> * +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>
<a name="l00011"></a>00011 <span class="comment"> *</span>
<a name="l00012"></a>00012 <span class="comment"> * Author:</span>
<a name="l00013"></a>00013 <span class="comment"> * Jan Paulus, Nico Hochgeschwender, Michael Reckhaus, Azamat Shakhimardanov</span>
<a name="l00014"></a>00014 <span class="comment"> * Supervised by:</span>
<a name="l00015"></a>00015 <span class="comment"> * Gerhard K. Kraetzschmar</span>
<a name="l00016"></a>00016 <span class="comment"> *</span>
<a name="l00017"></a>00017 <span class="comment"> * +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>
<a name="l00018"></a>00018 <span class="comment"> *</span>
<a name="l00019"></a>00019 <span class="comment"> * This sofware is published under a dual-license: GNU Lesser General Public </span>
<a name="l00020"></a>00020 <span class="comment"> * License LGPL 2.1 and BSD license. The dual-license implies that users of this</span>
<a name="l00021"></a>00021 <span class="comment"> * code may choose which terms they prefer.</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>
<a name="l00024"></a>00024 <span class="comment"> *</span>
<a name="l00025"></a>00025 <span class="comment"> * Redistribution and use in source and binary forms, with or without</span>
<a name="l00026"></a>00026 <span class="comment"> * modification, are permitted provided that the following conditions are met:</span>
<a name="l00027"></a>00027 <span class="comment"> *</span>
<a name="l00028"></a>00028 <span class="comment"> *     * Redistributions of source code must retain the above copyright</span>
<a name="l00029"></a>00029 <span class="comment"> *       notice, this list of conditions and the following disclaimer.</span>
<a name="l00030"></a>00030 <span class="comment"> *     * Redistributions in binary form must reproduce the above copyright</span>
<a name="l00031"></a>00031 <span class="comment"> *       notice, this list of conditions and the following disclaimer in the</span>
<a name="l00032"></a>00032 <span class="comment"> *       documentation and/or other materials provided with the distribution.</span>
<a name="l00033"></a>00033 <span class="comment"> *     * Neither the name of the Hochschule Bonn-Rhein-Sieg nor the names of its</span>
<a name="l00034"></a>00034 <span class="comment"> *       contributors may be used to endorse or promote products derived from</span>
<a name="l00035"></a>00035 <span class="comment"> *       this software without specific prior written permission.</span>
<a name="l00036"></a>00036 <span class="comment"> *</span>
<a name="l00037"></a>00037 <span class="comment"> * This program is free software: you can redistribute it and/or modify</span>
<a name="l00038"></a>00038 <span class="comment"> * it under the terms of the GNU Lesser General Public License LGPL as</span>
<a name="l00039"></a>00039 <span class="comment"> * published by the Free Software Foundation, either version 2.1 of the</span>
<a name="l00040"></a>00040 <span class="comment"> * License, or (at your option) any later version or the BSD license.</span>
<a name="l00041"></a>00041 <span class="comment"> *</span>
<a name="l00042"></a>00042 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00043"></a>00043 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00044"></a>00044 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00045"></a>00045 <span class="comment"> * GNU Lesser General Public License LGPL and the BSD license for more details.</span>
<a name="l00046"></a>00046 <span class="comment"> *</span>
<a name="l00047"></a>00047 <span class="comment"> * You should have received a copy of the GNU Lesser General Public</span>
<a name="l00048"></a>00048 <span class="comment"> * License LGPL and BSD license along with this program.</span>
<a name="l00049"></a>00049 <span class="comment"> *</span>
<a name="l00050"></a>00050 <span class="comment"> ****************************************************************/</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d24/_you_bot_joint_8hpp.html">youbot/YouBotJoint.hpp</a>&quot;</span>
<a name="l00052"></a>00052 <span class="keyword">namespace </span>youbot {
<a name="l00053"></a>00053 
<a name="l00054"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a0ffe7fca750e198fd009893ff88ed12b">00054</a> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a0ffe7fca750e198fd009893ff88ed12b">YouBotJoint::YouBotJoint</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> jointNo, <span class="keyword">const</span> std::string&amp; configFilePath) {
<a name="l00055"></a>00055   <span class="comment">// Bouml preserved body begin 000412F1</span>
<a name="l00056"></a>00056     this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a93b5b3410b7a90a42fbf31069a09b345">jointNumber</a> = jointNo;
<a name="l00057"></a>00057     timeTillNextMailboxUpdate = 1; <span class="comment">//ms</span>
<a name="l00058"></a>00058     mailboxMsgRetries = 100;
<a name="l00059"></a>00059     this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a6a97db7684b6287c118f5e110842a2a6">inverseMovementDirection</a> = <span class="keyword">false</span>;
<a name="l00060"></a>00060     this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#ad22e574b25616c48072389ed2bf9e193">lowerLimit</a> = 0;
<a name="l00061"></a>00061     this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#ae6de2fbbcf188614faf212063fc5dc7f">upperLimit</a> = 0;
<a name="l00062"></a>00062     this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a9856b9b0462a7279795164f077005875">areLimitsActive</a> = <span class="keyword">false</span>;
<a name="l00063"></a>00063     std::stringstream jointNameStream;
<a name="l00064"></a>00064     jointNameStream &lt;&lt; <span class="stringliteral">&quot;Joint &quot;</span> &lt;&lt; this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a93b5b3410b7a90a42fbf31069a09b345">jointNumber</a> &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;
<a name="l00065"></a>00065     this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a1877ee40b10fa7cbde430464bb9d0f51">jointNumberStr</a> = jointNameStream.str();
<a name="l00066"></a>00066     ethercatMaster = &amp;(<a class="code" href="../../da/d66/classyoubot_1_1_ethercat_master.html#a5eec05a2312d24b0ae3b0da92e832ff5" title="creates a instance of the singleton EthercatMaster if there is none and returns a...">EthercatMaster::getInstance</a>(<span class="stringliteral">&quot;youbot-ethercat.cfg&quot;</span>, configFilePath));
<a name="l00067"></a>00067     
<a name="l00068"></a>00068   <span class="comment">// Bouml preserved body end 000412F1</span>
<a name="l00069"></a>00069 }
<a name="l00070"></a>00070 
<a name="l00071"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#aef88f4b3cf4df2dda6bc2e4fe87f6b61">00071</a> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#aef88f4b3cf4df2dda6bc2e4fe87f6b61">YouBotJoint::~YouBotJoint</a>() {
<a name="l00072"></a>00072   <span class="comment">// Bouml preserved body begin 00041371</span>
<a name="l00073"></a>00073   <span class="comment">// Bouml preserved body end 00041371</span>
<a name="l00074"></a>00074 }
<a name="l00075"></a>00075 
<a name="l00076"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#adebf485d9ace9463db470a7dc14bfcee">00076</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#adebf485d9ace9463db470a7dc14bfcee">YouBotJoint::setConfigurationParameter</a>(<span class="keyword">const</span> <a class="code" href="../../db/d10/classyoubot_1_1_joint_parameter.html" title="abstract joint parameter">JointParameter</a>&amp; parameter) {
<a name="l00077"></a>00077   <span class="comment">// Bouml preserved body begin 00074271</span>
<a name="l00078"></a>00078   <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;Please use YouBotJointParameters&quot;</span>);
<a name="l00079"></a>00079   <span class="comment">// Bouml preserved body end 00074271</span>
<a name="l00080"></a>00080 }
<a name="l00081"></a>00081 
<a name="l00082"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a4779a68ba8116bb36922ceab60e4b0c0">00082</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a4779a68ba8116bb36922ceab60e4b0c0">YouBotJoint::getConfigurationParameter</a>(<a class="code" href="../../db/d10/classyoubot_1_1_joint_parameter.html" title="abstract joint parameter">JointParameter</a>&amp; parameter) {
<a name="l00083"></a>00083   <span class="comment">// Bouml preserved body begin 0005CE71</span>
<a name="l00084"></a>00084   <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;Please use YouBotJointParameters&quot;</span>);
<a name="l00085"></a>00085   <span class="comment">// Bouml preserved body end 0005CE71</span>
<a name="l00086"></a>00086 }
<a name="l00087"></a>00087 
<a name="l00088"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#aaca8a6335314e2e9672fcb809f794d07">00088</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a4779a68ba8116bb36922ceab60e4b0c0">YouBotJoint::getConfigurationParameter</a>(<a class="code" href="../../db/d27/classyoubot_1_1_you_bot_joint_parameter_read_only.html" title="abstract youBot joint parameter which can be read only">YouBotJointParameterReadOnly</a>&amp; parameter) {
<a name="l00089"></a>00089   <span class="comment">// Bouml preserved body begin 00071FF1</span>
<a name="l00090"></a>00090 
<a name="l00091"></a>00091     <span class="keywordflow">if</span> (parameter.<a class="code" href="../../db/d27/classyoubot_1_1_you_bot_joint_parameter_read_only.html#acdf85290d9d3d5e7cb1d3ce080a3ac66">getType</a>() == MOTOR_CONTOLLER_PARAMETER) {
<a name="l00092"></a>00092 
<a name="l00093"></a>00093       <a class="code" href="../../de/dd3/classyoubot_1_1_you_bot_slave_mailbox_msg.html" title="EtherCAT mailbox message of the youBot slaves.">YouBotSlaveMailboxMsg</a> message;
<a name="l00094"></a>00094       parameter.<a class="code" href="../../db/d27/classyoubot_1_1_you_bot_joint_parameter_read_only.html#a9f731d1f99d7907c24d3c3680da9b7b9">getYouBotMailboxMsg</a>(message, GAP, storage);
<a name="l00095"></a>00095 
<a name="l00096"></a>00096       message.<a class="code" href="../../de/dd3/classyoubot_1_1_you_bot_slave_mailbox_msg.html#aabd9bbfee3a82fb4a3b3fcc0591ccd2b">parameterName</a> = parameter.<a class="code" href="../../db/d27/classyoubot_1_1_you_bot_joint_parameter_read_only.html#aa64d851b233285f68b743639618a0810">getName</a>();
<a name="l00097"></a>00097       <span class="keywordflow">if</span> (retrieveValueFromMotorContoller(message)) {
<a name="l00098"></a>00098         parameter.<a class="code" href="../../db/d27/classyoubot_1_1_you_bot_joint_parameter_read_only.html#ad6989f823f44c86106b3d1558f87c9fb">setYouBotMailboxMsg</a>(message, storage);
<a name="l00099"></a>00099       } <span class="keywordflow">else</span> {
<a name="l00100"></a>00100         <span class="keywordflow">throw</span> <a class="code" href="../../d7/df7/classyoubot_1_1_joint_parameter_exception.html" title="Joint parameter exception.">JointParameterException</a>(<span class="stringliteral">&quot;Unable to get parameter: &quot;</span> + parameter.<a class="code" href="../../db/d27/classyoubot_1_1_you_bot_joint_parameter_read_only.html#aa64d851b233285f68b743639618a0810">getName</a>() + <span class="stringliteral">&quot; from joint: &quot;</span> + this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#ae2b1a60f4a7c817a72cd9ee42c0147d0">jointName</a>);
<a name="l00101"></a>00101       }
<a name="l00102"></a>00102     }<span class="keywordflow">else</span>{
<a name="l00103"></a>00103       <span class="keywordflow">throw</span> <a class="code" href="../../d7/df7/classyoubot_1_1_joint_parameter_exception.html" title="Joint parameter exception.">JointParameterException</a>(<span class="stringliteral">&quot;Parameter &quot;</span> + parameter.<a class="code" href="../../db/d27/classyoubot_1_1_you_bot_joint_parameter_read_only.html#aa64d851b233285f68b743639618a0810">getName</a>() + <span class="stringliteral">&quot; is not a motor controller parameter of a joint&quot;</span>);
<a name="l00104"></a>00104     }
<a name="l00105"></a>00105   <span class="comment">// Bouml preserved body end 00071FF1</span>
<a name="l00106"></a>00106 }
<a name="l00107"></a>00107 
<a name="l00108"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a67e949d3d2ba32b83c85d1e7bbee502b">00108</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a4779a68ba8116bb36922ceab60e4b0c0">YouBotJoint::getConfigurationParameter</a>(<a class="code" href="../../d3/d1d/classyoubot_1_1_you_bot_joint_parameter.html" title="abstract youBot joint parameter">YouBotJointParameter</a>&amp; parameter) {
<a name="l00109"></a>00109   <span class="comment">// Bouml preserved body begin 0005BCF1</span>
<a name="l00110"></a>00110     <span class="keywordflow">if</span> (parameter.<a class="code" href="../../d3/d1d/classyoubot_1_1_you_bot_joint_parameter.html#acdf85290d9d3d5e7cb1d3ce080a3ac66">getType</a>() == MOTOR_CONTOLLER_PARAMETER) {
<a name="l00111"></a>00111 
<a name="l00112"></a>00112       <a class="code" href="../../de/dd3/classyoubot_1_1_you_bot_slave_mailbox_msg.html" title="EtherCAT mailbox message of the youBot slaves.">YouBotSlaveMailboxMsg</a> message;
<a name="l00113"></a>00113       parameter.<a class="code" href="../../d3/d1d/classyoubot_1_1_you_bot_joint_parameter.html#a9f731d1f99d7907c24d3c3680da9b7b9">getYouBotMailboxMsg</a>(message, GAP, storage);
<a name="l00114"></a>00114 
<a name="l00115"></a>00115       message.<a class="code" href="../../de/dd3/classyoubot_1_1_you_bot_slave_mailbox_msg.html#aabd9bbfee3a82fb4a3b3fcc0591ccd2b">parameterName</a> = parameter.<a class="code" href="../../d3/d1d/classyoubot_1_1_you_bot_joint_parameter.html#aa64d851b233285f68b743639618a0810">getName</a>();
<a name="l00116"></a>00116       <span class="keywordflow">if</span> (retrieveValueFromMotorContoller(message)) {
<a name="l00117"></a>00117         parameter.<a class="code" href="../../d3/d1d/classyoubot_1_1_you_bot_joint_parameter.html#ad6989f823f44c86106b3d1558f87c9fb">setYouBotMailboxMsg</a>(message, storage);
<a name="l00118"></a>00118       } <span class="keywordflow">else</span> {
<a name="l00119"></a>00119         <span class="keywordflow">throw</span> <a class="code" href="../../d7/df7/classyoubot_1_1_joint_parameter_exception.html" title="Joint parameter exception.">JointParameterException</a>(<span class="stringliteral">&quot;Unable to get parameter: &quot;</span> + parameter.<a class="code" href="../../d3/d1d/classyoubot_1_1_you_bot_joint_parameter.html#aa64d851b233285f68b743639618a0810">getName</a>() + <span class="stringliteral">&quot; from joint: &quot;</span> + this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#ae2b1a60f4a7c817a72cd9ee42c0147d0">jointName</a>);
<a name="l00120"></a>00120       }
<a name="l00121"></a>00121     }<span class="keywordflow">else</span>{
<a name="l00122"></a>00122       <span class="keywordflow">throw</span> <a class="code" href="../../d7/df7/classyoubot_1_1_joint_parameter_exception.html" title="Joint parameter exception.">JointParameterException</a>(<span class="stringliteral">&quot;Parameter &quot;</span> + parameter.<a class="code" href="../../d3/d1d/classyoubot_1_1_you_bot_joint_parameter.html#aa64d851b233285f68b743639618a0810">getName</a>() + <span class="stringliteral">&quot; is not a motor controller parameter of a joint&quot;</span>);
<a name="l00123"></a>00123     }
<a name="l00124"></a>00124   <span class="comment">// Bouml preserved body end 0005BCF1</span>
<a name="l00125"></a>00125 }
<a name="l00126"></a>00126 
<a name="l00127"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#af794502c50ffdede2acd05ee34a061dc">00127</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#adebf485d9ace9463db470a7dc14bfcee">YouBotJoint::setConfigurationParameter</a>(<span class="keyword">const</span> <a class="code" href="../../d3/d1d/classyoubot_1_1_you_bot_joint_parameter.html" title="abstract youBot joint parameter">YouBotJointParameter</a>&amp; parameter) {
<a name="l00128"></a>00128   <span class="comment">// Bouml preserved body begin 0005BC71</span>
<a name="l00129"></a>00129     <span class="keywordflow">if</span> (parameter.<a class="code" href="../../d3/d1d/classyoubot_1_1_you_bot_joint_parameter.html#acdf85290d9d3d5e7cb1d3ce080a3ac66">getType</a>() == MOTOR_CONTOLLER_PARAMETER) {
<a name="l00130"></a>00130 
<a name="l00131"></a>00131       <a class="code" href="../../de/dd3/classyoubot_1_1_you_bot_slave_mailbox_msg.html" title="EtherCAT mailbox message of the youBot slaves.">YouBotSlaveMailboxMsg</a> message;
<a name="l00132"></a>00132       parameter.<a class="code" href="../../d3/d1d/classyoubot_1_1_you_bot_joint_parameter.html#a9f731d1f99d7907c24d3c3680da9b7b9">getYouBotMailboxMsg</a>(message, SAP, storage);
<a name="l00133"></a>00133 
<a name="l00134"></a>00134       message.<a class="code" href="../../de/dd3/classyoubot_1_1_you_bot_slave_mailbox_msg.html#aabd9bbfee3a82fb4a3b3fcc0591ccd2b">parameterName</a> = parameter.<a class="code" href="../../d3/d1d/classyoubot_1_1_you_bot_joint_parameter.html#aa64d851b233285f68b743639618a0810">getName</a>();
<a name="l00135"></a>00135       <span class="keywordflow">if</span> (!setValueToMotorContoller(message)) {
<a name="l00136"></a>00136         <span class="keywordflow">throw</span> <a class="code" href="../../d7/df7/classyoubot_1_1_joint_parameter_exception.html" title="Joint parameter exception.">JointParameterException</a>(<span class="stringliteral">&quot;Unable to set parameter: &quot;</span> + parameter.<a class="code" href="../../d3/d1d/classyoubot_1_1_you_bot_joint_parameter.html#aa64d851b233285f68b743639618a0810">getName</a>() + <span class="stringliteral">&quot; to joint: &quot;</span> + this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#ae2b1a60f4a7c817a72cd9ee42c0147d0">jointName</a>);
<a name="l00137"></a>00137       }
<a name="l00138"></a>00138     }<span class="keywordflow">else</span>{
<a name="l00139"></a>00139       <span class="keywordflow">throw</span> <a class="code" href="../../d7/df7/classyoubot_1_1_joint_parameter_exception.html" title="Joint parameter exception.">JointParameterException</a>(<span class="stringliteral">&quot;Parameter &quot;</span> + parameter.<a class="code" href="../../d3/d1d/classyoubot_1_1_you_bot_joint_parameter.html#aa64d851b233285f68b743639618a0810">getName</a>() + <span class="stringliteral">&quot; is not a motor controller parameter of a joint&quot;</span>);
<a name="l00140"></a>00140     }
<a name="l00141"></a>00141   <span class="comment">// Bouml preserved body end 0005BC71</span>
<a name="l00142"></a>00142 }
<a name="l00143"></a>00143 
<a name="l00144"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a9f2e490ff51774121f8aa6dfe11eeba6">00144</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a4779a68ba8116bb36922ceab60e4b0c0">YouBotJoint::getConfigurationParameter</a>(<a class="code" href="../../dc/d80/classyoubot_1_1_joint_name.html" title="the name of the joint">JointName</a>&amp; parameter) {
<a name="l00145"></a>00145   <span class="comment">// Bouml preserved body begin 000740F1</span>
<a name="l00146"></a>00146     parameter.value = this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#ae2b1a60f4a7c817a72cd9ee42c0147d0">jointName</a>;
<a name="l00147"></a>00147   <span class="comment">// Bouml preserved body end 000740F1</span>
<a name="l00148"></a>00148 }
<a name="l00149"></a>00149 
<a name="l00150"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a5b3061b62c63d0c4f758dfc9dd2ef890">00150</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#adebf485d9ace9463db470a7dc14bfcee">YouBotJoint::setConfigurationParameter</a>(<span class="keyword">const</span> <a class="code" href="../../dc/d80/classyoubot_1_1_joint_name.html" title="the name of the joint">JointName</a>&amp; parameter) {
<a name="l00151"></a>00151   <span class="comment">// Bouml preserved body begin 0005CDF1</span>
<a name="l00152"></a>00152     this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#ae2b1a60f4a7c817a72cd9ee42c0147d0">jointName</a> = parameter.value;
<a name="l00153"></a>00153   <span class="comment">// Bouml preserved body end 0005CDF1</span>
<a name="l00154"></a>00154 }
<a name="l00155"></a>00155 
<a name="l00156"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#ac6dbb3ddcf558fd2b3fa8ac700747c94">00156</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a4779a68ba8116bb36922ceab60e4b0c0">YouBotJoint::getConfigurationParameter</a>(<a class="code" href="../../d4/d2f/classyoubot_1_1_gear_ratio.html" title="the gear ratio which is needed for the calculations in the youBot driver">GearRatio</a>&amp; parameter) {
<a name="l00157"></a>00157   <span class="comment">// Bouml preserved body begin 00074171</span>
<a name="l00158"></a>00158     parameter.<a class="code" href="../../d4/d2f/classyoubot_1_1_gear_ratio.html#a47b9d75174cb44090b49c4bc44001482">setParameter</a>(this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a1c7f052bd8bc7f3cdf72da82d934e7ef">gearRatio</a>);
<a name="l00159"></a>00159   <span class="comment">// Bouml preserved body end 00074171</span>
<a name="l00160"></a>00160 }
<a name="l00161"></a>00161 
<a name="l00162"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a13a416f1443bfdb0801c10d6cd48d093">00162</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#adebf485d9ace9463db470a7dc14bfcee">YouBotJoint::setConfigurationParameter</a>(<span class="keyword">const</span> <a class="code" href="../../d4/d2f/classyoubot_1_1_gear_ratio.html" title="the gear ratio which is needed for the calculations in the youBot driver">GearRatio</a>&amp; parameter) {
<a name="l00163"></a>00163   <span class="comment">// Bouml preserved body begin 00073FF1</span>
<a name="l00164"></a>00164     <span class="keywordflow">if</span> (parameter.value == 0) {
<a name="l00165"></a>00165       <span class="keywordflow">throw</span> std::out_of_range(<span class="stringliteral">&quot;A Gear Ratio of zero is not allowed&quot;</span>);
<a name="l00166"></a>00166     }
<a name="l00167"></a>00167     this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a1c7f052bd8bc7f3cdf72da82d934e7ef">gearRatio</a> = parameter.value;
<a name="l00168"></a>00168   <span class="comment">// Bouml preserved body end 00073FF1</span>
<a name="l00169"></a>00169 }
<a name="l00170"></a>00170 
<a name="l00171"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a685e0f0477c57113d47a2026a4ddc195">00171</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a4779a68ba8116bb36922ceab60e4b0c0">YouBotJoint::getConfigurationParameter</a>(<a class="code" href="../../db/de4/classyoubot_1_1_encoder_ticks_per_round.html" title="the resolution of the encoders, it is needed for the calculations of the youBot Driver...">EncoderTicksPerRound</a>&amp; parameter) {
<a name="l00172"></a>00172   <span class="comment">// Bouml preserved body begin 000741F1</span>
<a name="l00173"></a>00173     parameter.<a class="code" href="../../db/de4/classyoubot_1_1_encoder_ticks_per_round.html#af229f9bae27972ca5b57863eefe30b79">setParameter</a>(this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#aa7281cbdb97eb444c0c090ee99d24a0f">encoderTicksPerRound</a>);
<a name="l00174"></a>00174   <span class="comment">// Bouml preserved body end 000741F1</span>
<a name="l00175"></a>00175 }
<a name="l00176"></a>00176 
<a name="l00177"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#ad9b7f0fd396ffa625ff96707a8656626">00177</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#adebf485d9ace9463db470a7dc14bfcee">YouBotJoint::setConfigurationParameter</a>(<span class="keyword">const</span> <a class="code" href="../../db/de4/classyoubot_1_1_encoder_ticks_per_round.html" title="the resolution of the encoders, it is needed for the calculations of the youBot Driver...">EncoderTicksPerRound</a>&amp; parameter) {
<a name="l00178"></a>00178   <span class="comment">// Bouml preserved body begin 00074071</span>
<a name="l00179"></a>00179     <span class="keywordflow">if</span> (parameter.value == 0) {
<a name="l00180"></a>00180       <span class="keywordflow">throw</span> std::out_of_range(<span class="stringliteral">&quot;Zero Encoder Ticks per Round are not allowed&quot;</span>);
<a name="l00181"></a>00181     }
<a name="l00182"></a>00182     this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#aa7281cbdb97eb444c0c090ee99d24a0f">encoderTicksPerRound</a> = parameter.value;
<a name="l00183"></a>00183   <span class="comment">// Bouml preserved body end 00074071</span>
<a name="l00184"></a>00184 }
<a name="l00185"></a>00185 
<a name="l00186"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a529929fd65879dec43edf740e5bb426e">00186</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#adebf485d9ace9463db470a7dc14bfcee">YouBotJoint::setConfigurationParameter</a>(<span class="keyword">const</span> <a class="code" href="../../d3/d02/classyoubot_1_1_calibrate_joint.html" title="calibrates the joint">CalibrateJoint</a>&amp; parameter) {
<a name="l00187"></a>00187   <span class="comment">// Bouml preserved body begin 000623F1</span>
<a name="l00188"></a>00188     <span class="keywordflow">if</span> (parameter.doCalibration) {
<a name="l00189"></a>00189       <a class="code" href="../../d3/de3/_logger_8hpp.html#aba7b09d6e8fbe414c23705ad24dde6ff">LOG</a>(info) &lt;&lt; <span class="stringliteral">&quot;Calibrate Joint: &quot;</span> &lt;&lt; this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#ae2b1a60f4a7c817a72cd9ee42c0147d0">jointName</a>;
<a name="l00190"></a>00190 
<a name="l00191"></a>00191       <span class="keywordtype">int</span> calibrationVel = 0; <span class="comment">//rpm</span>
<a name="l00192"></a>00192       <span class="comment">//YouBotSlaveMsg messageBuffer;</span>
<a name="l00193"></a>00193       messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#ac4489f842f825c4fce5c860869545ab4">stctOutput</a>.<a class="code" href="../../df/dc0/structyoubot_1_1_slave_message_output.html#a6e40b9abc9f9fc48eff01d623270f59c">controllerMode</a> = VELOCITY_CONTROL;
<a name="l00194"></a>00194       <span class="keywordflow">if</span> (parameter.calibrationDirection == POSITIV) {
<a name="l00195"></a>00195         calibrationVel = 1.0 / storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a1c7f052bd8bc7f3cdf72da82d934e7ef">gearRatio</a>;
<a name="l00196"></a>00196       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (parameter.calibrationDirection == NEGATIV) {
<a name="l00197"></a>00197         calibrationVel = -1.0 / storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a1c7f052bd8bc7f3cdf72da82d934e7ef">gearRatio</a>;
<a name="l00198"></a>00198       } <span class="keywordflow">else</span> {
<a name="l00199"></a>00199         <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;No calibration direction for joint: &quot;</span> + this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#ae2b1a60f4a7c817a72cd9ee42c0147d0">jointName</a>);
<a name="l00200"></a>00200       }
<a name="l00201"></a>00201 
<a name="l00202"></a>00202       <span class="keywordflow">if</span> (this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a6a97db7684b6287c118f5e110842a2a6">inverseMovementDirection</a> == <span class="keyword">true</span>) {
<a name="l00203"></a>00203         calibrationVel *= -1;
<a name="l00204"></a>00204       }
<a name="l00205"></a>00205 
<a name="l00206"></a>00206       <a class="code" href="../../dd/de0/classyoubot_1_1_joint_sensed_current.html" title="Sensed electric current of the joint.">JointSensedCurrent</a> sensedCurrent;
<a name="l00207"></a>00207 
<a name="l00208"></a>00208       messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#ac4489f842f825c4fce5c860869545ab4">stctOutput</a>.<a class="code" href="../../df/dc0/structyoubot_1_1_slave_message_output.html#a6e40b9abc9f9fc48eff01d623270f59c">controllerMode</a> = VELOCITY_CONTROL;
<a name="l00209"></a>00209       messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#ac4489f842f825c4fce5c860869545ab4">stctOutput</a>.<a class="code" href="../../df/dc0/structyoubot_1_1_slave_message_output.html#ad5794f4b898186ff82eaee88b98ef483">value</a> = calibrationVel;
<a name="l00210"></a>00210       ethercatMaster-&gt;setMsgBuffer(messageBuffer, this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a93b5b3410b7a90a42fbf31069a09b345">jointNumber</a>);
<a name="l00211"></a>00211 
<a name="l00212"></a>00212       sensedCurrent.<a class="code" href="../../dd/de0/classyoubot_1_1_joint_sensed_current.html#a1545cb88cc5c6e94d687b301f0f5b284">current</a> = 0;
<a name="l00213"></a>00213       <span class="comment">//turn till a max current is reached</span>
<a name="l00214"></a>00214       <span class="keywordflow">while</span> (abs(sensedCurrent.<a class="code" href="../../dd/de0/classyoubot_1_1_joint_sensed_current.html#a1545cb88cc5c6e94d687b301f0f5b284">current</a>) &lt; abs(parameter.maxCurrent)) {
<a name="l00215"></a>00215         <a class="code" href="../../d8/d3a/_time_8hpp.html#a44cc0026ac6b473ff071e2b9fd600b7b">SLEEP_MILLISEC</a>(timeTillNextMailboxUpdate);
<a name="l00216"></a>00216         this-&gt;<a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a8b84b61d5a0f4ac8e393d269e4d78f6f">getData</a>(sensedCurrent);
<a name="l00217"></a>00217       }
<a name="l00218"></a>00218 
<a name="l00219"></a>00219       <span class="comment">//stop movement</span>
<a name="l00220"></a>00220       messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#ac4489f842f825c4fce5c860869545ab4">stctOutput</a>.<a class="code" href="../../df/dc0/structyoubot_1_1_slave_message_output.html#a6e40b9abc9f9fc48eff01d623270f59c">controllerMode</a> = VELOCITY_CONTROL;
<a name="l00221"></a>00221       messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#ac4489f842f825c4fce5c860869545ab4">stctOutput</a>.<a class="code" href="../../df/dc0/structyoubot_1_1_slave_message_output.html#ad5794f4b898186ff82eaee88b98ef483">value</a> = 0;
<a name="l00222"></a>00222       <span class="comment">//   LOG(trace) &lt;&lt; &quot;vel [rpm] &quot; &lt;&lt; messageBuffer.stctOutput.value &lt;&lt; &quot; rad_sec &quot; &lt;&lt; data.angularVelocity;</span>
<a name="l00223"></a>00223       ethercatMaster-&gt;setMsgBuffer(messageBuffer, this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a93b5b3410b7a90a42fbf31069a09b345">jointNumber</a>);
<a name="l00224"></a>00224 
<a name="l00225"></a>00225       <span class="comment">//set encoder reference position</span>
<a name="l00226"></a>00226       <a class="code" href="../../d8/d3a/_time_8hpp.html#a44cc0026ac6b473ff071e2b9fd600b7b">SLEEP_MILLISEC</a>(500);
<a name="l00227"></a>00227       messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#ac4489f842f825c4fce5c860869545ab4">stctOutput</a>.<a class="code" href="../../df/dc0/structyoubot_1_1_slave_message_output.html#a6e40b9abc9f9fc48eff01d623270f59c">controllerMode</a> = SET_POSITION_TO_REFERENCE;
<a name="l00228"></a>00228       messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#ac4489f842f825c4fce5c860869545ab4">stctOutput</a>.<a class="code" href="../../df/dc0/structyoubot_1_1_slave_message_output.html#ad5794f4b898186ff82eaee88b98ef483">value</a> = 0;
<a name="l00229"></a>00229       ethercatMaster-&gt;setMsgBuffer(messageBuffer, this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a93b5b3410b7a90a42fbf31069a09b345">jointNumber</a>);
<a name="l00230"></a>00230 
<a name="l00231"></a>00231       <span class="comment">//switch to position controll</span>
<a name="l00232"></a>00232       <a class="code" href="../../d8/d3a/_time_8hpp.html#a44cc0026ac6b473ff071e2b9fd600b7b">SLEEP_MILLISEC</a>(100);
<a name="l00233"></a>00233       messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#ac4489f842f825c4fce5c860869545ab4">stctOutput</a>.<a class="code" href="../../df/dc0/structyoubot_1_1_slave_message_output.html#a6e40b9abc9f9fc48eff01d623270f59c">controllerMode</a> = POSITION_CONTROL;
<a name="l00234"></a>00234       messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#ac4489f842f825c4fce5c860869545ab4">stctOutput</a>.<a class="code" href="../../df/dc0/structyoubot_1_1_slave_message_output.html#ad5794f4b898186ff82eaee88b98ef483">value</a> = 0;
<a name="l00235"></a>00235       <span class="comment">//   LOG(trace) &lt;&lt; &quot;vel [rpm] &quot; &lt;&lt; messageBuffer.stctOutput.value &lt;&lt; &quot; rad_sec &quot; &lt;&lt; data.angularVelocity;</span>
<a name="l00236"></a>00236       ethercatMaster-&gt;setMsgBuffer(messageBuffer, this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a93b5b3410b7a90a42fbf31069a09b345">jointNumber</a>);
<a name="l00237"></a>00237 
<a name="l00238"></a>00238       <span class="comment">//     LOG(info) &lt;&lt; &quot;Calibration finished for joint: &quot; &lt;&lt; this-&gt;storage.jointName;</span>
<a name="l00239"></a>00239     }
<a name="l00240"></a>00240 
<a name="l00241"></a>00241   <span class="comment">// Bouml preserved body end 000623F1</span>
<a name="l00242"></a>00242 }
<a name="l00243"></a>00243 
<a name="l00244"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a08c39112bb58b68f514a2e11dd4da43c">00244</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#adebf485d9ace9463db470a7dc14bfcee">YouBotJoint::setConfigurationParameter</a>(<span class="keyword">const</span> <a class="code" href="../../d6/dfd/classyoubot_1_1_inverse_movement_direction.html" title="inverse the joint movement direction">InverseMovementDirection</a>&amp; parameter) {
<a name="l00245"></a>00245   <span class="comment">// Bouml preserved body begin 000624F1</span>
<a name="l00246"></a>00246     this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a6a97db7684b6287c118f5e110842a2a6">inverseMovementDirection</a> = parameter.value;
<a name="l00247"></a>00247   <span class="comment">// Bouml preserved body end 000624F1</span>
<a name="l00248"></a>00248 }
<a name="l00249"></a>00249 
<a name="l00250"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a3e9203e31ff198830f605a8a7c723a9b">00250</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a4779a68ba8116bb36922ceab60e4b0c0">YouBotJoint::getConfigurationParameter</a>(<a class="code" href="../../d6/dfd/classyoubot_1_1_inverse_movement_direction.html" title="inverse the joint movement direction">InverseMovementDirection</a>&amp; parameter) {
<a name="l00251"></a>00251   <span class="comment">// Bouml preserved body begin 000C9671</span>
<a name="l00252"></a>00252     parameter.<a class="code" href="../../d6/dfd/classyoubot_1_1_inverse_movement_direction.html#a7ae6377a16ca67ea5030a495d7b6452f">setParameter</a>(this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a6a97db7684b6287c118f5e110842a2a6">inverseMovementDirection</a>);
<a name="l00253"></a>00253   <span class="comment">// Bouml preserved body end 000C9671</span>
<a name="l00254"></a>00254 }
<a name="l00255"></a>00255 
<a name="l00256"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#acd7f925057a0c1db899e4a89d20e946a">00256</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#adebf485d9ace9463db470a7dc14bfcee">YouBotJoint::setConfigurationParameter</a>(<span class="keyword">const</span> <a class="code" href="../../db/df5/classyoubot_1_1_joint_limits.html" title="joint position limits in encoder ticks">JointLimits</a>&amp; parameter) {
<a name="l00257"></a>00257   <span class="comment">// Bouml preserved body begin 000D4371</span>
<a name="l00258"></a>00258 
<a name="l00259"></a>00259     this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#ad22e574b25616c48072389ed2bf9e193">lowerLimit</a> = parameter.lowerLimit;
<a name="l00260"></a>00260     this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#ae6de2fbbcf188614faf212063fc5dc7f">upperLimit</a> = parameter.upperLimit;
<a name="l00261"></a>00261     this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a9856b9b0462a7279795164f077005875">areLimitsActive</a> = parameter.areLimitsActive;
<a name="l00262"></a>00262     <a class="code" href="../../d8/d97/classyoubot_1_1_motor_acceleration.html" title="Acceleration parameter for velocity control and position control.">MotorAcceleration</a> acc;
<a name="l00263"></a>00263     quantity&lt;angular_acceleration&gt; accValue;
<a name="l00264"></a>00264     
<a name="l00265"></a>00265 
<a name="l00266"></a>00266     
<a name="l00267"></a>00267     <span class="keywordflow">if</span>(this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a9856b9b0462a7279795164f077005875">areLimitsActive</a>){
<a name="l00268"></a>00268       this-&gt;<a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a4779a68ba8116bb36922ceab60e4b0c0">getConfigurationParameter</a>(acc);
<a name="l00269"></a>00269       acc.<a class="code" href="../../d8/d97/classyoubot_1_1_motor_acceleration.html#aae7a85ec4be12f9d9552bb663b8c1bab">getParameter</a>(accValue);
<a name="l00270"></a>00270       this-&gt;limitMonitor.reset(<span class="keyword">new</span> <a class="code" href="../../dc/d21/classyoubot_1_1_joint_limit_monitor.html" title="It monitors the joint position and will decelerate and stop the joint if it is close...">JointLimitMonitor</a>(this-&gt;storage, accValue));
<a name="l00271"></a>00271       ethercatMaster-&gt;<a class="code" href="../../df/d9a/classyoubot_1_1_ethercat_master_interface.html#a6f99ab5669aadf369ce9fc70a2035713">registerJointLimitMonitor</a>(this-&gt;limitMonitor.get(), this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a93b5b3410b7a90a42fbf31069a09b345">jointNumber</a>);
<a name="l00272"></a>00272     }<span class="keywordflow">else</span>{
<a name="l00273"></a>00273       this-&gt;limitMonitor.reset(NULL);
<a name="l00274"></a>00274     }
<a name="l00275"></a>00275    <span class="comment">//ethercatMaster-&gt;setJointLimits(parameter.lowerLimit, parameter.upperLimit, storage.inverseMovementDirection, parameter.areLimitsActive, this-&gt;storage.jointNumber);</span>
<a name="l00276"></a>00276 
<a name="l00277"></a>00277   <span class="comment">// Bouml preserved body end 000D4371</span>
<a name="l00278"></a>00278 }
<a name="l00279"></a>00279 
<a name="l00280"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#ac9a5cbd80ec9dc8335808d654aa60246">00280</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a4779a68ba8116bb36922ceab60e4b0c0">YouBotJoint::getConfigurationParameter</a>(<a class="code" href="../../db/df5/classyoubot_1_1_joint_limits.html" title="joint position limits in encoder ticks">JointLimits</a>&amp; parameter) {
<a name="l00281"></a>00281   <span class="comment">// Bouml preserved body begin 000C95F1</span>
<a name="l00282"></a>00282     parameter.<a class="code" href="../../db/df5/classyoubot_1_1_joint_limits.html#a7ab2ad7d9ae9f19a5af4eca083a7206d">setParameter</a>(this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#ad22e574b25616c48072389ed2bf9e193">lowerLimit</a>, this-&gt;storage.upperLimit, this-&gt;storage.areLimitsActive);
<a name="l00283"></a>00283   <span class="comment">// Bouml preserved body end 000C95F1</span>
<a name="l00284"></a>00284 }
<a name="l00285"></a>00285 
<a name="l00286"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a2f60e2923f572d854d3a1aef5128de2c">00286</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a4779a68ba8116bb36922ceab60e4b0c0">YouBotJoint::getConfigurationParameter</a>(<a class="code" href="../../db/dc1/classyoubot_1_1_joint_limits_radian.html" title="joint position limits in radian">JointLimitsRadian</a>&amp; parameter) {
<a name="l00287"></a>00287   <span class="comment">// Bouml preserved body begin 000D43F1</span>
<a name="l00288"></a>00288     quantity&lt;plane_angle&gt; lowlimit = ((double) this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#ad22e574b25616c48072389ed2bf9e193">lowerLimit</a> / storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#aa7281cbdb97eb444c0c090ee99d24a0f">encoderTicksPerRound</a>) * storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a1c7f052bd8bc7f3cdf72da82d934e7ef">gearRatio</a> * (2.0 * M_PI) * radian;
<a name="l00289"></a>00289     quantity&lt;plane_angle&gt; uplimit = ((double) this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#ae6de2fbbcf188614faf212063fc5dc7f">upperLimit</a> / storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#aa7281cbdb97eb444c0c090ee99d24a0f">encoderTicksPerRound</a>) * storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a1c7f052bd8bc7f3cdf72da82d934e7ef">gearRatio</a> * (2.0 * M_PI) * radian;
<a name="l00290"></a>00290     parameter.<a class="code" href="../../db/dc1/classyoubot_1_1_joint_limits_radian.html#a8b2768141cf6dd44e21da1ad914668ed">setParameter</a>(lowlimit, uplimit, this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a9856b9b0462a7279795164f077005875">areLimitsActive</a>);
<a name="l00291"></a>00291   <span class="comment">// Bouml preserved body end 000D43F1</span>
<a name="l00292"></a>00292 }
<a name="l00293"></a>00293 <span class="comment"></span>
<a name="l00294"></a>00294 <span class="comment">/// commutation method for firmware 1.48 and below</span>
<a name="l00295"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a5668b35871c41287db13b1ed5a7fa516">00295</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#adebf485d9ace9463db470a7dc14bfcee">YouBotJoint::setConfigurationParameter</a>(<span class="keyword">const</span> <a class="code" href="../../d8/d27/classyoubot_1_1_initialize_joint.html" title="Initialize Joint.">InitializeJoint</a>&amp; parameter) {
<a name="l00296"></a>00296   <span class="comment">// Bouml preserved body begin 000973F1</span>
<a name="l00297"></a>00297     <span class="keywordflow">if</span> (parameter.value) {
<a name="l00298"></a>00298       messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#ac4489f842f825c4fce5c860869545ab4">stctOutput</a>.<a class="code" href="../../df/dc0/structyoubot_1_1_slave_message_output.html#a6e40b9abc9f9fc48eff01d623270f59c">controllerMode</a> = INITIALIZE;
<a name="l00299"></a>00299       messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#ac4489f842f825c4fce5c860869545ab4">stctOutput</a>.<a class="code" href="../../df/dc0/structyoubot_1_1_slave_message_output.html#ad5794f4b898186ff82eaee88b98ef483">value</a> = 0;
<a name="l00300"></a>00300 
<a name="l00301"></a>00301       ethercatMaster-&gt;setMsgBuffer(messageBuffer, this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a93b5b3410b7a90a42fbf31069a09b345">jointNumber</a>);
<a name="l00302"></a>00302     }
<a name="l00303"></a>00303   <span class="comment">// Bouml preserved body end 000973F1</span>
<a name="l00304"></a>00304 }
<a name="l00305"></a>00305 
<a name="l00306"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a3cf393595fb08d4e3a5ae5d8c3fb3ee9">00306</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a4779a68ba8116bb36922ceab60e4b0c0">YouBotJoint::getConfigurationParameter</a>(<a class="code" href="../../d0/d55/classyoubot_1_1_firmware_version.html" title="the firmware version of the joint">FirmwareVersion</a>&amp; parameter) {
<a name="l00307"></a>00307   <span class="comment">// Bouml preserved body begin 0009AA71</span>
<a name="l00308"></a>00308 
<a name="l00309"></a>00309     <a class="code" href="../../de/dd3/classyoubot_1_1_you_bot_slave_mailbox_msg.html" title="EtherCAT mailbox message of the youBot slaves.">YouBotSlaveMailboxMsg</a> message;
<a name="l00310"></a>00310     parameter.getYouBotMailboxMsg(message, GAP, storage);
<a name="l00311"></a>00311 
<a name="l00312"></a>00312     <span class="keywordtype">bool</span> unvalid = <span class="keyword">true</span>;
<a name="l00313"></a>00313     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> retry = 0;
<a name="l00314"></a>00314 
<a name="l00315"></a>00315     ethercatMaster-&gt;setMailboxMsgBuffer(message, this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a93b5b3410b7a90a42fbf31069a09b345">jointNumber</a>);
<a name="l00316"></a>00316 
<a name="l00317"></a>00317     <a class="code" href="../../d8/d3a/_time_8hpp.html#a44cc0026ac6b473ff071e2b9fd600b7b">SLEEP_MILLISEC</a>(timeTillNextMailboxUpdate);
<a name="l00318"></a>00318 
<a name="l00319"></a>00319     <span class="keywordflow">do</span> {
<a name="l00320"></a>00320       <span class="keywordflow">if</span>( ethercatMaster-&gt;getMailboxMsgBuffer(message, this-&gt;storage.jointNumber) ) {
<a name="l00321"></a>00321         unvalid = <span class="keyword">false</span>;
<a name="l00322"></a>00322       } <span class="keywordflow">else</span> {
<a name="l00323"></a>00323         <a class="code" href="../../d8/d3a/_time_8hpp.html#a44cc0026ac6b473ff071e2b9fd600b7b">SLEEP_MILLISEC</a>(timeTillNextMailboxUpdate);
<a name="l00324"></a>00324         retry++;
<a name="l00325"></a>00325       }
<a name="l00326"></a>00326     } <span class="keywordflow">while</span> (retry &lt; mailboxMsgRetries &amp;&amp; unvalid);
<a name="l00327"></a>00327 
<a name="l00328"></a>00328     <span class="keywordflow">if</span> (unvalid) {
<a name="l00329"></a>00329       this-&gt;parseMailboxStatusFlags(message);
<a name="l00330"></a>00330       <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;Unable to get firmware version for joint: &quot;</span> + this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#ae2b1a60f4a7c817a72cd9ee42c0147d0">jointName</a>);
<a name="l00331"></a>00331       <span class="keywordflow">return</span>;
<a name="l00332"></a>00332     } 
<a name="l00333"></a>00333     
<a name="l00334"></a>00334     <span class="keywordtype">char</span> versionString[8] = {0};
<a name="l00335"></a>00335     versionString[0] = message.<a class="code" href="../../de/dd3/classyoubot_1_1_you_bot_slave_mailbox_msg.html#ae21b6d107ed3b4e1ef20017909e98179">stctInput</a>.<a class="code" href="../../d8/dff/structyoubot_1_1mailbox_input_buffer.html#aed6799eb238c482c87c23374c9c153b0">replyAddress</a>;
<a name="l00336"></a>00336     versionString[1] = message.<a class="code" href="../../de/dd3/classyoubot_1_1_you_bot_slave_mailbox_msg.html#ae21b6d107ed3b4e1ef20017909e98179">stctInput</a>.<a class="code" href="../../d8/dff/structyoubot_1_1mailbox_input_buffer.html#adf3c006c84f5bb0c378e208cb31e0e57">moduleAddress</a>;
<a name="l00337"></a>00337     versionString[2] = message.<a class="code" href="../../de/dd3/classyoubot_1_1_you_bot_slave_mailbox_msg.html#ae21b6d107ed3b4e1ef20017909e98179">stctInput</a>.<a class="code" href="../../d8/dff/structyoubot_1_1mailbox_input_buffer.html#ad94584ed274ed1d5b06d52f5bb3a178d">status</a>;
<a name="l00338"></a>00338     versionString[3] = message.<a class="code" href="../../de/dd3/classyoubot_1_1_you_bot_slave_mailbox_msg.html#ae21b6d107ed3b4e1ef20017909e98179">stctInput</a>.<a class="code" href="../../d8/dff/structyoubot_1_1mailbox_input_buffer.html#a5760802fee58450d245fed27eccd0898">commandNumber</a>;
<a name="l00339"></a>00339     versionString[4] = message.<a class="code" href="../../de/dd3/classyoubot_1_1_you_bot_slave_mailbox_msg.html#ae21b6d107ed3b4e1ef20017909e98179">stctInput</a>.<a class="code" href="../../d8/dff/structyoubot_1_1mailbox_input_buffer.html#a825a6aa3f85d5b289f6e1a3b3a2beb83">value</a> &gt;&gt; 24;
<a name="l00340"></a>00340     versionString[5] = message.<a class="code" href="../../de/dd3/classyoubot_1_1_you_bot_slave_mailbox_msg.html#ae21b6d107ed3b4e1ef20017909e98179">stctInput</a>.<a class="code" href="../../d8/dff/structyoubot_1_1mailbox_input_buffer.html#a825a6aa3f85d5b289f6e1a3b3a2beb83">value</a> &gt;&gt; 16;
<a name="l00341"></a>00341     versionString[6] = message.<a class="code" href="../../de/dd3/classyoubot_1_1_you_bot_slave_mailbox_msg.html#ae21b6d107ed3b4e1ef20017909e98179">stctInput</a>.<a class="code" href="../../d8/dff/structyoubot_1_1mailbox_input_buffer.html#a825a6aa3f85d5b289f6e1a3b3a2beb83">value</a> &gt;&gt; 8;
<a name="l00342"></a>00342     versionString[7] = message.<a class="code" href="../../de/dd3/classyoubot_1_1_you_bot_slave_mailbox_msg.html#ae21b6d107ed3b4e1ef20017909e98179">stctInput</a>.<a class="code" href="../../d8/dff/structyoubot_1_1mailbox_input_buffer.html#a825a6aa3f85d5b289f6e1a3b3a2beb83">value</a> &amp; 0xff;
<a name="l00343"></a>00343 
<a name="l00344"></a>00344     <span class="keywordtype">int</span> controllerType = 0;
<a name="l00345"></a>00345     <span class="keywordtype">char</span> firmwareVersion[8] = {0};
<a name="l00346"></a>00346 
<a name="l00347"></a>00347     sscanf (versionString,<span class="stringliteral">&quot;%dV%s&quot;</span>,&amp;controllerType,firmwareVersion);
<a name="l00348"></a>00348     parameter.<a class="code" href="../../d0/d55/classyoubot_1_1_firmware_version.html#a7ec3c2b0db37f092a431f4b8653ff055">setParameter</a>(controllerType, firmwareVersion);
<a name="l00349"></a>00349     <span class="keywordflow">return</span>;
<a name="l00350"></a>00350   <span class="comment">// Bouml preserved body end 0009AA71</span>
<a name="l00351"></a>00351 }
<a name="l00352"></a>00352 <span class="comment"></span>
<a name="l00353"></a>00353 <span class="comment">///this method should be only used if you know what you are doing</span>
<a name="l00354"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a634ab1ff3e59c50e0c8cf583a5cd0a9d">00354</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#adebf485d9ace9463db470a7dc14bfcee">YouBotJoint::setConfigurationParameter</a>(<span class="keyword">const</span> <a class="code" href="../../de/dd3/classyoubot_1_1_you_bot_slave_mailbox_msg.html" title="EtherCAT mailbox message of the youBot slaves.">YouBotSlaveMailboxMsg</a>&amp; parameter) {
<a name="l00355"></a>00355   <span class="comment">// Bouml preserved body begin 000A9D71</span>
<a name="l00356"></a>00356    <span class="keywordflow">if</span> (!setValueToMotorContoller(parameter)) {
<a name="l00357"></a>00357      <span class="keywordflow">throw</span> <a class="code" href="../../d7/df7/classyoubot_1_1_joint_parameter_exception.html" title="Joint parameter exception.">JointParameterException</a>(<span class="stringliteral">&quot;Unable to set parameter at joint: &quot;</span> + this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#ae2b1a60f4a7c817a72cd9ee42c0147d0">jointName</a>);
<a name="l00358"></a>00358    }
<a name="l00359"></a>00359   <span class="comment">// Bouml preserved body end 000A9D71</span>
<a name="l00360"></a>00360 }
<a name="l00361"></a>00361 <span class="comment"></span>
<a name="l00362"></a>00362 <span class="comment">///this method should be only used if you know what you are doing</span>
<a name="l00363"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a6ab27360dc5f39a117217c61db37f853">00363</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a4779a68ba8116bb36922ceab60e4b0c0">YouBotJoint::getConfigurationParameter</a>(<a class="code" href="../../de/dd3/classyoubot_1_1_you_bot_slave_mailbox_msg.html" title="EtherCAT mailbox message of the youBot slaves.">YouBotSlaveMailboxMsg</a>&amp; parameter) {
<a name="l00364"></a>00364   <span class="comment">// Bouml preserved body begin 000A9DF1</span>
<a name="l00365"></a>00365    <span class="keywordflow">if</span> (!retrieveValueFromMotorContoller(parameter)) {
<a name="l00366"></a>00366      <span class="keywordflow">throw</span> <a class="code" href="../../d7/df7/classyoubot_1_1_joint_parameter_exception.html" title="Joint parameter exception.">JointParameterException</a>(<span class="stringliteral">&quot;Unable to get parameter from joint: &quot;</span> + this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#ae2b1a60f4a7c817a72cd9ee42c0147d0">jointName</a>);
<a name="l00367"></a>00367    }
<a name="l00368"></a>00368    this-&gt;parseMailboxStatusFlags(parameter);
<a name="l00369"></a>00369   <span class="comment">// Bouml preserved body end 000A9DF1</span>
<a name="l00370"></a>00370 }
<a name="l00371"></a>00371 
<a name="l00372"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a7823d595faa48c6c2891af3a05bf1ae8">00372</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a4779a68ba8116bb36922ceab60e4b0c0">YouBotJoint::getConfigurationParameter</a>(<a class="code" href="../../dd/de3/classyoubot_1_1_torque_constant.html" title="the resolution of the encoders, it is needed for the calculations of the youBot Driver...">TorqueConstant</a>&amp; parameter) {
<a name="l00373"></a>00373   <span class="comment">// Bouml preserved body begin 000D9571</span>
<a name="l00374"></a>00374    parameter.<a class="code" href="../../dd/de3/classyoubot_1_1_torque_constant.html#a47b9d75174cb44090b49c4bc44001482">setParameter</a>(this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a3f0093fc51e1459de3a71de9ac450fbf">torqueConstant</a>);
<a name="l00375"></a>00375   <span class="comment">// Bouml preserved body end 000D9571</span>
<a name="l00376"></a>00376 }
<a name="l00377"></a>00377 
<a name="l00378"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a9e9cbcbe0513822e1c47e854fdb3c105">00378</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#adebf485d9ace9463db470a7dc14bfcee">YouBotJoint::setConfigurationParameter</a>(<span class="keyword">const</span> <a class="code" href="../../dd/de3/classyoubot_1_1_torque_constant.html" title="the resolution of the encoders, it is needed for the calculations of the youBot Driver...">TorqueConstant</a>&amp; parameter) {
<a name="l00379"></a>00379   <span class="comment">// Bouml preserved body begin 000C7171</span>
<a name="l00380"></a>00380    parameter.<a class="code" href="../../dd/de3/classyoubot_1_1_torque_constant.html#a162f9522486b06d3d3b08d35250b3890">getParameter</a>(this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a3f0093fc51e1459de3a71de9ac450fbf">torqueConstant</a>);
<a name="l00381"></a>00381   <span class="comment">// Bouml preserved body end 000C7171</span>
<a name="l00382"></a>00382 }
<a name="l00383"></a>00383 <span class="comment"></span>
<a name="l00384"></a>00384 <span class="comment">///stores the joint parameter permanent in the EEPROM of the motor contoller</span>
<a name="l00385"></a>00385 <span class="comment">///Attentions: The EEPROM has only a finite number of program-erase cycles</span>
<a name="l00386"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a55094996417c9ac2227f7203fd322c64">00386</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a55094996417c9ac2227f7203fd322c64" title="stores the joint parameter permanent in the EEPROM of the motor contoller Attentions:...">YouBotJoint::storeConfigurationParameterPermanent</a>(<span class="keyword">const</span> <a class="code" href="../../d3/d1d/classyoubot_1_1_you_bot_joint_parameter.html" title="abstract youBot joint parameter">YouBotJointParameter</a>&amp; parameter) {
<a name="l00387"></a>00387   <span class="comment">// Bouml preserved body begin 000919F1</span>
<a name="l00388"></a>00388     <span class="keywordflow">if</span> (parameter.<a class="code" href="../../d3/d1d/classyoubot_1_1_you_bot_joint_parameter.html#acdf85290d9d3d5e7cb1d3ce080a3ac66">getType</a>() == MOTOR_CONTOLLER_PARAMETER) {
<a name="l00389"></a>00389 
<a name="l00390"></a>00390       this-&gt;<a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#adebf485d9ace9463db470a7dc14bfcee">setConfigurationParameter</a>(parameter);
<a name="l00391"></a>00391 
<a name="l00392"></a>00392       <a class="code" href="../../de/dd3/classyoubot_1_1_you_bot_slave_mailbox_msg.html" title="EtherCAT mailbox message of the youBot slaves.">YouBotSlaveMailboxMsg</a> message;
<a name="l00393"></a>00393       parameter.<a class="code" href="../../d3/d1d/classyoubot_1_1_you_bot_joint_parameter.html#a9f731d1f99d7907c24d3c3680da9b7b9">getYouBotMailboxMsg</a>(message, STAP, storage);
<a name="l00394"></a>00394 
<a name="l00395"></a>00395       <span class="keywordflow">if</span> (!setValueToMotorContoller(message)) {
<a name="l00396"></a>00396         <span class="keywordflow">throw</span> <a class="code" href="../../d7/df7/classyoubot_1_1_joint_parameter_exception.html" title="Joint parameter exception.">JointParameterException</a>(<span class="stringliteral">&quot;Unable to store parameter: &quot;</span> + parameter.<a class="code" href="../../d3/d1d/classyoubot_1_1_you_bot_joint_parameter.html#aa64d851b233285f68b743639618a0810">getName</a>() + <span class="stringliteral">&quot; to joint: &quot;</span> + this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#ae2b1a60f4a7c817a72cd9ee42c0147d0">jointName</a>);
<a name="l00397"></a>00397       }
<a name="l00398"></a>00398     }<span class="keywordflow">else</span>{
<a name="l00399"></a>00399       <span class="keywordflow">throw</span> <a class="code" href="../../d7/df7/classyoubot_1_1_joint_parameter_exception.html" title="Joint parameter exception.">JointParameterException</a>(<span class="stringliteral">&quot;Parameter &quot;</span> + parameter.<a class="code" href="../../d3/d1d/classyoubot_1_1_you_bot_joint_parameter.html#aa64d851b233285f68b743639618a0810">getName</a>() + <span class="stringliteral">&quot; is not a motor controller parameter of a joint&quot;</span>);
<a name="l00400"></a>00400     }
<a name="l00401"></a>00401   <span class="comment">// Bouml preserved body end 000919F1</span>
<a name="l00402"></a>00402 }
<a name="l00403"></a>00403 <span class="comment"></span>
<a name="l00404"></a>00404 <span class="comment">/// Restores the joint parameter from the EEPROM.</span>
<a name="l00405"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a73e5e0592773a80e574301a65f1a7806">00405</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a73e5e0592773a80e574301a65f1a7806" title="Restores the joint parameter from the EEPROM.">YouBotJoint::restoreConfigurationParameter</a>(<a class="code" href="../../d3/d1d/classyoubot_1_1_you_bot_joint_parameter.html" title="abstract youBot joint parameter">YouBotJointParameter</a>&amp; parameter) {
<a name="l00406"></a>00406   <span class="comment">// Bouml preserved body begin 00091A71</span>
<a name="l00407"></a>00407     <span class="keywordflow">if</span> (parameter.<a class="code" href="../../d3/d1d/classyoubot_1_1_you_bot_joint_parameter.html#acdf85290d9d3d5e7cb1d3ce080a3ac66">getType</a>() == MOTOR_CONTOLLER_PARAMETER) {
<a name="l00408"></a>00408 
<a name="l00409"></a>00409       <a class="code" href="../../de/dd3/classyoubot_1_1_you_bot_slave_mailbox_msg.html" title="EtherCAT mailbox message of the youBot slaves.">YouBotSlaveMailboxMsg</a> message;
<a name="l00410"></a>00410       parameter.<a class="code" href="../../d3/d1d/classyoubot_1_1_you_bot_joint_parameter.html#a9f731d1f99d7907c24d3c3680da9b7b9">getYouBotMailboxMsg</a>(message, RSAP, storage);
<a name="l00411"></a>00411 
<a name="l00412"></a>00412       <span class="keywordflow">if</span> (!setValueToMotorContoller(message)) {
<a name="l00413"></a>00413         <span class="keywordflow">throw</span> <a class="code" href="../../d7/df7/classyoubot_1_1_joint_parameter_exception.html" title="Joint parameter exception.">JointParameterException</a>(<span class="stringliteral">&quot;Unable to restore parameter: &quot;</span> + parameter.<a class="code" href="../../d3/d1d/classyoubot_1_1_you_bot_joint_parameter.html#aa64d851b233285f68b743639618a0810">getName</a>() + <span class="stringliteral">&quot; at joint: &quot;</span> + this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#ae2b1a60f4a7c817a72cd9ee42c0147d0">jointName</a>);
<a name="l00414"></a>00414       }
<a name="l00415"></a>00415 
<a name="l00416"></a>00416       this-&gt;<a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a4779a68ba8116bb36922ceab60e4b0c0">getConfigurationParameter</a>(parameter);
<a name="l00417"></a>00417     }<span class="keywordflow">else</span>{
<a name="l00418"></a>00418       <span class="keywordflow">throw</span> <a class="code" href="../../d7/df7/classyoubot_1_1_joint_parameter_exception.html" title="Joint parameter exception.">JointParameterException</a>(<span class="stringliteral">&quot;Parameter &quot;</span> + parameter.<a class="code" href="../../d3/d1d/classyoubot_1_1_you_bot_joint_parameter.html#aa64d851b233285f68b743639618a0810">getName</a>() + <span class="stringliteral">&quot; is not a motor controller parameter of a joint&quot;</span>);
<a name="l00419"></a>00419     }
<a name="l00420"></a>00420   <span class="comment">// Bouml preserved body end 00091A71</span>
<a name="l00421"></a>00421 }
<a name="l00422"></a>00422 
<a name="l00423"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#af20dcbd721982e2742c5ee1d0227e8eb">00423</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#af20dcbd721982e2742c5ee1d0227e8eb">YouBotJoint::setData</a>(<span class="keyword">const</span> <a class="code" href="../../de/d09/classyoubot_1_1_joint_data_setpoint.html" title="abstract data class for commanded joint data">JointDataSetpoint</a>&amp; data, SyncMode communicationMode) {
<a name="l00424"></a>00424   <span class="comment">// Bouml preserved body begin 000413F1</span>
<a name="l00425"></a>00425     <a class="code" href="../../d3/de3/_logger_8hpp.html#aba7b09d6e8fbe414c23705ad24dde6ff">LOG</a>(info) &lt;&lt; <span class="stringliteral">&quot;Nothing to do&quot;</span>;
<a name="l00426"></a>00426   <span class="comment">// Bouml preserved body end 000413F1</span>
<a name="l00427"></a>00427 }
<a name="l00428"></a>00428 
<a name="l00429"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a8b84b61d5a0f4ac8e393d269e4d78f6f">00429</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a8b84b61d5a0f4ac8e393d269e4d78f6f">YouBotJoint::getData</a>(<a class="code" href="../../d2/d91/classyoubot_1_1_joint_data.html" title="abstract data class for joints">JointData</a>&amp; data) {
<a name="l00430"></a>00430   <span class="comment">// Bouml preserved body begin 00041471</span>
<a name="l00431"></a>00431     <a class="code" href="../../d3/de3/_logger_8hpp.html#aba7b09d6e8fbe414c23705ad24dde6ff">LOG</a>(info) &lt;&lt; <span class="stringliteral">&quot;Nothing to do&quot;</span>;
<a name="l00432"></a>00432   <span class="comment">// Bouml preserved body end 00041471</span>
<a name="l00433"></a>00433 }
<a name="l00434"></a>00434 <span class="comment"></span>
<a name="l00435"></a>00435 <span class="comment">///commands a position or angle to one joint</span>
<a name="l00436"></a>00436 <span class="comment">///@param data the to command position</span>
<a name="l00437"></a>00437 <span class="comment">///@param communicationMode at the moment only non blocking communication is implemented</span>
<a name="l00438"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a4970188d22bec5016137d9d6d99bcb9f">00438</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#af20dcbd721982e2742c5ee1d0227e8eb">YouBotJoint::setData</a>(<span class="keyword">const</span> <a class="code" href="../../d2/d5d/classyoubot_1_1_joint_angle_setpoint.html" title="Set-point angle / position of the joint.">JointAngleSetpoint</a>&amp; data, SyncMode communicationMode) {
<a name="l00439"></a>00439   <span class="comment">// Bouml preserved body begin 0003C1F1</span>
<a name="l00440"></a>00440 
<a name="l00441"></a>00441     <span class="keywordflow">if</span>(!ethercatMaster-&gt;<a class="code" href="../../df/d9a/classyoubot_1_1_ethercat_master_interface.html#a776f68c61ccca067395c78ce00431fd6">isEtherCATConnectionEstablished</a>()){
<a name="l00442"></a>00442       <span class="keywordflow">throw</span> <a class="code" href="../../d6/d17/classyoubot_1_1_ether_c_a_t_connection_exception.html" title="EtherCAT Connection Error.">EtherCATConnectionException</a>(<span class="stringliteral">&quot;No EtherCAT connection&quot;</span>);
<a name="l00443"></a>00443     }
<a name="l00444"></a>00444     
<a name="l00445"></a>00445     <span class="comment">//YouBotSlaveMsg messageBuffer;</span>
<a name="l00446"></a>00446     ethercatMaster-&gt;getMsgBuffer(this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a93b5b3410b7a90a42fbf31069a09b345">jointNumber</a>, messageBuffer);
<a name="l00447"></a>00447     this-&gt;parseYouBotErrorFlags(messageBuffer);
<a name="l00448"></a>00448     
<a name="l00449"></a>00449     <span class="keywordflow">if</span> (storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a1c7f052bd8bc7f3cdf72da82d934e7ef">gearRatio</a> == 0) {
<a name="l00450"></a>00450       <span class="keywordflow">throw</span> std::out_of_range(<span class="stringliteral">&quot;A Gear Ratio of zero is not allowed&quot;</span>);
<a name="l00451"></a>00451     }
<a name="l00452"></a>00452     
<a name="l00453"></a>00453     <span class="keywordflow">if</span> (storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#aa7281cbdb97eb444c0c090ee99d24a0f">encoderTicksPerRound</a> == 0) {
<a name="l00454"></a>00454       <span class="keywordflow">throw</span> std::out_of_range(<span class="stringliteral">&quot;Zero Encoder Ticks per Round are not allowed&quot;</span>);
<a name="l00455"></a>00455     }
<a name="l00456"></a>00456 
<a name="l00457"></a>00457     <span class="keywordflow">if</span> (this-&gt;limitMonitor != 0)
<a name="l00458"></a>00458      this-&gt;limitMonitor-&gt;checkLimitsPositionControl(data.<a class="code" href="../../d2/d5d/classyoubot_1_1_joint_angle_setpoint.html#a04fcdd16ee9354653ef72ef22a52678c">angle</a>);
<a name="l00459"></a>00459     <span class="comment">/*</span>
<a name="l00460"></a>00460 <span class="comment">    if(storage.areLimitsActive){</span>
<a name="l00461"></a>00461 <span class="comment"></span>
<a name="l00462"></a>00462 <span class="comment">      quantity&lt;plane_angle&gt; lowLimit = ((double) this-&gt;storage.lowerLimit / storage.encoderTicksPerRound) * storage.gearRatio * (2.0 * M_PI) * radian;</span>
<a name="l00463"></a>00463 <span class="comment">      quantity&lt;plane_angle&gt; upLimit = ((double) this-&gt;storage.upperLimit / storage.encoderTicksPerRound) * storage.gearRatio * (2.0 * M_PI) * radian;</span>
<a name="l00464"></a>00464 <span class="comment">      </span>
<a name="l00465"></a>00465 <span class="comment">      if (storage.inverseMovementDirection) {</span>
<a name="l00466"></a>00466 <span class="comment">        upLimit = ((double) -(this-&gt;storage.lowerLimit) / storage.encoderTicksPerRound) * storage.gearRatio * (2.0 * M_PI) * radian;</span>
<a name="l00467"></a>00467 <span class="comment">        lowLimit = ((double) -(this-&gt;storage.upperLimit) / storage.encoderTicksPerRound) * storage.gearRatio * (2.0 * M_PI) * radian;</span>
<a name="l00468"></a>00468 <span class="comment">      }</span>
<a name="l00469"></a>00469 <span class="comment">      </span>
<a name="l00470"></a>00470 <span class="comment"></span>
<a name="l00471"></a>00471 <span class="comment">      if (!((data.angle &lt; upLimit) &amp;&amp; (data.angle &gt; lowLimit))) {</span>
<a name="l00472"></a>00472 <span class="comment">        std::stringstream errorMessageStream;</span>
<a name="l00473"></a>00473 <span class="comment">        errorMessageStream &lt;&lt; &quot;The setpoint angle is out of range. The valid range is between &quot; &lt;&lt; lowLimit &lt;&lt; &quot; and &quot; &lt;&lt; upLimit &lt;&lt; &quot; and it is: &quot; &lt;&lt; data.angle;</span>
<a name="l00474"></a>00474 <span class="comment">        //    LOG(trace) &lt;&lt; &quot;abs_value: &quot; &lt;&lt; abs(data.angle) &lt;&lt; &quot; abslow &quot; &lt;&lt; abs(lowLimit) &lt;&lt; &quot; absupper &quot; &lt;&lt; abs(upLimit);</span>
<a name="l00475"></a>00475 <span class="comment">        throw std::out_of_range(errorMessageStream.str());</span>
<a name="l00476"></a>00476 <span class="comment">      }</span>
<a name="l00477"></a>00477 <span class="comment">    }</span>
<a name="l00478"></a>00478 <span class="comment">    */</span>
<a name="l00479"></a>00479     messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#ac4489f842f825c4fce5c860869545ab4">stctOutput</a>.<a class="code" href="../../df/dc0/structyoubot_1_1_slave_message_output.html#a6e40b9abc9f9fc48eff01d623270f59c">controllerMode</a> = POSITION_CONTROL;
<a name="l00480"></a>00480     messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#ac4489f842f825c4fce5c860869545ab4">stctOutput</a>.<a class="code" href="../../df/dc0/structyoubot_1_1_slave_message_output.html#ad5794f4b898186ff82eaee88b98ef483">value</a> = (<a class="code" href="../../d2/dbb/ethercattype_8h.html#a43d43196463bde49cb067f5c20ab8481">int32</a>) round((data.<a class="code" href="../../d2/d5d/classyoubot_1_1_joint_angle_setpoint.html#a04fcdd16ee9354653ef72ef22a52678c">angle</a>.value() * ((double) storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#aa7281cbdb97eb444c0c090ee99d24a0f">encoderTicksPerRound</a> / (2.0 * M_PI))) / storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a1c7f052bd8bc7f3cdf72da82d934e7ef">gearRatio</a>);
<a name="l00481"></a>00481 
<a name="l00482"></a>00482 
<a name="l00483"></a>00483     <span class="keywordflow">if</span> (storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a6a97db7684b6287c118f5e110842a2a6">inverseMovementDirection</a>) {
<a name="l00484"></a>00484       messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#ac4489f842f825c4fce5c860869545ab4">stctOutput</a>.<a class="code" href="../../df/dc0/structyoubot_1_1_slave_message_output.html#ad5794f4b898186ff82eaee88b98ef483">value</a> *= -1;
<a name="l00485"></a>00485     }
<a name="l00486"></a>00486     <span class="comment">//   LOG(trace) &lt;&lt; &quot;value: &quot; &lt;&lt; data.angle &lt;&lt; &quot; gear &quot; &lt;&lt; gearRatio &lt;&lt; &quot; encoderperRound &quot; &lt;&lt; encoderTicksPerRound &lt;&lt; &quot; encPos &quot; &lt;&lt; messageBuffer.stctOutput.value &lt;&lt; &quot; joint &quot; &lt;&lt; this-&gt;storage.jointNumber;</span>
<a name="l00487"></a>00487     ethercatMaster-&gt;setMsgBuffer(messageBuffer, this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a93b5b3410b7a90a42fbf31069a09b345">jointNumber</a>);
<a name="l00488"></a>00488   <span class="comment">// Bouml preserved body end 0003C1F1</span>
<a name="l00489"></a>00489 }
<a name="l00490"></a>00490 <span class="comment"></span>
<a name="l00491"></a>00491 <span class="comment">///commands a encoder value (position) to one joint</span>
<a name="l00492"></a>00492 <span class="comment">///@param data the to command encoder value</span>
<a name="l00493"></a>00493 <span class="comment">///@param communicationMode at the moment only non blocking communication is implemented</span>
<a name="l00494"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#af78df7a0a9efafe91de3a1fd9202127b">00494</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#af20dcbd721982e2742c5ee1d0227e8eb">YouBotJoint::setData</a>(<span class="keyword">const</span> <a class="code" href="../../d3/d68/classyoubot_1_1_joint_encoder_setpoint.html" title="encoder ticks setpoint of the joint">JointEncoderSetpoint</a>&amp; data, SyncMode communicationMode) {
<a name="l00495"></a>00495   <span class="comment">// Bouml preserved body begin 000C2371</span>
<a name="l00496"></a>00496 
<a name="l00497"></a>00497     <span class="keywordflow">if</span>(!ethercatMaster-&gt;<a class="code" href="../../df/d9a/classyoubot_1_1_ethercat_master_interface.html#a776f68c61ccca067395c78ce00431fd6">isEtherCATConnectionEstablished</a>()){
<a name="l00498"></a>00498       <span class="keywordflow">throw</span> <a class="code" href="../../d6/d17/classyoubot_1_1_ether_c_a_t_connection_exception.html" title="EtherCAT Connection Error.">EtherCATConnectionException</a>(<span class="stringliteral">&quot;No EtherCAT connection&quot;</span>);
<a name="l00499"></a>00499     }
<a name="l00500"></a>00500     
<a name="l00501"></a>00501     <span class="comment">//YouBotSlaveMsg messageBuffer;</span>
<a name="l00502"></a>00502     ethercatMaster-&gt;getMsgBuffer(this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a93b5b3410b7a90a42fbf31069a09b345">jointNumber</a>, messageBuffer);
<a name="l00503"></a>00503     this-&gt;parseYouBotErrorFlags(messageBuffer);
<a name="l00504"></a>00504     
<a name="l00505"></a>00505     <span class="keywordflow">if</span> (this-&gt;limitMonitor != 0)
<a name="l00506"></a>00506      this-&gt;limitMonitor-&gt;checkLimitsEncoderPosition(data.<a class="code" href="../../d3/d68/classyoubot_1_1_joint_encoder_setpoint.html#ac07011b7b49a920db4fe889edb8b368f">encoderTicks</a>);
<a name="l00507"></a>00507   
<a name="l00508"></a>00508     <span class="comment">/*</span>
<a name="l00509"></a>00509 <span class="comment">    if(storage.areLimitsActive){</span>
<a name="l00510"></a>00510 <span class="comment"></span>
<a name="l00511"></a>00511 <span class="comment">      if (!((data.encoderTicks &lt; this-&gt;storage.upperLimit) &amp;&amp; (data.encoderTicks &gt; this-&gt;storage.lowerLimit))) {</span>
<a name="l00512"></a>00512 <span class="comment">        std::stringstream errorMessageStream;</span>
<a name="l00513"></a>00513 <span class="comment">        errorMessageStream &lt;&lt; &quot;The setpoint angle is out of range. The valid range is between &quot; &lt;&lt; this-&gt;storage.lowerLimit &lt;&lt; &quot; and &quot; &lt;&lt; this-&gt;storage.upperLimit &lt;&lt; &quot; and it is: &quot; &lt;&lt; data.encoderTicks;</span>
<a name="l00514"></a>00514 <span class="comment">        //    LOG(trace) &lt;&lt; &quot;abs_value: &quot; &lt;&lt; abs(data.angle) &lt;&lt; &quot; abslow &quot; &lt;&lt; abs(lowLimit) &lt;&lt; &quot; absupper &quot; &lt;&lt; abs(upLimit);</span>
<a name="l00515"></a>00515 <span class="comment">        throw std::out_of_range(errorMessageStream.str());</span>
<a name="l00516"></a>00516 <span class="comment">      }</span>
<a name="l00517"></a>00517 <span class="comment">    }</span>
<a name="l00518"></a>00518 <span class="comment">  */</span>
<a name="l00519"></a>00519     messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#ac4489f842f825c4fce5c860869545ab4">stctOutput</a>.<a class="code" href="../../df/dc0/structyoubot_1_1_slave_message_output.html#a6e40b9abc9f9fc48eff01d623270f59c">controllerMode</a> = POSITION_CONTROL;
<a name="l00520"></a>00520     messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#ac4489f842f825c4fce5c860869545ab4">stctOutput</a>.<a class="code" href="../../df/dc0/structyoubot_1_1_slave_message_output.html#ad5794f4b898186ff82eaee88b98ef483">value</a> = data.<a class="code" href="../../d3/d68/classyoubot_1_1_joint_encoder_setpoint.html#ac07011b7b49a920db4fe889edb8b368f">encoderTicks</a>;
<a name="l00521"></a>00521     
<a name="l00522"></a>00522     <span class="keywordflow">if</span> (storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a6a97db7684b6287c118f5e110842a2a6">inverseMovementDirection</a>) {
<a name="l00523"></a>00523       messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#ac4489f842f825c4fce5c860869545ab4">stctOutput</a>.<a class="code" href="../../df/dc0/structyoubot_1_1_slave_message_output.html#ad5794f4b898186ff82eaee88b98ef483">value</a> *= -1;
<a name="l00524"></a>00524     }
<a name="l00525"></a>00525     
<a name="l00526"></a>00526      ethercatMaster-&gt;setMsgBuffer(messageBuffer, this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a93b5b3410b7a90a42fbf31069a09b345">jointNumber</a>);
<a name="l00527"></a>00527   <span class="comment">// Bouml preserved body end 000C2371</span>
<a name="l00528"></a>00528 }
<a name="l00529"></a>00529 <span class="comment"></span>
<a name="l00530"></a>00530 <span class="comment">///gets the position or angle of one joint which have been calculated from the actual encoder value </span>
<a name="l00531"></a>00531 <span class="comment">///@param data returns the angle by reference</span>
<a name="l00532"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a1cfedacb30f38d70c4ba489d337887a3">00532</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a8b84b61d5a0f4ac8e393d269e4d78f6f">YouBotJoint::getData</a>(<a class="code" href="../../d1/d86/classyoubot_1_1_joint_sensed_angle.html" title="Sensed position / angle of the joint.">JointSensedAngle</a>&amp; data) {
<a name="l00533"></a>00533   <span class="comment">// Bouml preserved body begin 0003DCF1</span>
<a name="l00534"></a>00534     <span class="comment">//YouBotSlaveMsg messageBuffer;</span>
<a name="l00535"></a>00535     <span class="keywordflow">if</span>(!ethercatMaster-&gt;<a class="code" href="../../df/d9a/classyoubot_1_1_ethercat_master_interface.html#a776f68c61ccca067395c78ce00431fd6">isEtherCATConnectionEstablished</a>()){
<a name="l00536"></a>00536       <span class="keywordflow">throw</span> <a class="code" href="../../d6/d17/classyoubot_1_1_ether_c_a_t_connection_exception.html" title="EtherCAT Connection Error.">EtherCATConnectionException</a>(<span class="stringliteral">&quot;No EtherCAT connection&quot;</span>);
<a name="l00537"></a>00537     }
<a name="l00538"></a>00538   
<a name="l00539"></a>00539     ethercatMaster-&gt;getMsgBuffer(this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a93b5b3410b7a90a42fbf31069a09b345">jointNumber</a>, messageBuffer);
<a name="l00540"></a>00540     this-&gt;parseYouBotErrorFlags(messageBuffer);
<a name="l00541"></a>00541 
<a name="l00542"></a>00542     <span class="keywordflow">if</span> (storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a1c7f052bd8bc7f3cdf72da82d934e7ef">gearRatio</a> == 0) {
<a name="l00543"></a>00543       <span class="keywordflow">throw</span> std::out_of_range(<span class="stringliteral">&quot;A Gear Ratio of zero is not allowed&quot;</span>);
<a name="l00544"></a>00544     }
<a name="l00545"></a>00545     <span class="keywordflow">if</span> (storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#aa7281cbdb97eb444c0c090ee99d24a0f">encoderTicksPerRound</a> == 0) {
<a name="l00546"></a>00546       <span class="keywordflow">throw</span> std::out_of_range(<span class="stringliteral">&quot;Zero Encoder Ticks per Round are not allowed&quot;</span>);
<a name="l00547"></a>00547     }
<a name="l00548"></a>00548     <span class="comment">//  LOG(trace) &lt;&lt; &quot;enc: &quot; &lt;&lt; messageBuffer.stctInput.actualPosition;</span>
<a name="l00549"></a>00549     data.<a class="code" href="../../d1/d86/classyoubot_1_1_joint_sensed_angle.html#a04fcdd16ee9354653ef72ef22a52678c">angle</a> = ((double) messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#a66dcf6b0edf8b481feda9a9dc402efc9">stctInput</a>.<a class="code" href="../../d1/d88/structyoubot_1_1_slave_message_input.html#acf08e6420b0bb3f814c0d1b3655434cd">actualPosition</a> / storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#aa7281cbdb97eb444c0c090ee99d24a0f">encoderTicksPerRound</a>) * storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a1c7f052bd8bc7f3cdf72da82d934e7ef">gearRatio</a> * (2.0 * M_PI) * radian;
<a name="l00550"></a>00550 
<a name="l00551"></a>00551     <span class="keywordflow">if</span> (storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a6a97db7684b6287c118f5e110842a2a6">inverseMovementDirection</a>) {
<a name="l00552"></a>00552       data.<a class="code" href="../../d1/d86/classyoubot_1_1_joint_sensed_angle.html#a04fcdd16ee9354653ef72ef22a52678c">angle</a> = -data.<a class="code" href="../../d1/d86/classyoubot_1_1_joint_sensed_angle.html#a04fcdd16ee9354653ef72ef22a52678c">angle</a>;
<a name="l00553"></a>00553     }
<a name="l00554"></a>00554   <span class="comment">// Bouml preserved body end 0003DCF1</span>
<a name="l00555"></a>00555 }
<a name="l00556"></a>00556 <span class="comment"></span>
<a name="l00557"></a>00557 <span class="comment">///commands a velocity to one joint</span>
<a name="l00558"></a>00558 <span class="comment">///@param data the to command velocity</span>
<a name="l00559"></a>00559 <span class="comment">///@param communicationMode at the moment only non blocking communication is implemented</span>
<a name="l00560"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a514edf42ac98906e023cd07480176f72">00560</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#af20dcbd721982e2742c5ee1d0227e8eb">YouBotJoint::setData</a>(<span class="keyword">const</span> <a class="code" href="../../d3/d6c/classyoubot_1_1_joint_velocity_setpoint.html" title="Set-point velocity of the joint.">JointVelocitySetpoint</a>&amp; data, SyncMode communicationMode) {
<a name="l00561"></a>00561   <span class="comment">// Bouml preserved body begin 0003C371</span>
<a name="l00562"></a>00562     <span class="keywordflow">if</span>(!ethercatMaster-&gt;<a class="code" href="../../df/d9a/classyoubot_1_1_ethercat_master_interface.html#a776f68c61ccca067395c78ce00431fd6">isEtherCATConnectionEstablished</a>()){
<a name="l00563"></a>00563       <span class="keywordflow">throw</span> <a class="code" href="../../d6/d17/classyoubot_1_1_ether_c_a_t_connection_exception.html" title="EtherCAT Connection Error.">EtherCATConnectionException</a>(<span class="stringliteral">&quot;No EtherCAT connection&quot;</span>);
<a name="l00564"></a>00564     }
<a name="l00565"></a>00565     
<a name="l00566"></a>00566     <span class="comment">//YouBotSlaveMsg messageBuffer;</span>
<a name="l00567"></a>00567     ethercatMaster-&gt;getMsgBuffer(this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a93b5b3410b7a90a42fbf31069a09b345">jointNumber</a>, messageBuffer);
<a name="l00568"></a>00568     this-&gt;parseYouBotErrorFlags(messageBuffer);
<a name="l00569"></a>00569   
<a name="l00570"></a>00570     messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#ac4489f842f825c4fce5c860869545ab4">stctOutput</a>.<a class="code" href="../../df/dc0/structyoubot_1_1_slave_message_output.html#a6e40b9abc9f9fc48eff01d623270f59c">controllerMode</a> = VELOCITY_CONTROL;
<a name="l00571"></a>00571 
<a name="l00572"></a>00572     <span class="keywordflow">if</span> (storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a1c7f052bd8bc7f3cdf72da82d934e7ef">gearRatio</a> == 0) {
<a name="l00573"></a>00573       <span class="keywordflow">throw</span> std::out_of_range(<span class="stringliteral">&quot;A Gear Ratio of 0 is not allowed&quot;</span>);
<a name="l00574"></a>00574     }
<a name="l00575"></a>00575 
<a name="l00576"></a>00576     messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#ac4489f842f825c4fce5c860869545ab4">stctOutput</a>.<a class="code" href="../../df/dc0/structyoubot_1_1_slave_message_output.html#ad5794f4b898186ff82eaee88b98ef483">value</a> = (<a class="code" href="../../d2/dbb/ethercattype_8h.html#a43d43196463bde49cb067f5c20ab8481">int32</a>) round((data.<a class="code" href="../../d3/d6c/classyoubot_1_1_joint_velocity_setpoint.html#a92bb2f1df8de29685f80e488b24792c0">angularVelocity</a>.value() / (storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a1c7f052bd8bc7f3cdf72da82d934e7ef">gearRatio</a> * 2.0 * M_PI)) * 60.0);
<a name="l00577"></a>00577     <span class="keywordflow">if</span> (storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a6a97db7684b6287c118f5e110842a2a6">inverseMovementDirection</a>) {
<a name="l00578"></a>00578       messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#ac4489f842f825c4fce5c860869545ab4">stctOutput</a>.<a class="code" href="../../df/dc0/structyoubot_1_1_slave_message_output.html#ad5794f4b898186ff82eaee88b98ef483">value</a> *= -1;
<a name="l00579"></a>00579     }
<a name="l00580"></a>00580 
<a name="l00581"></a>00581     <span class="comment">//  LOG(trace) &lt;&lt; &quot;vel [rpm] &quot; &lt;&lt; messageBuffer.stctOutput.value &lt;&lt; &quot; rad_sec &quot; &lt;&lt; data.angularVelocity;</span>
<a name="l00582"></a>00582     ethercatMaster-&gt;setMsgBuffer(messageBuffer, this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a93b5b3410b7a90a42fbf31069a09b345">jointNumber</a>);
<a name="l00583"></a>00583   <span class="comment">// Bouml preserved body end 0003C371</span>
<a name="l00584"></a>00584 }
<a name="l00585"></a>00585 <span class="comment"></span>
<a name="l00586"></a>00586 <span class="comment">///gets the velocity of one joint</span>
<a name="l00587"></a>00587 <span class="comment">///@param data returns the velocity by reference</span>
<a name="l00588"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a598aacbb2e4bf65375aeade1f20c600d">00588</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a8b84b61d5a0f4ac8e393d269e4d78f6f">YouBotJoint::getData</a>(<a class="code" href="../../dc/ddd/classyoubot_1_1_joint_sensed_velocity.html" title="Sensed velocity of the joint.">JointSensedVelocity</a>&amp; data) {
<a name="l00589"></a>00589   <span class="comment">// Bouml preserved body begin 0003DD71</span>
<a name="l00590"></a>00590     <span class="keywordflow">if</span>(!ethercatMaster-&gt;<a class="code" href="../../df/d9a/classyoubot_1_1_ethercat_master_interface.html#a776f68c61ccca067395c78ce00431fd6">isEtherCATConnectionEstablished</a>()){
<a name="l00591"></a>00591       <span class="keywordflow">throw</span> <a class="code" href="../../d6/d17/classyoubot_1_1_ether_c_a_t_connection_exception.html" title="EtherCAT Connection Error.">EtherCATConnectionException</a>(<span class="stringliteral">&quot;No EtherCAT connection&quot;</span>);
<a name="l00592"></a>00592     }
<a name="l00593"></a>00593     
<a name="l00594"></a>00594     <span class="comment">//YouBotSlaveMsg messageBuffer;</span>
<a name="l00595"></a>00595     ethercatMaster-&gt;getMsgBuffer(this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a93b5b3410b7a90a42fbf31069a09b345">jointNumber</a>, messageBuffer);
<a name="l00596"></a>00596     this-&gt;parseYouBotErrorFlags(messageBuffer);
<a name="l00597"></a>00597 
<a name="l00598"></a>00598     <span class="keywordflow">if</span> (storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a1c7f052bd8bc7f3cdf72da82d934e7ef">gearRatio</a> == 0) {
<a name="l00599"></a>00599       <span class="keywordflow">throw</span> std::out_of_range(<span class="stringliteral">&quot;A Gear Ratio of 0 is not allowed&quot;</span>);
<a name="l00600"></a>00600     }
<a name="l00601"></a>00601     <span class="keywordtype">double</span> motorRPM = messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#a66dcf6b0edf8b481feda9a9dc402efc9">stctInput</a>.<a class="code" href="../../d1/d88/structyoubot_1_1_slave_message_input.html#a035aad0e5f882ba9eaf8ee2c1b9e01c9">actualVelocity</a>;
<a name="l00602"></a>00602     <span class="comment">//convert RPM of the motor to radian per second of the wheel/joint</span>
<a name="l00603"></a>00603     data.<a class="code" href="../../dc/ddd/classyoubot_1_1_joint_sensed_velocity.html#a1c682edc27f2f80f174781ef3748d376">angularVelocity</a> = ((motorRPM / 60.0) * storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a1c7f052bd8bc7f3cdf72da82d934e7ef">gearRatio</a> * 2.0 * M_PI) * radian_per_second;
<a name="l00604"></a>00604     
<a name="l00605"></a>00605     <span class="keywordflow">if</span> (storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a6a97db7684b6287c118f5e110842a2a6">inverseMovementDirection</a>) {
<a name="l00606"></a>00606       data.<a class="code" href="../../dc/ddd/classyoubot_1_1_joint_sensed_velocity.html#a1c682edc27f2f80f174781ef3748d376">angularVelocity</a> *= -1;
<a name="l00607"></a>00607     }
<a name="l00608"></a>00608   <span class="comment">// Bouml preserved body end 0003DD71</span>
<a name="l00609"></a>00609 }
<a name="l00610"></a>00610 <span class="comment"></span>
<a name="l00611"></a>00611 <span class="comment">///gets the velocity in round per minute of one joint</span>
<a name="l00612"></a>00612 <span class="comment">///@param data returns the velocity by reference</span>
<a name="l00613"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#af5669a17b45d84bf976abd9da43c9f9d">00613</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a8b84b61d5a0f4ac8e393d269e4d78f6f">YouBotJoint::getData</a>(<a class="code" href="../../d0/d26/classyoubot_1_1_joint_sensed_rounds_per_minute.html" title="Sensed rounds per minute (rpm) of the joint.">JointSensedRoundsPerMinute</a>&amp; data) {
<a name="l00614"></a>00614   <span class="comment">// Bouml preserved body begin 000AEC71</span>
<a name="l00615"></a>00615     <span class="keywordflow">if</span>(!ethercatMaster-&gt;<a class="code" href="../../df/d9a/classyoubot_1_1_ethercat_master_interface.html#a776f68c61ccca067395c78ce00431fd6">isEtherCATConnectionEstablished</a>()){
<a name="l00616"></a>00616       <span class="keywordflow">throw</span> <a class="code" href="../../d6/d17/classyoubot_1_1_ether_c_a_t_connection_exception.html" title="EtherCAT Connection Error.">EtherCATConnectionException</a>(<span class="stringliteral">&quot;No EtherCAT connection&quot;</span>);
<a name="l00617"></a>00617     }
<a name="l00618"></a>00618     
<a name="l00619"></a>00619     <span class="comment">//YouBotSlaveMsg messageBuffer;</span>
<a name="l00620"></a>00620     ethercatMaster-&gt;getMsgBuffer(this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a93b5b3410b7a90a42fbf31069a09b345">jointNumber</a>, messageBuffer);
<a name="l00621"></a>00621     this-&gt;parseYouBotErrorFlags(messageBuffer);
<a name="l00622"></a>00622 
<a name="l00623"></a>00623     data.<a class="code" href="../../d0/d26/classyoubot_1_1_joint_sensed_rounds_per_minute.html#a5d7afecfc9d91f67b0ad7c56202006f6">rpm</a> = messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#a66dcf6b0edf8b481feda9a9dc402efc9">stctInput</a>.<a class="code" href="../../d1/d88/structyoubot_1_1_slave_message_input.html#a035aad0e5f882ba9eaf8ee2c1b9e01c9">actualVelocity</a>;
<a name="l00624"></a>00624     
<a name="l00625"></a>00625     <span class="keywordflow">if</span> (storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a6a97db7684b6287c118f5e110842a2a6">inverseMovementDirection</a>) {
<a name="l00626"></a>00626       data.<a class="code" href="../../d0/d26/classyoubot_1_1_joint_sensed_rounds_per_minute.html#a5d7afecfc9d91f67b0ad7c56202006f6">rpm</a> *= -1;
<a name="l00627"></a>00627     }
<a name="l00628"></a>00628   <span class="comment">// Bouml preserved body end 000AEC71</span>
<a name="l00629"></a>00629 }
<a name="l00630"></a>00630 <span class="comment"></span>
<a name="l00631"></a>00631 <span class="comment">///sets the velocity in round per minute to one joint</span>
<a name="l00632"></a>00632 <span class="comment">///@param data the setpoint velocity</span>
<a name="l00633"></a>00633 <span class="comment">///@param communicationMode at the moment only non blocking communication is implemented</span>
<a name="l00634"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a1cff2447c709fc07a5f4bdab8b5543d4">00634</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#af20dcbd721982e2742c5ee1d0227e8eb">YouBotJoint::setData</a>(<span class="keyword">const</span> <a class="code" href="../../d6/d5b/classyoubot_1_1_joint_rounds_per_minute_setpoint.html" title="Rounds per minute set-point of the joint.">JointRoundsPerMinuteSetpoint</a>&amp; data, SyncMode communicationMode) {
<a name="l00635"></a>00635   <span class="comment">// Bouml preserved body begin 000AECF1</span>
<a name="l00636"></a>00636     <span class="keywordflow">if</span>(!ethercatMaster-&gt;<a class="code" href="../../df/d9a/classyoubot_1_1_ethercat_master_interface.html#a776f68c61ccca067395c78ce00431fd6">isEtherCATConnectionEstablished</a>()){
<a name="l00637"></a>00637       <span class="keywordflow">throw</span> <a class="code" href="../../d6/d17/classyoubot_1_1_ether_c_a_t_connection_exception.html" title="EtherCAT Connection Error.">EtherCATConnectionException</a>(<span class="stringliteral">&quot;No EtherCAT connection&quot;</span>);
<a name="l00638"></a>00638     }
<a name="l00639"></a>00639     
<a name="l00640"></a>00640     <span class="comment">//YouBotSlaveMsg messageBuffer;</span>
<a name="l00641"></a>00641     ethercatMaster-&gt;getMsgBuffer(this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a93b5b3410b7a90a42fbf31069a09b345">jointNumber</a>, messageBuffer);
<a name="l00642"></a>00642     this-&gt;parseYouBotErrorFlags(messageBuffer);
<a name="l00643"></a>00643     
<a name="l00644"></a>00644     messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#ac4489f842f825c4fce5c860869545ab4">stctOutput</a>.<a class="code" href="../../df/dc0/structyoubot_1_1_slave_message_output.html#a6e40b9abc9f9fc48eff01d623270f59c">controllerMode</a> = VELOCITY_CONTROL;
<a name="l00645"></a>00645     messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#ac4489f842f825c4fce5c860869545ab4">stctOutput</a>.<a class="code" href="../../df/dc0/structyoubot_1_1_slave_message_output.html#ad5794f4b898186ff82eaee88b98ef483">value</a> = data.<a class="code" href="../../d6/d5b/classyoubot_1_1_joint_rounds_per_minute_setpoint.html#a5d7afecfc9d91f67b0ad7c56202006f6">rpm</a>;
<a name="l00646"></a>00646     
<a name="l00647"></a>00647     <span class="keywordflow">if</span> (storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a6a97db7684b6287c118f5e110842a2a6">inverseMovementDirection</a>) {
<a name="l00648"></a>00648       messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#ac4489f842f825c4fce5c860869545ab4">stctOutput</a>.<a class="code" href="../../df/dc0/structyoubot_1_1_slave_message_output.html#ad5794f4b898186ff82eaee88b98ef483">value</a> *= -1;
<a name="l00649"></a>00649     }
<a name="l00650"></a>00650 
<a name="l00651"></a>00651     ethercatMaster-&gt;setMsgBuffer(messageBuffer, this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a93b5b3410b7a90a42fbf31069a09b345">jointNumber</a>);
<a name="l00652"></a>00652   <span class="comment">// Bouml preserved body end 000AECF1</span>
<a name="l00653"></a>00653 }
<a name="l00654"></a>00654 <span class="comment"></span>
<a name="l00655"></a>00655 <span class="comment">///gets the motor current of one joint which have been measured by a hal sensor</span>
<a name="l00656"></a>00656 <span class="comment">///@param data returns the actual motor current by reference</span>
<a name="l00657"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#ad831da23ecd935f3b7217f463ecb8e14">00657</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a8b84b61d5a0f4ac8e393d269e4d78f6f">YouBotJoint::getData</a>(<a class="code" href="../../dd/de0/classyoubot_1_1_joint_sensed_current.html" title="Sensed electric current of the joint.">JointSensedCurrent</a>&amp; data) {
<a name="l00658"></a>00658   <span class="comment">// Bouml preserved body begin 0003DDF1</span>
<a name="l00659"></a>00659     <span class="keywordflow">if</span>(!ethercatMaster-&gt;<a class="code" href="../../df/d9a/classyoubot_1_1_ethercat_master_interface.html#a776f68c61ccca067395c78ce00431fd6">isEtherCATConnectionEstablished</a>()){
<a name="l00660"></a>00660       <span class="keywordflow">throw</span> <a class="code" href="../../d6/d17/classyoubot_1_1_ether_c_a_t_connection_exception.html" title="EtherCAT Connection Error.">EtherCATConnectionException</a>(<span class="stringliteral">&quot;No EtherCAT connection&quot;</span>);
<a name="l00661"></a>00661     }
<a name="l00662"></a>00662     
<a name="l00663"></a>00663     <span class="comment">//YouBotSlaveMsg messageBuffer;</span>
<a name="l00664"></a>00664     ethercatMaster-&gt;getMsgBuffer(this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a93b5b3410b7a90a42fbf31069a09b345">jointNumber</a>, messageBuffer);
<a name="l00665"></a>00665     this-&gt;parseYouBotErrorFlags(messageBuffer);
<a name="l00666"></a>00666     <span class="comment">//convert mili ampere to ampere</span>
<a name="l00667"></a>00667     <span class="keywordtype">double</span> current = messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#a66dcf6b0edf8b481feda9a9dc402efc9">stctInput</a>.<a class="code" href="../../d1/d88/structyoubot_1_1_slave_message_input.html#ae9e593e1723fef8c22218ba3da26955c">actualCurrent</a>;
<a name="l00668"></a>00668     data.<a class="code" href="../../dd/de0/classyoubot_1_1_joint_sensed_current.html#a1545cb88cc5c6e94d687b301f0f5b284">current</a> =  current / 1000.0 * ampere;
<a name="l00669"></a>00669     
<a name="l00670"></a>00670     <span class="keywordflow">if</span> (storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a6a97db7684b6287c118f5e110842a2a6">inverseMovementDirection</a>) {
<a name="l00671"></a>00671       data.<a class="code" href="../../dd/de0/classyoubot_1_1_joint_sensed_current.html#a1545cb88cc5c6e94d687b301f0f5b284">current</a> *= -1;
<a name="l00672"></a>00672     }
<a name="l00673"></a>00673   <span class="comment">// Bouml preserved body end 0003DDF1</span>
<a name="l00674"></a>00674 }
<a name="l00675"></a>00675 <span class="comment"></span>
<a name="l00676"></a>00676 <span class="comment">///commands a current to one joint</span>
<a name="l00677"></a>00677 <span class="comment">///@param data the to command current</span>
<a name="l00678"></a>00678 <span class="comment">///@param communicationMode at the moment only non blocking communication is implemented</span>
<a name="l00679"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#ad6d0f97e2f1860fe551899f208c3ed17">00679</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#af20dcbd721982e2742c5ee1d0227e8eb">YouBotJoint::setData</a>(<span class="keyword">const</span> <a class="code" href="../../d7/d55/classyoubot_1_1_joint_current_setpoint.html" title="Set-point current of the joint.">JointCurrentSetpoint</a>&amp; data, SyncMode communicationMode) {
<a name="l00680"></a>00680   <span class="comment">// Bouml preserved body begin 000955F1</span>
<a name="l00681"></a>00681     <span class="keywordflow">if</span>(!ethercatMaster-&gt;<a class="code" href="../../df/d9a/classyoubot_1_1_ethercat_master_interface.html#a776f68c61ccca067395c78ce00431fd6">isEtherCATConnectionEstablished</a>()){
<a name="l00682"></a>00682       <span class="keywordflow">throw</span> <a class="code" href="../../d6/d17/classyoubot_1_1_ether_c_a_t_connection_exception.html" title="EtherCAT Connection Error.">EtherCATConnectionException</a>(<span class="stringliteral">&quot;No EtherCAT connection&quot;</span>);
<a name="l00683"></a>00683     }
<a name="l00684"></a>00684     
<a name="l00685"></a>00685     <span class="comment">//YouBotSlaveMsg messageBuffer;</span>
<a name="l00686"></a>00686     ethercatMaster-&gt;getMsgBuffer(this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a93b5b3410b7a90a42fbf31069a09b345">jointNumber</a>, messageBuffer);
<a name="l00687"></a>00687     this-&gt;parseYouBotErrorFlags(messageBuffer);
<a name="l00688"></a>00688     
<a name="l00689"></a>00689     messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#ac4489f842f825c4fce5c860869545ab4">stctOutput</a>.<a class="code" href="../../df/dc0/structyoubot_1_1_slave_message_output.html#a6e40b9abc9f9fc48eff01d623270f59c">controllerMode</a> = CURRENT_MODE;
<a name="l00690"></a>00690     messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#ac4489f842f825c4fce5c860869545ab4">stctOutput</a>.<a class="code" href="../../df/dc0/structyoubot_1_1_slave_message_output.html#ad5794f4b898186ff82eaee88b98ef483">value</a> = (<a class="code" href="../../d2/dbb/ethercattype_8h.html#a43d43196463bde49cb067f5c20ab8481">int32</a>) (data.<a class="code" href="../../d7/d55/classyoubot_1_1_joint_current_setpoint.html#a1545cb88cc5c6e94d687b301f0f5b284">current</a>.value() * 1000.0);  <span class="comment">//convert from Ampere to milli Ampere</span>
<a name="l00691"></a>00691     
<a name="l00692"></a>00692     <span class="keywordflow">if</span> (storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a6a97db7684b6287c118f5e110842a2a6">inverseMovementDirection</a>) {
<a name="l00693"></a>00693       messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#ac4489f842f825c4fce5c860869545ab4">stctOutput</a>.<a class="code" href="../../df/dc0/structyoubot_1_1_slave_message_output.html#ad5794f4b898186ff82eaee88b98ef483">value</a> *= -1;
<a name="l00694"></a>00694     }
<a name="l00695"></a>00695     ethercatMaster-&gt;setMsgBuffer(messageBuffer, this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a93b5b3410b7a90a42fbf31069a09b345">jointNumber</a>);
<a name="l00696"></a>00696   <span class="comment">// Bouml preserved body end 000955F1</span>
<a name="l00697"></a>00697 }
<a name="l00698"></a>00698 <span class="comment"></span>
<a name="l00699"></a>00699 <span class="comment">///gets the encoder ticks of one joint</span>
<a name="l00700"></a>00700 <span class="comment">///@param data returns the ticks by reference</span>
<a name="l00701"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a3d6170d18e7ad7492466b7330661ed28">00701</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a8b84b61d5a0f4ac8e393d269e4d78f6f">YouBotJoint::getData</a>(<a class="code" href="../../d3/dec/classyoubot_1_1_joint_sensed_encoder_ticks.html" title="Sensed encoder ticks of the joint.">JointSensedEncoderTicks</a>&amp; data) {
<a name="l00702"></a>00702   <span class="comment">// Bouml preserved body begin 000AB7F1</span>
<a name="l00703"></a>00703     <span class="keywordflow">if</span>(!ethercatMaster-&gt;<a class="code" href="../../df/d9a/classyoubot_1_1_ethercat_master_interface.html#a776f68c61ccca067395c78ce00431fd6">isEtherCATConnectionEstablished</a>()){
<a name="l00704"></a>00704       <span class="keywordflow">throw</span> <a class="code" href="../../d6/d17/classyoubot_1_1_ether_c_a_t_connection_exception.html" title="EtherCAT Connection Error.">EtherCATConnectionException</a>(<span class="stringliteral">&quot;No EtherCAT connection&quot;</span>);
<a name="l00705"></a>00705     }
<a name="l00706"></a>00706     
<a name="l00707"></a>00707     <span class="comment">//YouBotSlaveMsg messageBuffer;</span>
<a name="l00708"></a>00708     ethercatMaster-&gt;getMsgBuffer(this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a93b5b3410b7a90a42fbf31069a09b345">jointNumber</a>, messageBuffer);
<a name="l00709"></a>00709     this-&gt;parseYouBotErrorFlags(messageBuffer);
<a name="l00710"></a>00710 
<a name="l00711"></a>00711     <span class="comment">//  LOG(trace) &lt;&lt; &quot;enc: &quot; &lt;&lt; messageBuffer.stctInput.actualPosition;</span>
<a name="l00712"></a>00712     data.<a class="code" href="../../d3/dec/classyoubot_1_1_joint_sensed_encoder_ticks.html#ac07011b7b49a920db4fe889edb8b368f">encoderTicks</a> = messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#a66dcf6b0edf8b481feda9a9dc402efc9">stctInput</a>.<a class="code" href="../../d1/d88/structyoubot_1_1_slave_message_input.html#acf08e6420b0bb3f814c0d1b3655434cd">actualPosition</a> ;
<a name="l00713"></a>00713     
<a name="l00714"></a>00714     <span class="keywordflow">if</span> (storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a6a97db7684b6287c118f5e110842a2a6">inverseMovementDirection</a>) {
<a name="l00715"></a>00715       data.<a class="code" href="../../d3/dec/classyoubot_1_1_joint_sensed_encoder_ticks.html#ac07011b7b49a920db4fe889edb8b368f">encoderTicks</a> *= -1;
<a name="l00716"></a>00716     }
<a name="l00717"></a>00717 
<a name="l00718"></a>00718   <span class="comment">// Bouml preserved body end 000AB7F1</span>
<a name="l00719"></a>00719 }
<a name="l00720"></a>00720 <span class="comment"></span>
<a name="l00721"></a>00721 <span class="comment">///sets the output part of a EtherCAT slave message</span>
<a name="l00722"></a>00722 <span class="comment">///this methode should be only used if you know what you are doing</span>
<a name="l00723"></a>00723 <span class="comment">///@param data output part of a EtherCAT slave message</span>
<a name="l00724"></a>00724 <span class="comment">///@param communicationMode at the moment only non blocking communication is implemented</span>
<a name="l00725"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a5ac1be4ba9da1a8f42a95d1b736836f1">00725</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#af20dcbd721982e2742c5ee1d0227e8eb">YouBotJoint::setData</a>(<span class="keyword">const</span> <a class="code" href="../../df/dc0/structyoubot_1_1_slave_message_output.html" title="Output part from the EtherCat message of the youBot EtherCat slaves.">SlaveMessageOutput</a>&amp; data, SyncMode communicationMode) {
<a name="l00726"></a>00726   <span class="comment">// Bouml preserved body begin 000C5671</span>
<a name="l00727"></a>00727     <span class="comment">//YouBotSlaveMsg messageBuffer;</span>
<a name="l00728"></a>00728     <span class="keywordflow">if</span>(!ethercatMaster-&gt;<a class="code" href="../../df/d9a/classyoubot_1_1_ethercat_master_interface.html#a776f68c61ccca067395c78ce00431fd6">isEtherCATConnectionEstablished</a>()){
<a name="l00729"></a>00729       <span class="keywordflow">throw</span> <a class="code" href="../../d6/d17/classyoubot_1_1_ether_c_a_t_connection_exception.html" title="EtherCAT Connection Error.">EtherCATConnectionException</a>(<span class="stringliteral">&quot;No EtherCAT connection&quot;</span>);
<a name="l00730"></a>00730     }
<a name="l00731"></a>00731     
<a name="l00732"></a>00732     ethercatMaster-&gt;getMsgBuffer(this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a93b5b3410b7a90a42fbf31069a09b345">jointNumber</a>, messageBuffer);
<a name="l00733"></a>00733     this-&gt;parseYouBotErrorFlags(messageBuffer);
<a name="l00734"></a>00734     
<a name="l00735"></a>00735     messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#ac4489f842f825c4fce5c860869545ab4">stctOutput</a> = data;
<a name="l00736"></a>00736   
<a name="l00737"></a>00737     ethercatMaster-&gt;setMsgBuffer(messageBuffer, this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a93b5b3410b7a90a42fbf31069a09b345">jointNumber</a>);
<a name="l00738"></a>00738   <span class="comment">// Bouml preserved body end 000C5671</span>
<a name="l00739"></a>00739 }
<a name="l00740"></a>00740 <span class="comment"></span>
<a name="l00741"></a>00741 <span class="comment">///gets the input and ouput part of a EtherCAT slave message</span>
<a name="l00742"></a>00742 <span class="comment">///this methode should be only used if you know what you are doing</span>
<a name="l00743"></a>00743 <span class="comment">///@param data returns the sensor values by reference</span>
<a name="l00744"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a60cb7794f5e62cfb866cd4084a11a510">00744</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a8b84b61d5a0f4ac8e393d269e4d78f6f">YouBotJoint::getData</a>(<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html" title="EtherCat message of the youBot EtherCat slaves.">YouBotSlaveMsg</a>&amp; data) {
<a name="l00745"></a>00745   <span class="comment">// Bouml preserved body begin 000C56F1</span>
<a name="l00746"></a>00746     <span class="comment">//YouBotSlaveMsg messageBuffer;</span>
<a name="l00747"></a>00747     <span class="keywordflow">if</span>(!ethercatMaster-&gt;<a class="code" href="../../df/d9a/classyoubot_1_1_ethercat_master_interface.html#a776f68c61ccca067395c78ce00431fd6">isEtherCATConnectionEstablished</a>()){
<a name="l00748"></a>00748       <span class="keywordflow">throw</span> <a class="code" href="../../d6/d17/classyoubot_1_1_ether_c_a_t_connection_exception.html" title="EtherCAT Connection Error.">EtherCATConnectionException</a>(<span class="stringliteral">&quot;No EtherCAT connection&quot;</span>);
<a name="l00749"></a>00749     }
<a name="l00750"></a>00750     
<a name="l00751"></a>00751     ethercatMaster-&gt;getMsgBuffer(this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a93b5b3410b7a90a42fbf31069a09b345">jointNumber</a>, messageBuffer);
<a name="l00752"></a>00752     this-&gt;parseYouBotErrorFlags(messageBuffer);
<a name="l00753"></a>00753 
<a name="l00754"></a>00754     data = messageBuffer;
<a name="l00755"></a>00755   <span class="comment">// Bouml preserved body end 000C56F1</span>
<a name="l00756"></a>00756 }
<a name="l00757"></a>00757 <span class="comment"></span>
<a name="l00758"></a>00758 <span class="comment">///commands a torque to one joint</span>
<a name="l00759"></a>00759 <span class="comment">///@param data the to command torque</span>
<a name="l00760"></a>00760 <span class="comment">///@param communicationMode at the moment only non blocking communication is implemented</span>
<a name="l00761"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a5dbd851f29adb94e66ca07a554419921">00761</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#af20dcbd721982e2742c5ee1d0227e8eb">YouBotJoint::setData</a>(<span class="keyword">const</span> <a class="code" href="../../d8/d45/classyoubot_1_1_joint_torque_setpoint.html" title="The torque set-point of the joint will be set by setting the computed current set-point...">JointTorqueSetpoint</a>&amp; data, SyncMode communicationMode) {
<a name="l00762"></a>00762   <span class="comment">// Bouml preserved body begin 000C7071</span>
<a name="l00763"></a>00763     <span class="keywordflow">if</span>(!ethercatMaster-&gt;<a class="code" href="../../df/d9a/classyoubot_1_1_ethercat_master_interface.html#a776f68c61ccca067395c78ce00431fd6">isEtherCATConnectionEstablished</a>()){
<a name="l00764"></a>00764       <span class="keywordflow">throw</span> <a class="code" href="../../d6/d17/classyoubot_1_1_ether_c_a_t_connection_exception.html" title="EtherCAT Connection Error.">EtherCATConnectionException</a>(<span class="stringliteral">&quot;No EtherCAT connection&quot;</span>);
<a name="l00765"></a>00765     }
<a name="l00766"></a>00766     
<a name="l00767"></a>00767     <a class="code" href="../../d7/d55/classyoubot_1_1_joint_current_setpoint.html" title="Set-point current of the joint.">JointCurrentSetpoint</a> currentSetpoint;
<a name="l00768"></a>00768     
<a name="l00769"></a>00769     <span class="keywordflow">if</span> (this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a3f0093fc51e1459de3a71de9ac450fbf">torqueConstant</a> == 0) {
<a name="l00770"></a>00770       <span class="keywordflow">throw</span> std::out_of_range(<span class="stringliteral">&quot;A torque constant of 0 is not allowed&quot;</span>);
<a name="l00771"></a>00771     }
<a name="l00772"></a>00772    
<a name="l00773"></a>00773     currentSetpoint.<a class="code" href="../../d7/d55/classyoubot_1_1_joint_current_setpoint.html#a1545cb88cc5c6e94d687b301f0f5b284">current</a> = ((data.<a class="code" href="../../d8/d45/classyoubot_1_1_joint_torque_setpoint.html#aeab9b928859187f005beca2b113cfb3a">torque</a>.value()*this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a1c7f052bd8bc7f3cdf72da82d934e7ef">gearRatio</a>)/this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a3f0093fc51e1459de3a71de9ac450fbf">torqueConstant</a>) * ampere;
<a name="l00774"></a>00774     this-&gt;<a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#af20dcbd721982e2742c5ee1d0227e8eb">setData</a>(currentSetpoint);
<a name="l00775"></a>00775   <span class="comment">// Bouml preserved body end 000C7071</span>
<a name="l00776"></a>00776 }
<a name="l00777"></a>00777 <span class="comment"></span>
<a name="l00778"></a>00778 <span class="comment">///gets the motor torque of one joint which have been calculated from the current</span>
<a name="l00779"></a>00779 <span class="comment">///@param data returns the actual motor torque by reference</span>
<a name="l00780"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#ae583e3e1ca03bf6da185a128bb4ef0ce">00780</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a8b84b61d5a0f4ac8e393d269e4d78f6f">YouBotJoint::getData</a>(<a class="code" href="../../d7/d5b/classyoubot_1_1_joint_sensed_torque.html" title="This torque of the joint is computed from the actual current.">JointSensedTorque</a>&amp; data) {
<a name="l00781"></a>00781   <span class="comment">// Bouml preserved body begin 000C70F1</span>
<a name="l00782"></a>00782   <span class="keywordflow">if</span>(!ethercatMaster-&gt;<a class="code" href="../../df/d9a/classyoubot_1_1_ethercat_master_interface.html#a776f68c61ccca067395c78ce00431fd6">isEtherCATConnectionEstablished</a>()){
<a name="l00783"></a>00783       <span class="keywordflow">throw</span> <a class="code" href="../../d6/d17/classyoubot_1_1_ether_c_a_t_connection_exception.html" title="EtherCAT Connection Error.">EtherCATConnectionException</a>(<span class="stringliteral">&quot;No EtherCAT connection&quot;</span>);
<a name="l00784"></a>00784   }
<a name="l00785"></a>00785   
<a name="l00786"></a>00786   <a class="code" href="../../dd/de0/classyoubot_1_1_joint_sensed_current.html" title="Sensed electric current of the joint.">JointSensedCurrent</a> sensedCurrent;
<a name="l00787"></a>00787   this-&gt;<a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a8b84b61d5a0f4ac8e393d269e4d78f6f">getData</a>(sensedCurrent);
<a name="l00788"></a>00788   
<a name="l00789"></a>00789   <span class="keywordflow">if</span> (this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a1c7f052bd8bc7f3cdf72da82d934e7ef">gearRatio</a> == 0) {
<a name="l00790"></a>00790     <span class="keywordflow">throw</span> std::out_of_range(<span class="stringliteral">&quot;A Gear Ratio of 0 is not allowed&quot;</span>);
<a name="l00791"></a>00791   }
<a name="l00792"></a>00792   data.<a class="code" href="../../d7/d5b/classyoubot_1_1_joint_sensed_torque.html#aeab9b928859187f005beca2b113cfb3a">torque</a> = ((sensedCurrent.<a class="code" href="../../dd/de0/classyoubot_1_1_joint_sensed_current.html#a1545cb88cc5c6e94d687b301f0f5b284">current</a>.value() * this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a3f0093fc51e1459de3a71de9ac450fbf">torqueConstant</a>) / this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a1c7f052bd8bc7f3cdf72da82d934e7ef">gearRatio</a>) * newton_meter;
<a name="l00793"></a>00793   <span class="comment">// Bouml preserved body end 000C70F1</span>
<a name="l00794"></a>00794 }
<a name="l00795"></a>00795 <span class="comment"></span>
<a name="l00796"></a>00796 <span class="comment">///gets the target or setpoint position of one joint (only firmware 2.0 or higher)</span>
<a name="l00797"></a>00797 <span class="comment">///@param data returns the angle by reference</span>
<a name="l00798"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a5e6159adb8859f3ff327508d8eda7eaa">00798</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a8b84b61d5a0f4ac8e393d269e4d78f6f">YouBotJoint::getData</a>(<a class="code" href="../../d2/d5d/classyoubot_1_1_joint_angle_setpoint.html" title="Set-point angle / position of the joint.">JointAngleSetpoint</a>&amp; data) {
<a name="l00799"></a>00799   <span class="comment">// Bouml preserved body begin 00103EF1</span>
<a name="l00800"></a>00800     <span class="comment">//YouBotSlaveMsg messageBuffer;</span>
<a name="l00801"></a>00801     <span class="keywordflow">if</span>(!ethercatMaster-&gt;<a class="code" href="../../df/d9a/classyoubot_1_1_ethercat_master_interface.html#a776f68c61ccca067395c78ce00431fd6">isEtherCATConnectionEstablished</a>()){
<a name="l00802"></a>00802       <span class="keywordflow">throw</span> <a class="code" href="../../d6/d17/classyoubot_1_1_ether_c_a_t_connection_exception.html" title="EtherCAT Connection Error.">EtherCATConnectionException</a>(<span class="stringliteral">&quot;No EtherCAT connection&quot;</span>);
<a name="l00803"></a>00803     }
<a name="l00804"></a>00804   
<a name="l00805"></a>00805     ethercatMaster-&gt;getMsgBuffer(this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a93b5b3410b7a90a42fbf31069a09b345">jointNumber</a>, messageBuffer);
<a name="l00806"></a>00806     this-&gt;parseYouBotErrorFlags(messageBuffer);
<a name="l00807"></a>00807 
<a name="l00808"></a>00808     <span class="keywordflow">if</span> (storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a1c7f052bd8bc7f3cdf72da82d934e7ef">gearRatio</a> == 0) {
<a name="l00809"></a>00809       <span class="keywordflow">throw</span> std::out_of_range(<span class="stringliteral">&quot;A Gear Ratio of zero is not allowed&quot;</span>);
<a name="l00810"></a>00810     }
<a name="l00811"></a>00811     <span class="keywordflow">if</span> (storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#aa7281cbdb97eb444c0c090ee99d24a0f">encoderTicksPerRound</a> == 0) {
<a name="l00812"></a>00812       <span class="keywordflow">throw</span> std::out_of_range(<span class="stringliteral">&quot;Zero Encoder Ticks per Round are not allowed&quot;</span>);
<a name="l00813"></a>00813     }
<a name="l00814"></a>00814     <span class="comment">//  LOG(trace) &lt;&lt; &quot;enc: &quot; &lt;&lt; messageBuffer.stctInput.actualPosition;</span>
<a name="l00815"></a>00815     data.<a class="code" href="../../d2/d5d/classyoubot_1_1_joint_angle_setpoint.html#a04fcdd16ee9354653ef72ef22a52678c">angle</a> = ((double) messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#a66dcf6b0edf8b481feda9a9dc402efc9">stctInput</a>.<a class="code" href="../../d1/d88/structyoubot_1_1_slave_message_input.html#a74185bd3304d906ee06be5bbb2e19441">targetPosition</a> / storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#aa7281cbdb97eb444c0c090ee99d24a0f">encoderTicksPerRound</a>) * storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a1c7f052bd8bc7f3cdf72da82d934e7ef">gearRatio</a> * (2.0 * M_PI) * radian;
<a name="l00816"></a>00816 
<a name="l00817"></a>00817     <span class="keywordflow">if</span> (storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a6a97db7684b6287c118f5e110842a2a6">inverseMovementDirection</a>) {
<a name="l00818"></a>00818       data.<a class="code" href="../../d2/d5d/classyoubot_1_1_joint_angle_setpoint.html#a04fcdd16ee9354653ef72ef22a52678c">angle</a> = -data.<a class="code" href="../../d2/d5d/classyoubot_1_1_joint_angle_setpoint.html#a04fcdd16ee9354653ef72ef22a52678c">angle</a>;
<a name="l00819"></a>00819     }
<a name="l00820"></a>00820   <span class="comment">// Bouml preserved body end 00103EF1</span>
<a name="l00821"></a>00821 }
<a name="l00822"></a>00822 <span class="comment"></span>
<a name="l00823"></a>00823 <span class="comment">///gets the target or setpoint velocity of one joint (only firmware 2.0 or higher)</span>
<a name="l00824"></a>00824 <span class="comment">///@param data returns the velocity by reference</span>
<a name="l00825"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#ae3ae31da3d4d3a83727ce1ab630a0c13">00825</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a8b84b61d5a0f4ac8e393d269e4d78f6f">YouBotJoint::getData</a>(<a class="code" href="../../d3/d6c/classyoubot_1_1_joint_velocity_setpoint.html" title="Set-point velocity of the joint.">JointVelocitySetpoint</a>&amp; data) {
<a name="l00826"></a>00826   <span class="comment">// Bouml preserved body begin 001002F1</span>
<a name="l00827"></a>00827     <span class="keywordflow">if</span>(!ethercatMaster-&gt;<a class="code" href="../../df/d9a/classyoubot_1_1_ethercat_master_interface.html#a776f68c61ccca067395c78ce00431fd6">isEtherCATConnectionEstablished</a>()){
<a name="l00828"></a>00828       <span class="keywordflow">throw</span> <a class="code" href="../../d6/d17/classyoubot_1_1_ether_c_a_t_connection_exception.html" title="EtherCAT Connection Error.">EtherCATConnectionException</a>(<span class="stringliteral">&quot;No EtherCAT connection&quot;</span>);
<a name="l00829"></a>00829     }
<a name="l00830"></a>00830     
<a name="l00831"></a>00831     <span class="comment">//YouBotSlaveMsg messageBuffer;</span>
<a name="l00832"></a>00832     ethercatMaster-&gt;getMsgBuffer(this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a93b5b3410b7a90a42fbf31069a09b345">jointNumber</a>, messageBuffer);
<a name="l00833"></a>00833     this-&gt;parseYouBotErrorFlags(messageBuffer);
<a name="l00834"></a>00834 
<a name="l00835"></a>00835     <span class="keywordflow">if</span> (storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a1c7f052bd8bc7f3cdf72da82d934e7ef">gearRatio</a> == 0) {
<a name="l00836"></a>00836       <span class="keywordflow">throw</span> std::out_of_range(<span class="stringliteral">&quot;A Gear Ratio of 0 is not allowed&quot;</span>);
<a name="l00837"></a>00837     }
<a name="l00838"></a>00838     <span class="keywordtype">double</span> motorRPM = messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#a66dcf6b0edf8b481feda9a9dc402efc9">stctInput</a>.<a class="code" href="../../d1/d88/structyoubot_1_1_slave_message_input.html#a723748cd770cfebc62918a68e3079652">targetVelocity</a>;
<a name="l00839"></a>00839     <span class="comment">//convert RPM of the motor to radian per second of the wheel/joint</span>
<a name="l00840"></a>00840     data.<a class="code" href="../../d3/d6c/classyoubot_1_1_joint_velocity_setpoint.html#a92bb2f1df8de29685f80e488b24792c0">angularVelocity</a> = ((motorRPM / 60.0) * storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a1c7f052bd8bc7f3cdf72da82d934e7ef">gearRatio</a> * 2.0 * M_PI) * radian_per_second;
<a name="l00841"></a>00841     
<a name="l00842"></a>00842     <span class="keywordflow">if</span> (storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a6a97db7684b6287c118f5e110842a2a6">inverseMovementDirection</a>) {
<a name="l00843"></a>00843       data.<a class="code" href="../../d3/d6c/classyoubot_1_1_joint_velocity_setpoint.html#a92bb2f1df8de29685f80e488b24792c0">angularVelocity</a> *= -1;
<a name="l00844"></a>00844     }
<a name="l00845"></a>00845   <span class="comment">// Bouml preserved body end 001002F1</span>
<a name="l00846"></a>00846 }
<a name="l00847"></a>00847 <span class="comment"></span>
<a name="l00848"></a>00848 <span class="comment">///gets the motor current target or setpoint of one joint (only firmware 2.0 or higher)</span>
<a name="l00849"></a>00849 <span class="comment">///@param data returns the motor current by reference</span>
<a name="l00850"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a8996dbd0df5b014712abf9abefc82fe8">00850</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a8b84b61d5a0f4ac8e393d269e4d78f6f">YouBotJoint::getData</a>(<a class="code" href="../../d7/d55/classyoubot_1_1_joint_current_setpoint.html" title="Set-point current of the joint.">JointCurrentSetpoint</a>&amp; data) {
<a name="l00851"></a>00851   <span class="comment">// Bouml preserved body begin 00100371</span>
<a name="l00852"></a>00852     <span class="keywordflow">if</span>(!ethercatMaster-&gt;<a class="code" href="../../df/d9a/classyoubot_1_1_ethercat_master_interface.html#a776f68c61ccca067395c78ce00431fd6">isEtherCATConnectionEstablished</a>()){
<a name="l00853"></a>00853       <span class="keywordflow">throw</span> <a class="code" href="../../d6/d17/classyoubot_1_1_ether_c_a_t_connection_exception.html" title="EtherCAT Connection Error.">EtherCATConnectionException</a>(<span class="stringliteral">&quot;No EtherCAT connection&quot;</span>);
<a name="l00854"></a>00854     }
<a name="l00855"></a>00855     
<a name="l00856"></a>00856     <span class="comment">//YouBotSlaveMsg messageBuffer;</span>
<a name="l00857"></a>00857     ethercatMaster-&gt;getMsgBuffer(this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a93b5b3410b7a90a42fbf31069a09b345">jointNumber</a>, messageBuffer);
<a name="l00858"></a>00858     this-&gt;parseYouBotErrorFlags(messageBuffer);
<a name="l00859"></a>00859     <span class="comment">//convert mili ampere to ampere</span>
<a name="l00860"></a>00860     <span class="keywordtype">double</span> current = messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#a66dcf6b0edf8b481feda9a9dc402efc9">stctInput</a>.<a class="code" href="../../d1/d88/structyoubot_1_1_slave_message_input.html#ae57fd9e03421b47deab3c4a606637f21">targetCurrent</a>;
<a name="l00861"></a>00861     data.<a class="code" href="../../d7/d55/classyoubot_1_1_joint_current_setpoint.html#a1545cb88cc5c6e94d687b301f0f5b284">current</a> =  current / 1000.0 * ampere;
<a name="l00862"></a>00862     
<a name="l00863"></a>00863     <span class="keywordflow">if</span> (storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a6a97db7684b6287c118f5e110842a2a6">inverseMovementDirection</a>) {
<a name="l00864"></a>00864       data.<a class="code" href="../../d7/d55/classyoubot_1_1_joint_current_setpoint.html#a1545cb88cc5c6e94d687b301f0f5b284">current</a> *= -1;
<a name="l00865"></a>00865     }
<a name="l00866"></a>00866   <span class="comment">// Bouml preserved body end 00100371</span>
<a name="l00867"></a>00867 }
<a name="l00868"></a>00868 <span class="comment"></span>
<a name="l00869"></a>00869 <span class="comment">///gets the ramp generator velocity of one joint (only firmware 2.0 or higher)</span>
<a name="l00870"></a>00870 <span class="comment">///@param data returns the velocity by reference</span>
<a name="l00871"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#ae57989c0608b9223cfe1a35c0f08f2cd">00871</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a8b84b61d5a0f4ac8e393d269e4d78f6f">YouBotJoint::getData</a>(<a class="code" href="../../d6/d30/classyoubot_1_1_joint_ramp_generator_velocity.html" title="Sensed velocity of the joint.">JointRampGeneratorVelocity</a>&amp; data) {
<a name="l00872"></a>00872   <span class="comment">// Bouml preserved body begin 001003F1</span>
<a name="l00873"></a>00873     <span class="keywordflow">if</span>(!ethercatMaster-&gt;<a class="code" href="../../df/d9a/classyoubot_1_1_ethercat_master_interface.html#a776f68c61ccca067395c78ce00431fd6">isEtherCATConnectionEstablished</a>()){
<a name="l00874"></a>00874       <span class="keywordflow">throw</span> <a class="code" href="../../d6/d17/classyoubot_1_1_ether_c_a_t_connection_exception.html" title="EtherCAT Connection Error.">EtherCATConnectionException</a>(<span class="stringliteral">&quot;No EtherCAT connection&quot;</span>);
<a name="l00875"></a>00875     }
<a name="l00876"></a>00876     
<a name="l00877"></a>00877     <span class="comment">//YouBotSlaveMsg messageBuffer;</span>
<a name="l00878"></a>00878     ethercatMaster-&gt;getMsgBuffer(this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a93b5b3410b7a90a42fbf31069a09b345">jointNumber</a>, messageBuffer);
<a name="l00879"></a>00879     this-&gt;parseYouBotErrorFlags(messageBuffer);
<a name="l00880"></a>00880 
<a name="l00881"></a>00881     <span class="keywordflow">if</span> (storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a1c7f052bd8bc7f3cdf72da82d934e7ef">gearRatio</a> == 0) {
<a name="l00882"></a>00882       <span class="keywordflow">throw</span> std::out_of_range(<span class="stringliteral">&quot;A Gear Ratio of 0 is not allowed&quot;</span>);
<a name="l00883"></a>00883     }
<a name="l00884"></a>00884     <span class="keywordtype">double</span> motorRPM = messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#a66dcf6b0edf8b481feda9a9dc402efc9">stctInput</a>.<a class="code" href="../../d1/d88/structyoubot_1_1_slave_message_input.html#af16bc89db2c33d37713be5b95fafbd0e">rampGeneratorVelocity</a>;
<a name="l00885"></a>00885     <span class="comment">//convert RPM of the motor to radian per second of the wheel/joint</span>
<a name="l00886"></a>00886     data.<a class="code" href="../../d6/d30/classyoubot_1_1_joint_ramp_generator_velocity.html#a1c682edc27f2f80f174781ef3748d376">angularVelocity</a> = ((motorRPM / 60.0) * storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a1c7f052bd8bc7f3cdf72da82d934e7ef">gearRatio</a> * 2.0 * M_PI) * radian_per_second;
<a name="l00887"></a>00887     
<a name="l00888"></a>00888     <span class="keywordflow">if</span> (storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a6a97db7684b6287c118f5e110842a2a6">inverseMovementDirection</a>) {
<a name="l00889"></a>00889       data.<a class="code" href="../../d6/d30/classyoubot_1_1_joint_ramp_generator_velocity.html#a1c682edc27f2f80f174781ef3748d376">angularVelocity</a> *= -1;
<a name="l00890"></a>00890     }
<a name="l00891"></a>00891   <span class="comment">// Bouml preserved body end 001003F1</span>
<a name="l00892"></a>00892 }
<a name="l00893"></a>00893 
<a name="l00894"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#ae6bb64697e202afe37bfd7285cb7e3db">00894</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#ae6bb64697e202afe37bfd7285cb7e3db">YouBotJoint::getUserVariable</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> index, <span class="keywordtype">int</span>&amp; data) {
<a name="l00895"></a>00895   <span class="comment">// Bouml preserved body begin 000AD171</span>
<a name="l00896"></a>00896   
<a name="l00897"></a>00897   <span class="keywordflow">if</span>(index == 0 || index &gt; 55){
<a name="l00898"></a>00898     <span class="keywordflow">throw</span> <a class="code" href="../../d7/df7/classyoubot_1_1_joint_parameter_exception.html" title="Joint parameter exception.">JointParameterException</a>(<span class="stringliteral">&quot;User variable index is out of range use 1-55 at: &quot;</span> + this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#ae2b1a60f4a7c817a72cd9ee42c0147d0">jointName</a>);
<a name="l00899"></a>00899   }
<a name="l00900"></a>00900   <span class="comment">//56 is the last userdata at bank 2</span>
<a name="l00901"></a>00901     <a class="code" href="../../de/dd3/classyoubot_1_1_you_bot_slave_mailbox_msg.html" title="EtherCAT mailbox message of the youBot slaves.">YouBotSlaveMailboxMsg</a> message;
<a name="l00902"></a>00902     message.<a class="code" href="../../de/dd3/classyoubot_1_1_you_bot_slave_mailbox_msg.html#a53eee454ed382fcf7b2fc1547843e6f2">stctOutput</a>.<a class="code" href="../../d5/dcd/structyoubot_1_1mailbox_output_buffer.html#adf3c006c84f5bb0c378e208cb31e0e57">moduleAddress</a> = DRIVE;
<a name="l00903"></a>00903     message.<a class="code" href="../../de/dd3/classyoubot_1_1_you_bot_slave_mailbox_msg.html#a53eee454ed382fcf7b2fc1547843e6f2">stctOutput</a>.<a class="code" href="../../d5/dcd/structyoubot_1_1mailbox_output_buffer.html#a5760802fee58450d245fed27eccd0898">commandNumber</a> = GGP;
<a name="l00904"></a>00904     message.<a class="code" href="../../de/dd3/classyoubot_1_1_you_bot_slave_mailbox_msg.html#a53eee454ed382fcf7b2fc1547843e6f2">stctOutput</a>.<a class="code" href="../../d5/dcd/structyoubot_1_1mailbox_output_buffer.html#a9912dcafd476c4386c085f06a3423ec2">typeNumber</a> = index;
<a name="l00905"></a>00905     message.<a class="code" href="../../de/dd3/classyoubot_1_1_you_bot_slave_mailbox_msg.html#a53eee454ed382fcf7b2fc1547843e6f2">stctOutput</a>.<a class="code" href="../../d5/dcd/structyoubot_1_1mailbox_output_buffer.html#ac845b18c161af90948159c75f58964a8">motorNumber</a> = <a class="code" href="../../d5/d23/_protocol_definitions_8hpp.html#a216da0bec5cc88bc344dae00dbd7a38d">USER_VARIABLE_BANK</a>;
<a name="l00906"></a>00906     message.<a class="code" href="../../de/dd3/classyoubot_1_1_you_bot_slave_mailbox_msg.html#a53eee454ed382fcf7b2fc1547843e6f2">stctOutput</a>.<a class="code" href="../../d5/dcd/structyoubot_1_1mailbox_output_buffer.html#a825a6aa3f85d5b289f6e1a3b3a2beb83">value</a> = 0;
<a name="l00907"></a>00907     
<a name="l00908"></a>00908    <span class="keywordflow">if</span> (!retrieveValueFromMotorContoller(message)) {
<a name="l00909"></a>00909      <span class="keywordflow">throw</span> <a class="code" href="../../d7/df7/classyoubot_1_1_joint_parameter_exception.html" title="Joint parameter exception.">JointParameterException</a>(<span class="stringliteral">&quot;Unable to get parameter from joint: &quot;</span> + this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#ae2b1a60f4a7c817a72cd9ee42c0147d0">jointName</a>);
<a name="l00910"></a>00910    }
<a name="l00911"></a>00911    this-&gt;parseMailboxStatusFlags(message);
<a name="l00912"></a>00912    
<a name="l00913"></a>00913    data = message.<a class="code" href="../../de/dd3/classyoubot_1_1_you_bot_slave_mailbox_msg.html#ae21b6d107ed3b4e1ef20017909e98179">stctInput</a>.<a class="code" href="../../d8/dff/structyoubot_1_1mailbox_input_buffer.html#a825a6aa3f85d5b289f6e1a3b3a2beb83">value</a>;
<a name="l00914"></a>00914   <span class="comment">// Bouml preserved body end 000AD171</span>
<a name="l00915"></a>00915 }
<a name="l00916"></a>00916 
<a name="l00917"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#aa50ab4d9a045bfdac0f99dab006a9bff">00917</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#aa50ab4d9a045bfdac0f99dab006a9bff">YouBotJoint::setUserVariable</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> index, <span class="keyword">const</span> <span class="keywordtype">int</span> data) {
<a name="l00918"></a>00918   <span class="comment">// Bouml preserved body begin 000AD1F1</span>
<a name="l00919"></a>00919   
<a name="l00920"></a>00920   <span class="keywordflow">if</span>(index &lt; 17 || index &gt; 55){
<a name="l00921"></a>00921     <span class="keywordflow">throw</span> <a class="code" href="../../d7/df7/classyoubot_1_1_joint_parameter_exception.html" title="Joint parameter exception.">JointParameterException</a>(<span class="stringliteral">&quot;User variable index is out of range use 17-55 at: &quot;</span> + this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#ae2b1a60f4a7c817a72cd9ee42c0147d0">jointName</a>);
<a name="l00922"></a>00922   }
<a name="l00923"></a>00923   <span class="comment">//56 is the last userdata at bank 2</span>
<a name="l00924"></a>00924     <a class="code" href="../../de/dd3/classyoubot_1_1_you_bot_slave_mailbox_msg.html" title="EtherCAT mailbox message of the youBot slaves.">YouBotSlaveMailboxMsg</a> message;
<a name="l00925"></a>00925     message.<a class="code" href="../../de/dd3/classyoubot_1_1_you_bot_slave_mailbox_msg.html#a53eee454ed382fcf7b2fc1547843e6f2">stctOutput</a>.<a class="code" href="../../d5/dcd/structyoubot_1_1mailbox_output_buffer.html#adf3c006c84f5bb0c378e208cb31e0e57">moduleAddress</a> = DRIVE;
<a name="l00926"></a>00926     message.<a class="code" href="../../de/dd3/classyoubot_1_1_you_bot_slave_mailbox_msg.html#a53eee454ed382fcf7b2fc1547843e6f2">stctOutput</a>.<a class="code" href="../../d5/dcd/structyoubot_1_1mailbox_output_buffer.html#a5760802fee58450d245fed27eccd0898">commandNumber</a> = GGP;
<a name="l00927"></a>00927     message.<a class="code" href="../../de/dd3/classyoubot_1_1_you_bot_slave_mailbox_msg.html#a53eee454ed382fcf7b2fc1547843e6f2">stctOutput</a>.<a class="code" href="../../d5/dcd/structyoubot_1_1mailbox_output_buffer.html#a9912dcafd476c4386c085f06a3423ec2">typeNumber</a> = index;
<a name="l00928"></a>00928     message.<a class="code" href="../../de/dd3/classyoubot_1_1_you_bot_slave_mailbox_msg.html#a53eee454ed382fcf7b2fc1547843e6f2">stctOutput</a>.<a class="code" href="../../d5/dcd/structyoubot_1_1mailbox_output_buffer.html#ac845b18c161af90948159c75f58964a8">motorNumber</a> = <a class="code" href="../../d5/d23/_protocol_definitions_8hpp.html#a216da0bec5cc88bc344dae00dbd7a38d">USER_VARIABLE_BANK</a>;
<a name="l00929"></a>00929     message.<a class="code" href="../../de/dd3/classyoubot_1_1_you_bot_slave_mailbox_msg.html#a53eee454ed382fcf7b2fc1547843e6f2">stctOutput</a>.<a class="code" href="../../d5/dcd/structyoubot_1_1mailbox_output_buffer.html#a825a6aa3f85d5b289f6e1a3b3a2beb83">value</a> = data;
<a name="l00930"></a>00930     
<a name="l00931"></a>00931   <span class="keywordflow">if</span> (!setValueToMotorContoller(message)) {
<a name="l00932"></a>00932      <span class="keywordflow">throw</span> <a class="code" href="../../d7/df7/classyoubot_1_1_joint_parameter_exception.html" title="Joint parameter exception.">JointParameterException</a>(<span class="stringliteral">&quot;Unable to set parameter at joint: &quot;</span> + this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#ae2b1a60f4a7c817a72cd9ee42c0147d0">jointName</a>);
<a name="l00933"></a>00933    }
<a name="l00934"></a>00934     this-&gt;parseMailboxStatusFlags(message);
<a name="l00935"></a>00935   <span class="comment">// Bouml preserved body end 000AD1F1</span>
<a name="l00936"></a>00936 }
<a name="l00937"></a>00937 <span class="comment"></span>
<a name="l00938"></a>00938 <span class="comment">/// Returns the status messages for the motor controller. </span>
<a name="l00939"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a41fff88484f2b6246a2b132ea9503bbd">00939</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a41fff88484f2b6246a2b132ea9503bbd" title="Returns the status messages for the motor controller.">YouBotJoint::getStatus</a>(std::vector&lt;std::string&gt;&amp; statusMessages) {
<a name="l00940"></a>00940   <span class="comment">// Bouml preserved body begin 000AD271</span>
<a name="l00941"></a>00941   <span class="comment">//YouBotSlaveMsg messageBuffer;</span>
<a name="l00942"></a>00942   ethercatMaster-&gt;getMsgBuffer(this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a93b5b3410b7a90a42fbf31069a09b345">jointNumber</a>, messageBuffer);
<a name="l00943"></a>00943   
<a name="l00944"></a>00944   
<a name="l00945"></a>00945   
<a name="l00946"></a>00946 
<a name="l00947"></a>00947     <span class="keywordflow">if</span> (messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#a66dcf6b0edf8b481feda9a9dc402efc9">stctInput</a>.<a class="code" href="../../d1/d88/structyoubot_1_1_slave_message_input.html#a946883f42801644c2a9465c7e0b08203">errorFlags</a> &amp; OVER_CURRENT) {
<a name="l00948"></a>00948       statusMessages.push_back(this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#ae2b1a60f4a7c817a72cd9ee42c0147d0">jointName</a> + <span class="stringliteral">&quot; got over current&quot;</span>);
<a name="l00949"></a>00949     }
<a name="l00950"></a>00950 
<a name="l00951"></a>00951     <span class="keywordflow">if</span> (messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#a66dcf6b0edf8b481feda9a9dc402efc9">stctInput</a>.<a class="code" href="../../d1/d88/structyoubot_1_1_slave_message_input.html#a946883f42801644c2a9465c7e0b08203">errorFlags</a> &amp; UNDER_VOLTAGE) {
<a name="l00952"></a>00952       statusMessages.push_back(this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#ae2b1a60f4a7c817a72cd9ee42c0147d0">jointName</a> + <span class="stringliteral">&quot; got under voltage&quot;</span>);
<a name="l00953"></a>00953     }
<a name="l00954"></a>00954 
<a name="l00955"></a>00955     <span class="keywordflow">if</span> (messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#a66dcf6b0edf8b481feda9a9dc402efc9">stctInput</a>.<a class="code" href="../../d1/d88/structyoubot_1_1_slave_message_input.html#a946883f42801644c2a9465c7e0b08203">errorFlags</a> &amp; OVER_VOLTAGE) {
<a name="l00956"></a>00956       statusMessages.push_back(this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#ae2b1a60f4a7c817a72cd9ee42c0147d0">jointName</a> + <span class="stringliteral">&quot; got over voltage&quot;</span>);
<a name="l00957"></a>00957     }
<a name="l00958"></a>00958 
<a name="l00959"></a>00959     <span class="keywordflow">if</span> (messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#a66dcf6b0edf8b481feda9a9dc402efc9">stctInput</a>.<a class="code" href="../../d1/d88/structyoubot_1_1_slave_message_input.html#a946883f42801644c2a9465c7e0b08203">errorFlags</a> &amp; OVER_TEMPERATURE) {
<a name="l00960"></a>00960       statusMessages.push_back(this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#ae2b1a60f4a7c817a72cd9ee42c0147d0">jointName</a> + <span class="stringliteral">&quot; got over temperature&quot;</span>);
<a name="l00961"></a>00961     }
<a name="l00962"></a>00962 
<a name="l00963"></a>00963     <span class="keywordflow">if</span> (messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#a66dcf6b0edf8b481feda9a9dc402efc9">stctInput</a>.<a class="code" href="../../d1/d88/structyoubot_1_1_slave_message_input.html#a946883f42801644c2a9465c7e0b08203">errorFlags</a> &amp; MOTOR_HALTED) {
<a name="l00964"></a>00964       statusMessages.push_back(this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#ae2b1a60f4a7c817a72cd9ee42c0147d0">jointName</a> + <span class="stringliteral">&quot; is halted&quot;</span>);
<a name="l00965"></a>00965     }
<a name="l00966"></a>00966 
<a name="l00967"></a>00967     <span class="keywordflow">if</span> (messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#a66dcf6b0edf8b481feda9a9dc402efc9">stctInput</a>.<a class="code" href="../../d1/d88/structyoubot_1_1_slave_message_input.html#a946883f42801644c2a9465c7e0b08203">errorFlags</a> &amp; HALL_SENSOR_ERROR) {
<a name="l00968"></a>00968       statusMessages.push_back(this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#ae2b1a60f4a7c817a72cd9ee42c0147d0">jointName</a> + <span class="stringliteral">&quot; got hall sensor problem&quot;</span>);
<a name="l00969"></a>00969     }
<a name="l00970"></a>00970 
<a name="l00971"></a>00971 <span class="comment">//    if (messageBuffer.stctInput.errorFlags &amp; ENCODER_ERROR) {</span>
<a name="l00972"></a>00972 <span class="comment">//      statusMessages.push_back(this-&gt;storage.jointName + &quot; got encoder problem&quot;);</span>
<a name="l00973"></a>00973 <span class="comment">//    }</span>
<a name="l00974"></a>00974 <span class="comment">//</span>
<a name="l00975"></a>00975 <span class="comment">//     if (messageBuffer.stctInput.errorFlags &amp; INITIALIZATION_ERROR) {</span>
<a name="l00976"></a>00976 <span class="comment">//      statusMessages.push_back(this-&gt;storage.jointName + &quot; got inizialization problem&quot;);</span>
<a name="l00977"></a>00977 <span class="comment">//    }</span>
<a name="l00978"></a>00978 
<a name="l00979"></a>00979 <span class="comment">//    if (messageBuffer.stctInput.errorFlags &amp; PWM_MODE_ACTIVE) {</span>
<a name="l00980"></a>00980 <span class="comment">//      statusMessages.push_back(this-&gt;storage.jointName + &quot; has PWM mode active&quot;);</span>
<a name="l00981"></a>00981 <span class="comment">//    }</span>
<a name="l00982"></a>00982 
<a name="l00983"></a>00983     <span class="keywordflow">if</span> (messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#a66dcf6b0edf8b481feda9a9dc402efc9">stctInput</a>.<a class="code" href="../../d1/d88/structyoubot_1_1_slave_message_input.html#a946883f42801644c2a9465c7e0b08203">errorFlags</a> &amp; VELOCITY_MODE) {
<a name="l00984"></a>00984       statusMessages.push_back(this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#ae2b1a60f4a7c817a72cd9ee42c0147d0">jointName</a> + <span class="stringliteral">&quot; has velocity mode active&quot;</span>);
<a name="l00985"></a>00985     }
<a name="l00986"></a>00986 
<a name="l00987"></a>00987     <span class="keywordflow">if</span> (messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#a66dcf6b0edf8b481feda9a9dc402efc9">stctInput</a>.<a class="code" href="../../d1/d88/structyoubot_1_1_slave_message_input.html#a946883f42801644c2a9465c7e0b08203">errorFlags</a> &amp; POSITION_MODE) {
<a name="l00988"></a>00988       statusMessages.push_back(this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#ae2b1a60f4a7c817a72cd9ee42c0147d0">jointName</a> + <span class="stringliteral">&quot; has position mode active&quot;</span>);
<a name="l00989"></a>00989     }
<a name="l00990"></a>00990 
<a name="l00991"></a>00991     <span class="keywordflow">if</span> (messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#a66dcf6b0edf8b481feda9a9dc402efc9">stctInput</a>.<a class="code" href="../../d1/d88/structyoubot_1_1_slave_message_input.html#a946883f42801644c2a9465c7e0b08203">errorFlags</a> &amp; TORQUE_MODE) {
<a name="l00992"></a>00992       statusMessages.push_back(this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#ae2b1a60f4a7c817a72cd9ee42c0147d0">jointName</a> + <span class="stringliteral">&quot; has torque mode active&quot;</span>);
<a name="l00993"></a>00993     }
<a name="l00994"></a>00994 
<a name="l00995"></a>00995 <span class="comment">//    if (messageBuffer.stctInput.errorFlags &amp; EMERGENCY_STOP) {</span>
<a name="l00996"></a>00996 <span class="comment">//      statusMessages.push_back(this-&gt;storage.jointName + &quot; has emergency stop active&quot;);</span>
<a name="l00997"></a>00997 <span class="comment">//    }</span>
<a name="l00998"></a>00998 <span class="comment">//</span>
<a name="l00999"></a>00999 <span class="comment">//    if (messageBuffer.stctInput.errorFlags &amp; FREERUNNING) {</span>
<a name="l01000"></a>01000 <span class="comment">//      statusMessages.push_back(this-&gt;storage.jointName + &quot; has freerunning active&quot;);</span>
<a name="l01001"></a>01001 <span class="comment">//    }</span>
<a name="l01002"></a>01002 
<a name="l01003"></a>01003     <span class="keywordflow">if</span> (messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#a66dcf6b0edf8b481feda9a9dc402efc9">stctInput</a>.<a class="code" href="../../d1/d88/structyoubot_1_1_slave_message_input.html#a946883f42801644c2a9465c7e0b08203">errorFlags</a> &amp; POSITION_REACHED) {
<a name="l01004"></a>01004       statusMessages.push_back(this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#ae2b1a60f4a7c817a72cd9ee42c0147d0">jointName</a> + <span class="stringliteral">&quot; has position reached&quot;</span>);
<a name="l01005"></a>01005     }
<a name="l01006"></a>01006 
<a name="l01007"></a>01007     <span class="keywordflow">if</span> (messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#a66dcf6b0edf8b481feda9a9dc402efc9">stctInput</a>.<a class="code" href="../../d1/d88/structyoubot_1_1_slave_message_input.html#a946883f42801644c2a9465c7e0b08203">errorFlags</a> &amp; INITIALIZED) {
<a name="l01008"></a>01008       statusMessages.push_back(this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#ae2b1a60f4a7c817a72cd9ee42c0147d0">jointName</a> + <span class="stringliteral">&quot; is initialized&quot;</span>);
<a name="l01009"></a>01009     }
<a name="l01010"></a>01010 
<a name="l01011"></a>01011     <span class="keywordflow">if</span> (messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#a66dcf6b0edf8b481feda9a9dc402efc9">stctInput</a>.<a class="code" href="../../d1/d88/structyoubot_1_1_slave_message_input.html#a946883f42801644c2a9465c7e0b08203">errorFlags</a> &amp; TIMEOUT) {
<a name="l01012"></a>01012       statusMessages.push_back(this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#ae2b1a60f4a7c817a72cd9ee42c0147d0">jointName</a> + <span class="stringliteral">&quot; has a timeout&quot;</span>);
<a name="l01013"></a>01013     }
<a name="l01014"></a>01014 
<a name="l01015"></a>01015     <span class="keywordflow">if</span> (messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#a66dcf6b0edf8b481feda9a9dc402efc9">stctInput</a>.<a class="code" href="../../d1/d88/structyoubot_1_1_slave_message_input.html#a946883f42801644c2a9465c7e0b08203">errorFlags</a> &amp; I2T_EXCEEDED) {
<a name="l01016"></a>01016       statusMessages.push_back(this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#ae2b1a60f4a7c817a72cd9ee42c0147d0">jointName</a> + <span class="stringliteral">&quot; exceeded I2t&quot;</span>);
<a name="l01017"></a>01017     }
<a name="l01018"></a>01018   
<a name="l01019"></a>01019   
<a name="l01020"></a>01020   <span class="comment">// Bouml preserved body end 000AD271</span>
<a name="l01021"></a>01021 }
<a name="l01022"></a>01022 <span class="comment"></span>
<a name="l01023"></a>01023 <span class="comment">/// Returns the status messages as status flags for the motor controller. The status flag bits are assigned like this:</span>
<a name="l01024"></a>01024 <span class="comment">/// 0:  Overcurrent</span>
<a name="l01025"></a>01025 <span class="comment">/// 1:  Undervoltage</span>
<a name="l01026"></a>01026 <span class="comment">/// 2:  Overvoltage</span>
<a name="l01027"></a>01027 <span class="comment">/// 3:  Overtemperature</span>
<a name="l01028"></a>01028 <span class="comment">/// 4:  Motor halted</span>
<a name="l01029"></a>01029 <span class="comment">/// 5:  Hall error flag</span>
<a name="l01030"></a>01030 <span class="comment">/// 6:  ---</span>
<a name="l01031"></a>01031 <span class="comment">/// 7:  ---</span>
<a name="l01032"></a>01032 <span class="comment">/// 8:  PWM mode active</span>
<a name="l01033"></a>01033 <span class="comment">/// 9:  Velocity mode active</span>
<a name="l01034"></a>01034 <span class="comment">/// 10: Position mode active</span>
<a name="l01035"></a>01035 <span class="comment">/// 11: Torque mode active</span>
<a name="l01036"></a>01036 <span class="comment">/// 12: ---</span>
<a name="l01037"></a>01037 <span class="comment">/// 13: ---</span>
<a name="l01038"></a>01038 <span class="comment">/// 14: Position end flag</span>
<a name="l01039"></a>01039 <span class="comment">/// 15: Module initialized</span>
<a name="l01040"></a>01040 <span class="comment">/// 16: EtherCAT timeout flag</span>
<a name="l01041"></a>01041 <span class="comment">/// 17: I2t exceeded flag</span>
<a name="l01042"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a8478d5253ea061cca65673c46009b96b">01042</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a41fff88484f2b6246a2b132ea9503bbd" title="Returns the status messages for the motor controller.">YouBotJoint::getStatus</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>&amp; statusFlags) {
<a name="l01043"></a>01043   <span class="comment">// Bouml preserved body begin 000AD2F1</span>
<a name="l01044"></a>01044   <span class="comment">//YouBotSlaveMsg messageBuffer;</span>
<a name="l01045"></a>01045   ethercatMaster-&gt;getMsgBuffer(this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a93b5b3410b7a90a42fbf31069a09b345">jointNumber</a>, messageBuffer);
<a name="l01046"></a>01046   
<a name="l01047"></a>01047   statusFlags = messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#a66dcf6b0edf8b481feda9a9dc402efc9">stctInput</a>.<a class="code" href="../../d1/d88/structyoubot_1_1_slave_message_input.html#a946883f42801644c2a9465c7e0b08203">errorFlags</a>;
<a name="l01048"></a>01048   <span class="comment">// Bouml preserved body end 000AD2F1</span>
<a name="l01049"></a>01049 }
<a name="l01050"></a>01050 <span class="comment"></span>
<a name="l01051"></a>01051 <span class="comment">/// set the encoder values of the joint to zero. This postion will be the new reference.</span>
<a name="l01052"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#acdda6eb5398edb141b7ff040a3f61b08">01052</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#acdda6eb5398edb141b7ff040a3f61b08" title="set the encoder values of the joint to zero. This postion will be the new reference...">YouBotJoint::setEncoderToZero</a>() {
<a name="l01053"></a>01053   <span class="comment">// Bouml preserved body begin 000AED71</span>
<a name="l01054"></a>01054     <span class="keywordflow">if</span>(!ethercatMaster-&gt;<a class="code" href="../../df/d9a/classyoubot_1_1_ethercat_master_interface.html#a776f68c61ccca067395c78ce00431fd6">isEtherCATConnectionEstablished</a>()){
<a name="l01055"></a>01055       <span class="keywordflow">throw</span> <a class="code" href="../../d6/d17/classyoubot_1_1_ether_c_a_t_connection_exception.html" title="EtherCAT Connection Error.">EtherCATConnectionException</a>(<span class="stringliteral">&quot;No EtherCAT connection&quot;</span>);
<a name="l01056"></a>01056     }
<a name="l01057"></a>01057 
<a name="l01058"></a>01058     <a class="code" href="../../de/dd3/classyoubot_1_1_you_bot_slave_mailbox_msg.html" title="EtherCAT mailbox message of the youBot slaves.">YouBotSlaveMailboxMsg</a> message;
<a name="l01059"></a>01059     message.<a class="code" href="../../de/dd3/classyoubot_1_1_you_bot_slave_mailbox_msg.html#a53eee454ed382fcf7b2fc1547843e6f2">stctOutput</a>.<a class="code" href="../../d5/dcd/structyoubot_1_1mailbox_output_buffer.html#a5760802fee58450d245fed27eccd0898">commandNumber</a> = SAP;
<a name="l01060"></a>01060     message.<a class="code" href="../../de/dd3/classyoubot_1_1_you_bot_slave_mailbox_msg.html#a53eee454ed382fcf7b2fc1547843e6f2">stctOutput</a>.<a class="code" href="../../d5/dcd/structyoubot_1_1mailbox_output_buffer.html#adf3c006c84f5bb0c378e208cb31e0e57">moduleAddress</a> = DRIVE;
<a name="l01061"></a>01061     message.<a class="code" href="../../de/dd3/classyoubot_1_1_you_bot_slave_mailbox_msg.html#a53eee454ed382fcf7b2fc1547843e6f2">stctOutput</a>.<a class="code" href="../../d5/dcd/structyoubot_1_1mailbox_output_buffer.html#a9912dcafd476c4386c085f06a3423ec2">typeNumber</a> = 1; <span class="comment">//actual Position</span>
<a name="l01062"></a>01062     message.<a class="code" href="../../de/dd3/classyoubot_1_1_you_bot_slave_mailbox_msg.html#a53eee454ed382fcf7b2fc1547843e6f2">stctOutput</a>.<a class="code" href="../../d5/dcd/structyoubot_1_1mailbox_output_buffer.html#a825a6aa3f85d5b289f6e1a3b3a2beb83">value</a> = 0;
<a name="l01063"></a>01063 
<a name="l01064"></a>01064     <span class="keywordflow">if</span> (!setValueToMotorContoller(message)) {
<a name="l01065"></a>01065       <span class="keywordflow">throw</span> <a class="code" href="../../d7/df7/classyoubot_1_1_joint_parameter_exception.html" title="Joint parameter exception.">JointParameterException</a>(<span class="stringliteral">&quot;Unable to set the encoders to zero at joint: &quot;</span> + this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#ae2b1a60f4a7c817a72cd9ee42c0147d0">jointName</a>);
<a name="l01066"></a>01066     }
<a name="l01067"></a>01067 
<a name="l01068"></a>01068     <span class="comment">//YouBotSlaveMsg messageBuffer;</span>
<a name="l01069"></a>01069     <span class="comment">// messageBuffer.stctOutput.controllerMode = SET_POSITION_TO_REFERENCE;</span>
<a name="l01070"></a>01070     <span class="comment">// messageBuffer.stctOutput.value = 0;</span>
<a name="l01071"></a>01071 
<a name="l01072"></a>01072     <span class="comment">//ethercatMaster-&gt;setMsgBuffer(messageBuffer, this-&gt;storage.jointNumber);</span>
<a name="l01073"></a>01073 
<a name="l01074"></a>01074 
<a name="l01075"></a>01075   <span class="comment">// Bouml preserved body end 000AED71</span>
<a name="l01076"></a>01076 }
<a name="l01077"></a>01077 
<a name="l01078"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#ae74a744df590b9d7d23f9cc4c9c5a499">01078</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#ae74a744df590b9d7d23f9cc4c9c5a499">YouBotJoint::noMoreAction</a>() {
<a name="l01079"></a>01079   <span class="comment">// Bouml preserved body begin 000664F1</span>
<a name="l01080"></a>01080     <span class="keywordflow">if</span>(!ethercatMaster-&gt;<a class="code" href="../../df/d9a/classyoubot_1_1_ethercat_master_interface.html#a776f68c61ccca067395c78ce00431fd6">isEtherCATConnectionEstablished</a>()){
<a name="l01081"></a>01081       <span class="keywordflow">throw</span> <a class="code" href="../../d6/d17/classyoubot_1_1_ether_c_a_t_connection_exception.html" title="EtherCAT Connection Error.">EtherCATConnectionException</a>(<span class="stringliteral">&quot;No EtherCAT connection&quot;</span>);
<a name="l01082"></a>01082     }
<a name="l01083"></a>01083     
<a name="l01084"></a>01084     <span class="comment">//YouBotSlaveMsg messageBuffer;</span>
<a name="l01085"></a>01085     messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#ac4489f842f825c4fce5c860869545ab4">stctOutput</a>.<a class="code" href="../../df/dc0/structyoubot_1_1_slave_message_output.html#a6e40b9abc9f9fc48eff01d623270f59c">controllerMode</a> = NO_MORE_ACTION;
<a name="l01086"></a>01086     messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#ac4489f842f825c4fce5c860869545ab4">stctOutput</a>.<a class="code" href="../../df/dc0/structyoubot_1_1_slave_message_output.html#ad5794f4b898186ff82eaee88b98ef483">value</a> = 0;
<a name="l01087"></a>01087 
<a name="l01088"></a>01088     ethercatMaster-&gt;setMsgBuffer(messageBuffer, this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a93b5b3410b7a90a42fbf31069a09b345">jointNumber</a>);
<a name="l01089"></a>01089   <span class="comment">// Bouml preserved body end 000664F1</span>
<a name="l01090"></a>01090 }
<a name="l01091"></a>01091 
<a name="l01092"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#ab4f6a8fb9393bb962ff1b82bbc44a14e">01092</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#ab4f6a8fb9393bb962ff1b82bbc44a14e">YouBotJoint::stopJoint</a>() {
<a name="l01093"></a>01093   <span class="comment">// Bouml preserved body begin 00066471</span>
<a name="l01094"></a>01094     <span class="keywordflow">if</span>(!ethercatMaster-&gt;<a class="code" href="../../df/d9a/classyoubot_1_1_ethercat_master_interface.html#a776f68c61ccca067395c78ce00431fd6">isEtherCATConnectionEstablished</a>()){
<a name="l01095"></a>01095       <span class="keywordflow">throw</span> <a class="code" href="../../d6/d17/classyoubot_1_1_ether_c_a_t_connection_exception.html" title="EtherCAT Connection Error.">EtherCATConnectionException</a>(<span class="stringliteral">&quot;No EtherCAT connection&quot;</span>);
<a name="l01096"></a>01096     }
<a name="l01097"></a>01097     
<a name="l01098"></a>01098     <span class="comment">//YouBotSlaveMsg messageBuffer;</span>
<a name="l01099"></a>01099     messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#ac4489f842f825c4fce5c860869545ab4">stctOutput</a>.<a class="code" href="../../df/dc0/structyoubot_1_1_slave_message_output.html#a6e40b9abc9f9fc48eff01d623270f59c">controllerMode</a> = MOTOR_STOP;
<a name="l01100"></a>01100     messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#ac4489f842f825c4fce5c860869545ab4">stctOutput</a>.<a class="code" href="../../df/dc0/structyoubot_1_1_slave_message_output.html#ad5794f4b898186ff82eaee88b98ef483">value</a> = 0;
<a name="l01101"></a>01101 
<a name="l01102"></a>01102     ethercatMaster-&gt;setMsgBuffer(messageBuffer, this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a93b5b3410b7a90a42fbf31069a09b345">jointNumber</a>);
<a name="l01103"></a>01103   <span class="comment">// Bouml preserved body end 00066471</span>
<a name="l01104"></a>01104 }
<a name="l01105"></a>01105 
<a name="l01106"></a><a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a662ce50f0905ec92b88a6bb463950162">01106</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d6/d4c/classyoubot_1_1_you_bot_joint.html#a662ce50f0905ec92b88a6bb463950162">YouBotJoint::getJointNumber</a>() {
<a name="l01107"></a>01107   <span class="comment">// Bouml preserved body begin 000EA2F1</span>
<a name="l01108"></a>01108   <span class="keywordflow">return</span> this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#a93b5b3410b7a90a42fbf31069a09b345">jointNumber</a>;
<a name="l01109"></a>01109   <span class="comment">// Bouml preserved body end 000EA2F1</span>
<a name="l01110"></a>01110 }
<a name="l01111"></a>01111 
<a name="l01112"></a>01112 <span class="keywordtype">void</span> YouBotJoint::parseYouBotErrorFlags(<span class="keyword">const</span> <a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html" title="EtherCat message of the youBot EtherCat slaves.">YouBotSlaveMsg</a>&amp; messageBuffer) {
<a name="l01113"></a>01113   <span class="comment">// Bouml preserved body begin 00044AF1</span>
<a name="l01114"></a>01114 
<a name="l01115"></a>01115     <span class="keywordflow">if</span> (messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#a66dcf6b0edf8b481feda9a9dc402efc9">stctInput</a>.<a class="code" href="../../d1/d88/structyoubot_1_1_slave_message_input.html#a946883f42801644c2a9465c7e0b08203">errorFlags</a> &amp; OVER_CURRENT) {
<a name="l01116"></a>01116       <a class="code" href="../../d3/de3/_logger_8hpp.html#aba7b09d6e8fbe414c23705ad24dde6ff">LOG</a>(warning) &lt;&lt; this-&gt;storage.<a class="code" href="../../d4/d6e/classyoubot_1_1_you_bot_joint_storage.html#ae2b1a60f4a7c817a72cd9ee42c0147d0">jointName</a> &lt;&lt; <span class="stringliteral">&quot; over current&quot;</span>;
<a name="l01117"></a>01117       <span class="comment">//    throw JointErrorException(this-&gt;storage.jointName + &quot;got over current&quot;);</span>
<a name="l01118"></a>01118     }
<a name="l01119"></a>01119 
<a name="l01120"></a>01120     <span class="keywordflow">if</span> (messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#a66dcf6b0edf8b481feda9a9dc402efc9">stctInput</a>.errorFlags &amp; UNDER_VOLTAGE) {
<a name="l01121"></a>01121       <a class="code" href="../../d3/de3/_logger_8hpp.html#aba7b09d6e8fbe414c23705ad24dde6ff">LOG</a>(warning) &lt;&lt; this-&gt;storage.jointName &lt;&lt; <span class="stringliteral">&quot; under voltage&quot;</span>;
<a name="l01122"></a>01122       <span class="comment">//    throw JointErrorException(this-&gt;storage.jointName + &quot;got under voltage&quot;);</span>
<a name="l01123"></a>01123     }
<a name="l01124"></a>01124 
<a name="l01125"></a>01125     <span class="keywordflow">if</span> (messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#a66dcf6b0edf8b481feda9a9dc402efc9">stctInput</a>.errorFlags &amp; OVER_VOLTAGE) {
<a name="l01126"></a>01126       <a class="code" href="../../d3/de3/_logger_8hpp.html#aba7b09d6e8fbe414c23705ad24dde6ff">LOG</a>(warning) &lt;&lt; this-&gt;storage.jointName &lt;&lt; <span class="stringliteral">&quot; over voltage&quot;</span>;
<a name="l01127"></a>01127       <span class="comment">//   throw JointErrorException(this-&gt;storage.jointName + &quot;got over voltage&quot;);</span>
<a name="l01128"></a>01128     }
<a name="l01129"></a>01129 
<a name="l01130"></a>01130     <span class="keywordflow">if</span> (messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#a66dcf6b0edf8b481feda9a9dc402efc9">stctInput</a>.errorFlags &amp; OVER_TEMPERATURE) {
<a name="l01131"></a>01131       <a class="code" href="../../d3/de3/_logger_8hpp.html#aba7b09d6e8fbe414c23705ad24dde6ff">LOG</a>(warning) &lt;&lt; this-&gt;storage.jointName &lt;&lt; <span class="stringliteral">&quot; over temperature&quot;</span>;
<a name="l01132"></a>01132       <span class="comment">//   throw JointErrorException(this-&gt;storage.jointName + &quot;got over temperature&quot;);</span>
<a name="l01133"></a>01133     }
<a name="l01134"></a>01134 
<a name="l01135"></a>01135     <span class="keywordflow">if</span> (messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#a66dcf6b0edf8b481feda9a9dc402efc9">stctInput</a>.errorFlags &amp; MOTOR_HALTED) {
<a name="l01136"></a>01136       <span class="comment">//   LOG(info) &lt;&lt; this-&gt;storage.jointName &lt;&lt; &quot; is halted&quot;;</span>
<a name="l01137"></a>01137       <span class="comment">//   throw JointErrorException(this-&gt;storage.jointName + &quot;is halted&quot;);</span>
<a name="l01138"></a>01138     }
<a name="l01139"></a>01139 
<a name="l01140"></a>01140     <span class="keywordflow">if</span> (messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#a66dcf6b0edf8b481feda9a9dc402efc9">stctInput</a>.errorFlags &amp; HALL_SENSOR_ERROR) {
<a name="l01141"></a>01141       <a class="code" href="../../d3/de3/_logger_8hpp.html#aba7b09d6e8fbe414c23705ad24dde6ff">LOG</a>(warning) &lt;&lt; this-&gt;storage.jointName &lt;&lt; <span class="stringliteral">&quot; hall sensor problem&quot;</span>;
<a name="l01142"></a>01142       <span class="comment">//   throw JointErrorException(this-&gt;storage.jointName + &quot;got hall sensor problem&quot;);</span>
<a name="l01143"></a>01143     }
<a name="l01144"></a>01144 
<a name="l01145"></a>01145 <span class="comment">//    if (messageBuffer.stctInput.errorFlags &amp; ENCODER_ERROR) {</span>
<a name="l01146"></a>01146 <span class="comment">//      LOG(warning) &lt;&lt; this-&gt;storage.jointName &lt;&lt; &quot; encoder problem&quot;;</span>
<a name="l01147"></a>01147 <span class="comment">//      //   throw JointErrorException(this-&gt;storage.jointName + &quot;got encoder problem&quot;);</span>
<a name="l01148"></a>01148 <span class="comment">//    }</span>
<a name="l01149"></a>01149 <span class="comment">//</span>
<a name="l01150"></a>01150 <span class="comment">//     if (messageBuffer.stctInput.errorFlags &amp; INITIALIZATION_ERROR) {</span>
<a name="l01151"></a>01151 <span class="comment">//      LOG(warning) &lt;&lt; this-&gt;storage.jointName &lt;&lt; &quot; initialization problem&quot;;</span>
<a name="l01152"></a>01152 <span class="comment">//      //   throw JointErrorException(this-&gt;storage.jointName + &quot;got motor winding problem&quot;);</span>
<a name="l01153"></a>01153 <span class="comment">//    }</span>
<a name="l01154"></a>01154 
<a name="l01155"></a>01155 <span class="comment">//    if (messageBuffer.stctInput.errorFlags &amp; PWM_MODE_ACTIVE) {</span>
<a name="l01156"></a>01156    <span class="comment">//   LOG(info) &lt;&lt; this-&gt;storage.jointName &lt;&lt; &quot; has PWM mode active&quot;;</span>
<a name="l01157"></a>01157       <span class="comment">//   throw JointErrorException(this-&gt;storage.jointName + &quot;the cycle time is violated&quot;);</span>
<a name="l01158"></a>01158 <span class="comment">//    }</span>
<a name="l01159"></a>01159 
<a name="l01160"></a>01160     <span class="keywordflow">if</span> (messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#a66dcf6b0edf8b481feda9a9dc402efc9">stctInput</a>.errorFlags &amp; VELOCITY_MODE) {
<a name="l01161"></a>01161    <span class="comment">//   LOG(info) &lt;&lt; this-&gt;storage.jointName &lt;&lt; &quot; has velocity mode active&quot;;</span>
<a name="l01162"></a>01162       <span class="comment">//   throw JointErrorException(this-&gt;storage.jointName + &quot;need to initialize the sinus commutation&quot;);</span>
<a name="l01163"></a>01163     }
<a name="l01164"></a>01164 
<a name="l01165"></a>01165     <span class="keywordflow">if</span> (messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#a66dcf6b0edf8b481feda9a9dc402efc9">stctInput</a>.errorFlags &amp; POSITION_MODE) {
<a name="l01166"></a>01166    <span class="comment">//   LOG(info) &lt;&lt; this-&gt;storage.jointName &lt;&lt; &quot; has position mode active&quot;;</span>
<a name="l01167"></a>01167       <span class="comment">//   throw JointErrorException(this-&gt;storage.jointName + &quot;need to initialize the sinus commutation&quot;);</span>
<a name="l01168"></a>01168     }
<a name="l01169"></a>01169 
<a name="l01170"></a>01170     <span class="keywordflow">if</span> (messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#a66dcf6b0edf8b481feda9a9dc402efc9">stctInput</a>.errorFlags &amp; TORQUE_MODE) {
<a name="l01171"></a>01171    <span class="comment">//   LOG(info) &lt;&lt; this-&gt;storage.jointName &lt;&lt; &quot; has torque mode active&quot;;</span>
<a name="l01172"></a>01172       <span class="comment">//   throw JointErrorException(this-&gt;storage.jointName + &quot;need to initialize the sinus commutation&quot;);</span>
<a name="l01173"></a>01173     }
<a name="l01174"></a>01174 
<a name="l01175"></a>01175 <span class="comment">//    if (messageBuffer.stctInput.errorFlags &amp; EMERGENCY_STOP) {</span>
<a name="l01176"></a>01176 <span class="comment">//      LOG(info) &lt;&lt; this-&gt;storage.jointName &lt;&lt; &quot; emergency stop active&quot;;</span>
<a name="l01177"></a>01177 <span class="comment">//      //   throw JointErrorException(this-&gt;storage.jointName + &quot;need to initialize the sinus commutation&quot;);</span>
<a name="l01178"></a>01178 <span class="comment">//    }</span>
<a name="l01179"></a>01179 <span class="comment">//</span>
<a name="l01180"></a>01180 <span class="comment">//    if (messageBuffer.stctInput.errorFlags &amp; FREERUNNING) {</span>
<a name="l01181"></a>01181 <span class="comment">//   //   LOG(info) &lt;&lt; this-&gt;storage.jointName &lt;&lt; &quot; has freerunning active&quot;;</span>
<a name="l01182"></a>01182 <span class="comment">//      //   throw JointErrorException(this-&gt;storage.jointName + &quot;need to initialize the sinus commutation&quot;);</span>
<a name="l01183"></a>01183 <span class="comment">//    }</span>
<a name="l01184"></a>01184 
<a name="l01185"></a>01185     <span class="keywordflow">if</span> (messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#a66dcf6b0edf8b481feda9a9dc402efc9">stctInput</a>.errorFlags &amp; POSITION_REACHED) {
<a name="l01186"></a>01186   <span class="comment">//    LOG(info) &lt;&lt; this-&gt;storage.jointName &lt;&lt; &quot; has position reached&quot;;</span>
<a name="l01187"></a>01187       <span class="comment">//   throw JointErrorException(this-&gt;storage.jointName + &quot;need to initialize the sinus commutation&quot;);</span>
<a name="l01188"></a>01188     }
<a name="l01189"></a>01189 
<a name="l01190"></a>01190     <span class="keywordflow">if</span> (!(messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#a66dcf6b0edf8b481feda9a9dc402efc9">stctInput</a>.errorFlags &amp; INITIALIZED)) {
<a name="l01191"></a>01191    <span class="comment">//   LOG(warning) &lt;&lt; this-&gt;storage.jointName &lt;&lt; &quot; not initialized&quot;;</span>
<a name="l01192"></a>01192       <span class="comment">//   throw JointErrorException(this-&gt;storage.jointName + &quot;need to initialize the sinus commutation&quot;);</span>
<a name="l01193"></a>01193     }
<a name="l01194"></a>01194 
<a name="l01195"></a>01195     <span class="keywordflow">if</span> (messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#a66dcf6b0edf8b481feda9a9dc402efc9">stctInput</a>.errorFlags &amp; TIMEOUT) {
<a name="l01196"></a>01196       <a class="code" href="../../d3/de3/_logger_8hpp.html#aba7b09d6e8fbe414c23705ad24dde6ff">LOG</a>(warning) &lt;&lt; this-&gt;storage.jointName &lt;&lt; <span class="stringliteral">&quot; exceeded timeout&quot;</span>;
<a name="l01197"></a>01197       <span class="comment">//   throw JointErrorException(this-&gt;storage.jointName + &quot;need to initialize the sinus commutation&quot;);</span>
<a name="l01198"></a>01198     }
<a name="l01199"></a>01199 
<a name="l01200"></a>01200     <span class="keywordflow">if</span> (messageBuffer.<a class="code" href="../../df/dde/classyoubot_1_1_you_bot_slave_msg.html#a66dcf6b0edf8b481feda9a9dc402efc9">stctInput</a>.errorFlags &amp; I2T_EXCEEDED) {
<a name="l01201"></a>01201       <a class="code" href="../../d3/de3/_logger_8hpp.html#aba7b09d6e8fbe414c23705ad24dde6ff">LOG</a>(warning) &lt;&lt; this-&gt;storage.jointName &lt;&lt; <span class="stringliteral">&quot; exceeded I2t&quot;</span>;
<a name="l01202"></a>01202       <span class="comment">//   throw JointErrorException(this-&gt;storage.jointName + &quot;need to initialize the sinus commutation&quot;);</span>
<a name="l01203"></a>01203     }
<a name="l01204"></a>01204 
<a name="l01205"></a>01205   <span class="comment">// Bouml preserved body end 00044AF1</span>
<a name="l01206"></a>01206 }
<a name="l01207"></a>01207 
<a name="l01208"></a>01208 <span class="keywordtype">void</span> YouBotJoint::parseMailboxStatusFlags(<span class="keyword">const</span> YouBotSlaveMailboxMsg&amp; mailboxMsg) {
<a name="l01209"></a>01209   <span class="comment">// Bouml preserved body begin 00075BF1</span>
<a name="l01210"></a>01210 
<a name="l01211"></a>01211     <span class="keywordflow">switch</span>(mailboxMsg.stctInput.status){
<a name="l01212"></a>01212       <span class="keywordflow">case</span> NO_ERROR:
<a name="l01213"></a>01213         <span class="keywordflow">break</span>;
<a name="l01214"></a>01214       <span class="keywordflow">case</span> INVALID_COMMAND:
<a name="l01215"></a>01215         <a class="code" href="../../d3/de3/_logger_8hpp.html#aba7b09d6e8fbe414c23705ad24dde6ff">LOG</a>(error) &lt;&lt; this-&gt;storage.jointName &lt;&lt; <span class="stringliteral">&quot;Parameter name: &quot;</span> &lt;&lt; mailboxMsg.parameterName &lt;&lt; <span class="stringliteral">&quot;; Command no: &quot;</span> &lt;&lt; mailboxMsg.stctOutput.commandNumber &lt;&lt; <span class="stringliteral">&quot; is an invalid command!&quot;</span> ;
<a name="l01216"></a>01216       <span class="comment">//    throw JointParameterException(this-&gt;storage.jointName + &quot;invalid command&quot;);</span>
<a name="l01217"></a>01217         <span class="keywordflow">break</span>;
<a name="l01218"></a>01218       <span class="keywordflow">case</span> WRONG_TYPE:
<a name="l01219"></a>01219         <a class="code" href="../../d3/de3/_logger_8hpp.html#aba7b09d6e8fbe414c23705ad24dde6ff">LOG</a>(error) &lt;&lt; this-&gt;storage.jointName &lt;&lt; <span class="stringliteral">&quot;Parameter name: &quot;</span> &lt;&lt; mailboxMsg.parameterName &lt;&lt; <span class="stringliteral">&quot; has a wrong type!&quot;</span>;
<a name="l01220"></a>01220       <span class="comment">//    throw JointParameterException(this-&gt;storage.jointName + &quot;wrong type&quot;);</span>
<a name="l01221"></a>01221         <span class="keywordflow">break</span>;
<a name="l01222"></a>01222       <span class="keywordflow">case</span> INVALID_VALUE:
<a name="l01223"></a>01223         <a class="code" href="../../d3/de3/_logger_8hpp.html#aba7b09d6e8fbe414c23705ad24dde6ff">LOG</a>(error) &lt;&lt; this-&gt;storage.jointName &lt;&lt; <span class="stringliteral">&quot;Parameter name: &quot;</span> &lt;&lt; mailboxMsg.parameterName &lt;&lt; <span class="stringliteral">&quot; Value: &quot;</span> &lt;&lt; mailboxMsg.stctOutput.value &lt;&lt; <span class="stringliteral">&quot; is a invalid value!&quot;</span>;
<a name="l01224"></a>01224       <span class="comment">//    throw JointParameterException(this-&gt;storage.jointName + &quot;invalid value&quot;);</span>
<a name="l01225"></a>01225         <span class="keywordflow">break</span>;
<a name="l01226"></a>01226       <span class="keywordflow">case</span> CONFIGURATION_EEPROM_LOCKED:
<a name="l01227"></a>01227         <a class="code" href="../../d3/de3/_logger_8hpp.html#aba7b09d6e8fbe414c23705ad24dde6ff">LOG</a>(error) &lt;&lt; this-&gt;storage.jointName &lt;&lt; <span class="stringliteral">&quot;Parameter name: &quot;</span> &lt;&lt; mailboxMsg.parameterName &lt;&lt; <span class="stringliteral">&quot; - Configuration EEPROM locked&quot;</span>;
<a name="l01228"></a>01228       <span class="comment">//    throw JointParameterException(this-&gt;storage.jointName + &quot;configuration EEPROM locked&quot;);</span>
<a name="l01229"></a>01229         <span class="keywordflow">break</span>;
<a name="l01230"></a>01230       <span class="keywordflow">case</span> COMMAND_NOT_AVAILABLE:
<a name="l01231"></a>01231         <a class="code" href="../../d3/de3/_logger_8hpp.html#aba7b09d6e8fbe414c23705ad24dde6ff">LOG</a>(error) &lt;&lt; this-&gt;storage.jointName &lt;&lt; <span class="stringliteral">&quot;Parameter name: &quot;</span> &lt;&lt; mailboxMsg.parameterName &lt;&lt; <span class="stringliteral">&quot; - Command is not available!&quot;</span>;
<a name="l01232"></a>01232       <span class="comment">//    throw JointParameterException(this-&gt;storage.jointName + &quot;command not available&quot;);</span>
<a name="l01233"></a>01233         <span class="keywordflow">break</span>;
<a name="l01234"></a>01234       <span class="keywordflow">case</span> REPLY_WRITE_PROTECTED:
<a name="l01235"></a>01235         <a class="code" href="../../d3/de3/_logger_8hpp.html#aba7b09d6e8fbe414c23705ad24dde6ff">LOG</a>(error) &lt;&lt; this-&gt;storage.jointName &lt;&lt; <span class="stringliteral">&quot;Parameter name: &quot;</span> &lt;&lt; mailboxMsg.parameterName &lt;&lt; <span class="stringliteral">&quot; - Permissions denied!&quot;</span>;
<a name="l01236"></a>01236       <span class="comment">//    throw JointParameterException(this-&gt;storage.jointName + &quot;command not available&quot;);</span>
<a name="l01237"></a>01237         <span class="keywordflow">break</span>;
<a name="l01238"></a>01238     }
<a name="l01239"></a>01239    
<a name="l01240"></a>01240 
<a name="l01241"></a>01241   <span class="comment">// Bouml preserved body end 00075BF1</span>
<a name="l01242"></a>01242 }
<a name="l01243"></a>01243 
<a name="l01244"></a>01244 <span class="keywordtype">bool</span> YouBotJoint::retrieveValueFromMotorContoller(YouBotSlaveMailboxMsg&amp; message) {
<a name="l01245"></a>01245   <span class="comment">// Bouml preserved body begin 0005BD71</span>
<a name="l01246"></a>01246 
<a name="l01247"></a>01247     <span class="keywordtype">bool</span> unvalid = <span class="keyword">true</span>;
<a name="l01248"></a>01248     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> retry = 0;
<a name="l01249"></a>01249 
<a name="l01250"></a>01250     ethercatMaster-&gt;setMailboxMsgBuffer(message, this-&gt;storage.jointNumber);
<a name="l01251"></a>01251 
<a name="l01252"></a>01252     <a class="code" href="../../d8/d3a/_time_8hpp.html#a44cc0026ac6b473ff071e2b9fd600b7b">SLEEP_MILLISEC</a>(timeTillNextMailboxUpdate);
<a name="l01253"></a>01253 
<a name="l01254"></a>01254     <span class="keywordflow">do</span> {
<a name="l01255"></a>01255       ethercatMaster-&gt;getMailboxMsgBuffer(message, this-&gt;storage.jointNumber);
<a name="l01256"></a>01256     <span class="comment">/*     LOG(trace) &lt;&lt; &quot;CommandNumber &quot; &lt;&lt; (int) message.stctInput.commandNumber</span>
<a name="l01257"></a>01257 <span class="comment">                 &lt;&lt; &quot; moduleAddress &quot; &lt;&lt; (int) message.stctInput.moduleAddress</span>
<a name="l01258"></a>01258 <span class="comment">                 &lt;&lt; &quot; replyAddress &quot; &lt;&lt; (int) message.stctInput.replyAddress</span>
<a name="l01259"></a>01259 <span class="comment">                 &lt;&lt; &quot; status &quot; &lt;&lt; (int) message.stctInput.status</span>
<a name="l01260"></a>01260 <span class="comment">                 &lt;&lt; &quot; value &quot; &lt;&lt; message.stctInput.value; */</span>
<a name="l01261"></a>01261        
<a name="l01262"></a>01262       <span class="keywordflow">if</span> (message.stctOutput.commandNumber == message.stctInput.commandNumber &amp;&amp;
<a name="l01263"></a>01263               message.stctInput.status == NO_ERROR) {
<a name="l01264"></a>01264         unvalid = <span class="keyword">false</span>;
<a name="l01265"></a>01265       } <span class="keywordflow">else</span> {
<a name="l01266"></a>01266         <a class="code" href="../../d8/d3a/_time_8hpp.html#a44cc0026ac6b473ff071e2b9fd600b7b">SLEEP_MILLISEC</a>(timeTillNextMailboxUpdate);
<a name="l01267"></a>01267         retry++;
<a name="l01268"></a>01268       }
<a name="l01269"></a>01269     } <span class="keywordflow">while</span> (retry &lt; mailboxMsgRetries &amp;&amp; unvalid);
<a name="l01270"></a>01270 
<a name="l01271"></a>01271     <span class="keywordflow">if</span> (unvalid) {
<a name="l01272"></a>01272       this-&gt;parseMailboxStatusFlags(message);
<a name="l01273"></a>01273       <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01274"></a>01274     } <span class="keywordflow">else</span> {
<a name="l01275"></a>01275       <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01276"></a>01276     }
<a name="l01277"></a>01277 
<a name="l01278"></a>01278   <span class="comment">// Bouml preserved body end 0005BD71</span>
<a name="l01279"></a>01279 }
<a name="l01280"></a>01280 
<a name="l01281"></a>01281 <span class="keywordtype">bool</span> YouBotJoint::setValueToMotorContoller(<span class="keyword">const</span> YouBotSlaveMailboxMsg&amp; mailboxMsg) {
<a name="l01282"></a>01282   <span class="comment">// Bouml preserved body begin 00054AF1</span>
<a name="l01283"></a>01283 
<a name="l01284"></a>01284     YouBotSlaveMailboxMsg mailboxMsgBuffer;
<a name="l01285"></a>01285     mailboxMsgBuffer = mailboxMsg;
<a name="l01286"></a>01286     <span class="keywordtype">bool</span> unvalid = <span class="keyword">true</span>;
<a name="l01287"></a>01287     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> retry = 0;
<a name="l01288"></a>01288 
<a name="l01289"></a>01289     ethercatMaster-&gt;setMailboxMsgBuffer(mailboxMsgBuffer, this-&gt;storage.jointNumber);
<a name="l01290"></a>01290 
<a name="l01291"></a>01291     <a class="code" href="../../d8/d3a/_time_8hpp.html#a44cc0026ac6b473ff071e2b9fd600b7b">SLEEP_MILLISEC</a>(timeTillNextMailboxUpdate);
<a name="l01292"></a>01292 
<a name="l01293"></a>01293     <span class="keywordflow">do</span> {
<a name="l01294"></a>01294       ethercatMaster-&gt;getMailboxMsgBuffer(mailboxMsgBuffer, this-&gt;storage.jointNumber);
<a name="l01295"></a>01295       <span class="comment">/*    LOG(trace) &lt;&lt; &quot;CommandNumber &quot; &lt;&lt; (int) mailboxMsgBuffer.stctInput.commandNumber</span>
<a name="l01296"></a>01296 <span class="comment">                  &lt;&lt; &quot; moduleAddress &quot; &lt;&lt; (int) mailboxMsgBuffer.stctInput.moduleAddress</span>
<a name="l01297"></a>01297 <span class="comment">                  &lt;&lt; &quot; replyAddress &quot; &lt;&lt; (int) mailboxMsgBuffer.stctInput.replyAddress</span>
<a name="l01298"></a>01298 <span class="comment">                  &lt;&lt; &quot; status &quot; &lt;&lt; (int) mailboxMsgBuffer.stctInput.status</span>
<a name="l01299"></a>01299 <span class="comment">                  &lt;&lt; &quot; value &quot; &lt;&lt; mailboxMsgBuffer.stctInput.value;</span>
<a name="l01300"></a>01300 <span class="comment">       */</span>
<a name="l01301"></a>01301       <span class="keywordflow">if</span> (mailboxMsgBuffer.stctOutput.commandNumber == mailboxMsgBuffer.stctInput.commandNumber &amp;&amp;
<a name="l01302"></a>01302               mailboxMsgBuffer.stctOutput.value == mailboxMsgBuffer.stctInput.value &amp;&amp;
<a name="l01303"></a>01303               mailboxMsgBuffer.stctInput.status == NO_ERROR) {
<a name="l01304"></a>01304         unvalid = <span class="keyword">false</span>;
<a name="l01305"></a>01305       } <span class="keywordflow">else</span> {
<a name="l01306"></a>01306         <a class="code" href="../../d8/d3a/_time_8hpp.html#a44cc0026ac6b473ff071e2b9fd600b7b">SLEEP_MILLISEC</a>(timeTillNextMailboxUpdate);
<a name="l01307"></a>01307         retry++;
<a name="l01308"></a>01308       }
<a name="l01309"></a>01309     } <span class="keywordflow">while</span> (retry &lt; mailboxMsgRetries &amp;&amp; unvalid);
<a name="l01310"></a>01310 
<a name="l01311"></a>01311     <span class="keywordflow">if</span> (unvalid) {
<a name="l01312"></a>01312       this-&gt;parseMailboxStatusFlags(mailboxMsgBuffer);
<a name="l01313"></a>01313       <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01314"></a>01314     } <span class="keywordflow">else</span> {
<a name="l01315"></a>01315       <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01316"></a>01316     }
<a name="l01317"></a>01317 
<a name="l01318"></a>01318   <span class="comment">// Bouml preserved body end 00054AF1</span>
<a name="l01319"></a>01319 }
<a name="l01320"></a>01320 
<a name="l01321"></a>01321 
<a name="l01322"></a>01322 } <span class="comment">// namespace youbot</span>
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
